Program.Sub.ScreenSU.Start
Gui.Form..Create
Gui.Form..Size(12570,11175)
Gui.Form..MinX(0)
Gui.Form..MinY(0)
Gui.Form..Position(0,0)
Gui.Form..BackColor(-2147483633)
Gui.Form..MousePointer(0)
Gui.Form..Event(UnLoad,Form_UnLoad)
Gui.Form..Caption("W2 Maintenance")
Gui.Form..MaxButton(False)
Gui.Form..Sizeable(False)
Gui.Form.cmdSave.Create(Button)
Gui.Form.cmdSave.Size(975,375)
Gui.Form.cmdSave.Position(270,10230)
Gui.Form.cmdSave.Caption("Save")
Gui.Form.cmdSave.TabStop(True)
Gui.Form.cmdSave.TabIndex(31)
Gui.Form.cmdSave.Event(Click,cmdSave_Click)
Gui.Form.cmdSave.Anchor(6)
Gui.Form.tab1.Create(Tab)
Gui.Form.tab1.Size(11700,10050)
Gui.Form.tab1.Position(75,180)
Gui.Form.tab1.Event(Click,tab1_Click)
Gui.Form.tab1.Anchor(15)
Gui.Form.tab1.Tabs(2)
Gui.Form.tab1.SetTab(0)
Gui.Form.tab1.Caption("Contact Information")
Gui.Form.tab1.SetTab(1)
Gui.Form.tab1.Caption("Employee Information")
Gui.Form.frameHdrInfo.Create(Frame)
Gui.Form.frameHdrInfo.Size(11970,10890)
Gui.Form.frameHdrInfo.Position(-15,-15)
Gui.Form.frameHdrInfo.Parent("tab1",0)
Gui.Form.frameHdrInfo.BorderStyle(0)
Gui.Form.frameHdrInfo.BorderStyle(0)
Gui.Form.frameHdrInfo.Anchor(15)
Gui.Form.gcCompany.Create(GsGridControl)
Gui.Form.gcCompany.Size(10350,2295)
Gui.Form.gcCompany.Position(210,345)
Gui.Form.gcCompany.Parent("frameHdrInfo")
Gui.Form.gcCompany.TabStop(True)
Gui.Form.gcCompany.TabIndex(1)
Gui.Form.gcCompany.Anchor(14)
Gui.Form.gcSubmitter.Create(GsGridControl)
Gui.Form.gcSubmitter.Size(10350,3510)
Gui.Form.gcSubmitter.Position(180,2865)
Gui.Form.gcSubmitter.Parent("frameHdrInfo")
Gui.Form.gcSubmitter.Event(CellValueChanged,gcSubmitter_CellValueChanged)
Gui.Form.gcSubmitter.TabStop(True)
Gui.Form.gcSubmitter.TabIndex(2)
Gui.Form.gcSubmitter.Anchor(14)
Gui.Form.lbl9.Create(Label,"Company Information",True,2655,225,0,180,180,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl9.Parent("frameHdrInfo")
Gui.Form.lbl9.Anchor(14)
Gui.Form.lbl10.Create(Label,"Submitter Information",True,2460,210,0,180,2700,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl10.Parent("frameHdrInfo")
Gui.Form.lbl10.Anchor(14)
Gui.Form.gcContact.Create(GsGridControl)
Gui.Form.gcContact.Size(10350,1980)
Gui.Form.gcContact.Position(180,6600)
Gui.Form.gcContact.Parent("frameHdrInfo")
Gui.Form.gcContact.Event(CellValueChanged,gcContact_CellValueChanged)
Gui.Form.gcContact.TabStop(True)
Gui.Form.gcContact.TabIndex(3)
Gui.Form.gcContact.Anchor(14)
Gui.Form.lbl11.Create(Label,"Contact Information",True,2460,255,0,180,6435,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl11.Parent("frameHdrInfo")
Gui.Form.lbl11.Anchor(14)
Gui.Form.txtW2Save.Create(TextBox,"",True,9540,300,0,165,8820,True,0,"Arial",8,-2147483643,1)
Gui.Form.txtW2Save.Parent("frameHdrInfo")
Gui.Form.txtW2Save.Locked(True)
Gui.Form.txtW2Save.TabStop(True)
Gui.Form.txtW2Save.TabIndex(4)
Gui.Form.txtW2Save.Anchor(14)
Gui.Form.txtESaveFile.Create(TextBox,"",True,9540,300,0,180,9330,True,0,"Arial",8,-2147483643,1)
Gui.Form.txtESaveFile.Parent("frameHdrInfo")
Gui.Form.txtESaveFile.Locked(True)
Gui.Form.txtESaveFile.TabStop(True)
Gui.Form.txtESaveFile.TabIndex(6)
Gui.Form.txtESaveFile.Anchor(14)
Gui.Form.lbl41.Create(Label,"W-2 PDF Save path",True,1935,195,0,150,8655,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl41.Parent("frameHdrInfo")
Gui.Form.lbl41.Anchor(14)
Gui.Form.lbl40.Create(Label,"Electronic File Save Path",True,1935,180,0,150,9180,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl40.Parent("frameHdrInfo")
Gui.Form.lbl40.Anchor(14)
Gui.Form.cmdEletronicFilesavePath.Create(Button)
Gui.Form.cmdEletronicFilesavePath.Size(390,375)
Gui.Form.cmdEletronicFilesavePath.Position(9810,9285)
Gui.Form.cmdEletronicFilesavePath.Parent("frameHdrInfo")
Gui.Form.cmdEletronicFilesavePath.DefaultValue("")
Gui.Form.cmdEletronicFilesavePath.Caption("^")
Gui.Form.cmdEletronicFilesavePath.Event(Click,cmdEletronicFilesavePath_Click)
Gui.Form.cmdEletronicFilesavePath.TabStop(True)
Gui.Form.cmdEletronicFilesavePath.TabIndex(7)
Gui.Form.cmdEletronicFilesavePath.Anchor(10)
Gui.Form.cmdw2savepath.Create(Button)
Gui.Form.cmdw2savepath.Size(390,375)
Gui.Form.cmdw2savepath.Position(9810,8775)
Gui.Form.cmdw2savepath.Parent("frameHdrInfo")
Gui.Form.cmdw2savepath.DefaultValue("")
Gui.Form.cmdw2savepath.Caption("^")
Gui.Form.cmdw2savepath.Event(Click,cmdw2savepath_Click)
Gui.Form.cmdw2savepath.TabStop(True)
Gui.Form.cmdw2savepath.TabIndex(5)
Gui.Form.cmdw2savepath.Anchor(10)
Gui.Form.frmW2Header.Create(Frame)
Gui.Form.frmW2Header.Size(5715,6345)
Gui.Form.frmW2Header.Position(240,945)
Gui.Form.frmW2Header.Parent("tab1",1)
Gui.Form.frmW2Header.BorderStyle(0)
Gui.Form.frmW2Header.Zorder(2)
Gui.Form.txtEIN.Create(TextBox,"",True,5520,300,0,75,825,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtEIN.Parent("frmW2Header")
Gui.Form.txtEmpeeFirstName.Create(TextBox,"",True,2040,300,0,90,3825,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtEmpeeFirstName.Parent("frmW2Header")
Gui.Form.txtEmpeeSuff.Create(TextBox,"",True,480,300,0,5145,3825,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtEmpeeSuff.Parent("frmW2Header")
Gui.Form.txtEmpeeLastName.Create(TextBox,"",True,2415,300,0,2670,3825,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtEmpeeLastName.Parent("frmW2Header")
Gui.Form.txtControlNumber.Create(TextBox,"",True,5535,300,0,75,3225,True,0,"Arial",8,-2147483643,1)
Gui.Form.txtControlNumber.Parent("frmW2Header")
Gui.Form.txtControlNumber.TabStop(True)
Gui.Form.txtControlNumber.TabIndex(16)
Gui.Form.txtControlNumber.MaxLength(50)
Gui.Form.txtControlNumber.Event(Change,txtControlNumber_Change)
Gui.Form.lbl14.Create(Label,"d Control Number",True,1935,255,0,60,3000,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl14.Parent("frmW2Header")
Gui.Form.lbl13.Create(Label,"e Employee's first name and initial",True,2595,255,0,90,3615,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl13.Parent("frmW2Header")
Gui.Form.lbl12.Create(Label,"c Employer's name, address, and ZIP code",True,3135,255,0,75,1185,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl12.Parent("frmW2Header")
Gui.Form.lbl5.Create(Label,"b Employer identification number (EIN)",True,3045,255,0,60,570,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl5.Parent("frmW2Header")
Gui.Form.lbl4.Create(Label,"f Employee's address and ZIP code",True,2760,255,0,75,4290,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl4.Parent("frmW2Header")
Gui.Form.lbl3.Create(Label,"Suff.",True,645,255,0,5130,3615,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl3.Parent("frmW2Header")
Gui.Form.lbl2.Create(Label,"Last name",True,1935,255,0,2670,3615,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl2.Parent("frmW2Header")
Gui.Form.txtEmployerInfo.Create(TextboxM)
Gui.Form.txtEmployerInfo.Size(5505,1530)
Gui.Form.txtEmployerInfo.Position(90,1380)
Gui.Form.txtEmployerInfo.Parent("frmW2Header")
Gui.Form.txtEmployerInfo.Enabled(False)
Gui.Form.txtEmpeeAddress.Create(TextboxM)
Gui.Form.txtEmpeeAddress.Size(5535,1620)
Gui.Form.txtEmpeeAddress.Position(120,4515)
Gui.Form.txtEmpeeAddress.Parent("frmW2Header")
Gui.Form.txtEmpeeAddress.Enabled(False)
Gui.Form.lblEmpSoc.Create(Label,"a Employee's social security number",True,2790,255,0,2880,180,True,0,"Arial",8,-2147483633,0)
Gui.Form.lblEmpSoc.Parent("frmW2Header")
Gui.Form.txtEmpSoc.Create(TextBox,"",True,2550,300,0,3045,435,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtEmpSoc.Parent("frmW2Header")
Gui.Form.txtInitial.Create(TextBox,"",True,465,300,0,2145,3825,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtInitial.Parent("frmW2Header")
Gui.Form.txtInitial.Locked(True)
Gui.Form.frmWages.Create(Frame)
Gui.Form.frmWages.Size(5595,5970)
Gui.Form.frmWages.Position(6030,1215)
Gui.Form.frmWages.Parent("tab1",1)
Gui.Form.frmWages.BorderStyle(0)
Gui.Form.lbl24.Create(Label,"Plan",True,420,255,0,1215,4050,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl24.Parent("frmWages")
Gui.Form.lbl23.Create(Label,"Retirement",True,945,255,0,1005,3825,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl23.Parent("frmWages")
Gui.Form.lbl22.Create(Label,"Employee",True,810,255,0,150,4065,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl22.Parent("frmWages")
Gui.Form.lbl21.Create(Label,"13 Statutory",True,1020,255,0,45,3825,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl21.Parent("frmWages")
Gui.Form.lbl19.Create(Label,"11 Nonqualified plans",True,1935,255,0,75,3180,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl19.Parent("frmWages")
Gui.Form.lbl18.Create(Label,"Third-party",True,915,255,0,1890,3825,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl18.Parent("frmWages")
Gui.Form.lbl17.Create(Label,"3 Social security wages",True,1935,255,0,75,795,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl17.Parent("frmWages")
Gui.Form.lbl16.Create(Label,"9 Verification code",True,1935,255,0,75,2565,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl16.Parent("frmWages")
Gui.Form.lbl15.Create(Label,"2 Federal income tax withheld",True,2340,255,0,2790,210,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl15.Parent("frmWages")
Gui.Form.lbl8.Create(Label,"7 Social security tips",True,1935,255,0,75,1965,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl8.Parent("frmWages")
Gui.Form.lbl7.Create(Label,"1 Wages, tips, other compensation",True,2700,255,0,75,210,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl7.Parent("frmWages")
Gui.Form.lbl6.Create(Label,"5 Medicare wages and tips",True,2280,255,0,75,1395,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl6.Parent("frmWages")
Gui.Form.txtBox12ADesc.Create(TextBox,"",True,1905,300,0,3465,3390,True,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox12ADesc.Parent("frmWages")
Gui.Form.txtBox12ADesc.Event(Change,txtBox12aDesc_Change)
Gui.Form.txtBox12ADesc.TabStop(True)
Gui.Form.txtBox12ADesc.TabIndex(22)
Gui.Form.txtBox12ADesc.NumericOnly(1)
Gui.Form.txtBox2.Create(TextBox,"",True,2580,300,0,2790,405,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox2.Parent("frmWages")
Gui.Form.txtBox2.Mask("#####.00")
Gui.Form.txt12DCode.Create(TextBox,"",True,615,300,0,2790,5130,True,0,"Arial",8,-2147483643,1)
Gui.Form.txt12DCode.Parent("frmWages")
Gui.Form.txt12DCode.Event(Change,txt12dCode_Change)
Gui.Form.txt12DCode.TabStop(True)
Gui.Form.txt12DCode.TabIndex(27)
Gui.Form.txt12DCode.MaxLength(2)
Gui.Form.txtBox10.Create(TextBox,"",True,2580,300,0,2790,2790,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox10.Parent("frmWages")
Gui.Form.txt12CCode.Create(TextBox,"",True,615,300,0,2790,4515,True,0,"Arial",8,-2147483643,1)
Gui.Form.txt12CCode.Parent("frmWages")
Gui.Form.txt12CCode.Event(Change,txt12cCode_Change)
Gui.Form.txt12CCode.TabStop(True)
Gui.Form.txt12CCode.TabIndex(25)
Gui.Form.txt12CCode.MaxLength(2)
Gui.Form.txtBox8.Create(TextBox,"",True,2580,300,0,2790,2175,True,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox8.Parent("frmWages")
Gui.Form.txtBox8.Event(Change,txtBox8_Change)
Gui.Form.txtBox8.TabStop(True)
Gui.Form.txtBox8.TabIndex(18)
Gui.Form.txtBox8.NumericOnly(1)
Gui.Form.txt12BCode.Create(TextBox,"",True,615,300,0,2790,3960,True,0,"Arial",8,-2147483643,1)
Gui.Form.txt12BCode.Parent("frmWages")
Gui.Form.txt12BCode.Event(Change,txt12BCode_Change)
Gui.Form.txt12BCode.TabStop(True)
Gui.Form.txt12BCode.TabIndex(23)
Gui.Form.txt12BCode.MaxLength(2)
Gui.Form.txtBox12ACode.Create(TextBox,"",True,615,300,0,2790,3390,True,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox12ACode.Parent("frmWages")
Gui.Form.txtBox12ACode.Event(Change,txtBox12ACode_Change)
Gui.Form.txtBox12ACode.TabStop(True)
Gui.Form.txtBox12ACode.TabIndex(21)
Gui.Form.txtBox12ACode.MaxLength(2)
Gui.Form.txtBox6.Create(TextBox,"",True,2580,300,0,2790,1590,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox6.Parent("frmWages")
Gui.Form.txtBox6.Mask("#####.00")
Gui.Form.txtBox4.Create(TextBox,"",True,2580,300,0,2790,1005,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox4.Parent("frmWages")
Gui.Form.txtBox4.Mask("#####.00")
Gui.Form.txtBox11.Create(TextBox,"",True,2580,300,0,75,3390,True,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox11.Parent("frmWages")
Gui.Form.txtBox11.Event(Change,txtBox11_Change)
Gui.Form.txtBox11.TabStop(True)
Gui.Form.txtBox11.TabIndex(20)
Gui.Form.txtBox11.NumericOnly(1)
Gui.Form.txtBox9.Create(TextBox,"",True,2580,300,0,75,2790,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox9.Parent("frmWages")
Gui.Form.txtBox9.Event(Change,txtBox9_Change)
Gui.Form.txtBox9.TabStop(True)
Gui.Form.txtBox9.TabIndex(19)
Gui.Form.txtBox9.NumericOnly(1)
Gui.Form.txtBox9.MaxLength(40)
Gui.Form.txtBox7.Create(TextBox,"",True,2580,300,0,75,2175,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox7.Parent("frmWages")
Gui.Form.txtBox7.TabStop(True)
Gui.Form.txtBox7.TabIndex(17)
Gui.Form.txtBox5.Create(TextBox,"",True,2580,300,0,75,1590,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox5.Parent("frmWages")
Gui.Form.txtBox5.Mask("#####.00")
Gui.Form.txtBox3.Create(TextBox,"",True,2580,300,0,75,1005,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox3.Parent("frmWages")
Gui.Form.txtBox3.Mask("#####.00")
Gui.Form.txtBox1.Create(TextBox,"",True,2580,300,0,75,405,False,0,"Arial",8,-2147483643,1)
Gui.Form.txtBox1.Parent("frmWages")
Gui.Form.txtBox1.Mask("#####.00")
Gui.Form.chkThirdParty.Create(CheckBox)
Gui.Form.chkThirdParty.Size(300,360)
Gui.Form.chkThirdParty.Position(2235,4245)
Gui.Form.chkThirdParty.Parent("frmWages")
Gui.Form.chkThirdParty.Event(Click,chkThirdParty_Click)
Gui.Form.chkStatEmpl.Create(CheckBox)
Gui.Form.chkStatEmpl.Size(315,360)
Gui.Form.chkStatEmpl.Position(420,4230)
Gui.Form.chkStatEmpl.Parent("frmWages")
Gui.Form.chkStatEmpl.Event(Click,chkStatEmpl_Click)
Gui.Form.chkRetPlan.Create(CheckBox)
Gui.Form.chkRetPlan.Size(270,360)
Gui.Form.chkRetPlan.Position(1305,4230)
Gui.Form.chkRetPlan.Parent("frmWages")
Gui.Form.chkRetPlan.Event(Click,chkRetPlan_Click)
Gui.Form.txtBox14.Create(TextboxM)
Gui.Form.txtBox14.Size(2670,1050)
Gui.Form.txtBox14.Position(75,4815)
Gui.Form.txtBox14.Parent("frmWages")
Gui.Form.txtBox14.Event(Change,txtBox14_Change)
Gui.Form.txtBox14.TabStop(True)
Gui.Form.txtBox14.TabIndex(29)
Gui.Form.txtBox14.ToolTip("Separate the Code Description and Amount by a space.  One Code Description/Amount per line. Omit $ sign")
Gui.Form.lbl36.Create(Label,"12c",True,615,255,0,2790,4320,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl36.Parent("frmWages")
Gui.Form.lbl35.Create(Label,"6 Medicare tax withheld",True,1935,255,0,2790,1395,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl35.Parent("frmWages")
Gui.Form.lbl34.Create(Label,"12d",True,555,255,0,2790,4890,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl34.Parent("frmWages")
Gui.Form.lbl33.Create(Label,"8 Allocated tips",True,1935,255,0,2790,1965,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl33.Parent("frmWages")
Gui.Form.lbl30.Create(Label,"sick pay",True,735,255,0,1980,4050,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl30.Parent("frmWages")
Gui.Form.lbl32.Create(Label,"12b",True,450,255,0,2790,3750,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl32.Parent("frmWages")
Gui.Form.lbl29.Create(Label,"14 Other",True,1935,255,0,75,4605,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl29.Parent("frmWages")
Gui.Form.lbl28.Create(Label,"12a",True,405,285,0,2790,3165,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl28.Parent("frmWages")
Gui.Form.lbl31.Create(Label,"10 Dependent care benefits",True,1935,255,0,2805,2565,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl31.Parent("frmWages")
Gui.Form.lbl27.Create(Label,"4 Social security tax withheld",True,1935,255,0,2790,795,True,0,"Arial",8,-2147483633,0)
Gui.Form.lbl27.Parent("frmWages")
Gui.Form.txt12BDesc.Create(TextBox,"",True,1905,300,0,3495,3960,True,0,"Arial",8,-2147483643,1)
Gui.Form.txt12BDesc.Parent("frmWages")
Gui.Form.txt12BDesc.Event(Change,txt12bDesc_Change)
Gui.Form.txt12BDesc.TabStop(True)
Gui.Form.txt12BDesc.TabIndex(24)
Gui.Form.txt12BDesc.NumericOnly(1)
Gui.Form.txt12CDesc.Create(TextBox,"",True,1905,300,0,3495,4515,True,0,"Arial",8,-2147483643,1)
Gui.Form.txt12CDesc.Parent("frmWages")
Gui.Form.txt12CDesc.Event(Change,txt12cDesc_Change)
Gui.Form.txt12CDesc.TabStop(True)
Gui.Form.txt12CDesc.TabIndex(26)
Gui.Form.txt12CDesc.NumericOnly(1)
Gui.Form.txt4.Create(TextBox,"",True,1845,300,0,-300840,-491520,True,0,"Arial",8,-2147483643,1)
Gui.Form.txt4.Parent("frmWages")
Gui.Form.txt12DDesc.Create(TextBox,"",True,1905,300,0,3495,5130,True,0,"Arial",8,-2147483643,1)
Gui.Form.txt12DDesc.Parent("frmWages")
Gui.Form.txt12DDesc.Event(Change,txt12dDesc_Change)
Gui.Form.txt12DDesc.TabStop(True)
Gui.Form.txt12DDesc.TabIndex(28)
Gui.Form.txt12DDesc.NumericOnly(1)
Gui.Form.frmStateGrid.Create(Frame)
Gui.Form.frmStateGrid.Size(11415,2385)
Gui.Form.frmStateGrid.Position(195,7320)
Gui.Form.frmStateGrid.Parent("tab1",1)
Gui.Form.frmStateGrid.BorderStyle(0)
Gui.Form.gcState.Create(GsGridControl)
Gui.Form.gcState.Size(11250,1875)
Gui.Form.gcState.Position(90,210)
Gui.Form.gcState.Parent("frmStateGrid")
Gui.Form.gcState.TabStop(True)
Gui.Form.gcState.TabIndex(30)
Gui.Form.gcState.Event(CellValueChanged,gcState_CellValueChanged)
Gui.Form.txtEmpID.Create(TextBox,"",True,1215,300,0,255,450,True,0,"Arial",8,-2147483643,1)
Gui.Form.txtEmpID.Parent("tab1",1)
Gui.Form.txtEmpID.Event(LostFocus,txtEmpID_LostFocus)
Gui.Form.txtEmpID.TabStop(True)
Gui.Form.txtEmpID.TabIndex(10)
Gui.Form.txtEmpID.MaxLength(5)
Gui.Form.txtEmpID.Event(GotFocus,txtEmpID_GotFocus)
Gui.Form.txtEmpID.NumericOnly(2)
Gui.Form.cmdEmpBrowse.Create(Button)
Gui.Form.cmdEmpBrowse.Size(375,375)
Gui.Form.cmdEmpBrowse.Position(1545,420)
Gui.Form.cmdEmpBrowse.Parent("tab1",1)
Gui.Form.cmdEmpBrowse.DefaultValue("")
Gui.Form.cmdEmpBrowse.Caption("^")
Gui.Form.cmdEmpBrowse.Event(Click,cmdEmpBrowse_Click)
Gui.Form.cmdEmpBrowse.TabStop(True)
Gui.Form.cmdEmpBrowse.TabIndex(11)
Gui.Form.cmdEmpBrowse.ControlGroup(1)
Gui.Form.lblEmpID.Create(Label,"Employee ID",True,1350,300,0,240,165,True,0,"Arial",8,-2147483633,0)
Gui.Form.lblEmpID.Parent("tab1",1)
Gui.Form.cmdEmpNext.Create(Button)
Gui.Form.cmdEmpNext.Size(375,375)
Gui.Form.cmdEmpNext.Position(2925,420)
Gui.Form.cmdEmpNext.Parent("tab1",1)
Gui.Form.cmdEmpNext.Event(Click,cmdEmpNext_Click)
Gui.Form.cmdEmpNext.TabStop(True)
Gui.Form.cmdEmpNext.TabIndex(14)
Gui.Form.cmdEmpNext.ControlGroup(1)
Gui.Form.cmdEmpPrev.Create(Button)
Gui.Form.cmdEmpPrev.Size(375,375)
Gui.Form.cmdEmpPrev.Position(2535,420)
Gui.Form.cmdEmpPrev.Parent("tab1",1)
Gui.Form.cmdEmpPrev.Event(Click,cmdEmpPrev_Click)
Gui.Form.cmdEmpPrev.TabStop(True)
Gui.Form.cmdEmpPrev.TabIndex(13)
Gui.Form.cmdEmpPrev.ControlGroup(1)
Gui.Form.cmdEmpLast.Create(Button)
Gui.Form.cmdEmpLast.Size(480,375)
Gui.Form.cmdEmpLast.Position(3300,420)
Gui.Form.cmdEmpLast.Parent("tab1",1)
Gui.Form.cmdEmpLast.Event(Click,cmdEmpLast_Click)
Gui.Form.cmdEmpLast.TabStop(True)
Gui.Form.cmdEmpLast.TabIndex(15)
Gui.Form.cmdEmpLast.ControlGroup(1)
Gui.Form.cmdEmpFirst.Create(Button)
Gui.Form.cmdEmpFirst.Size(480,375)
Gui.Form.cmdEmpFirst.Position(2055,420)
Gui.Form.cmdEmpFirst.Parent("tab1",1)
Gui.Form.cmdEmpFirst.Event(Click,cmdEmpFirst_Click)
Gui.Form.cmdEmpFirst.TabStop(True)
Gui.Form.cmdEmpFirst.TabIndex(12)
Gui.Form.cmdEmpFirst.ControlGroup(1)
Gui.Form.cmdPrint.Create(Button)
Gui.Form.cmdPrint.Size(975,375)
Gui.Form.cmdPrint.Position(1290,10230)
Gui.Form.cmdPrint.Caption("Print")
Gui.Form.cmdPrint.Event(Click,cmdPrint_Click1)
Gui.Form.cmdPrint.TabStop(True)
Gui.Form.cmdPrint.TabIndex(32)
Gui.Form.cmdPrint.Anchor(6)
Gui.Form.timerSave.Create(Timer)
Gui.Form.timerSave.Size(495,495)
Gui.Form.timerSave.Position(5400,11385)
Gui.Form.timerSave.Event(Timer,timerSave_Timer)
Gui.Form.lblSave.Create(Label,"Changes saved...",False,1935,255,0,2385,10365,True,0,"Arial",8,-2147483633,0)
Gui.Form.lblSave.FontStyle(False,True,False,False,False)
Gui.Form.lblSave.ForeColor(255)
Gui.Form.lblSave.Anchor(6)
Gui.FormPrint..Create
Gui.FormPrint..Caption("W2 Print Selection")
Gui.FormPrint..Size(5520,5670)
Gui.FormPrint..MinX(0)
Gui.FormPrint..MinY(0)
Gui.FormPrint..Position(0,0)
Gui.FormPrint..BackColor(-2147483633)
Gui.FormPrint..MousePointer(0)
Gui.FormPrint..Event(UnLoad,Form_UnLoad)
Gui.FormPrint..MaxButton(False)
Gui.FormPrint..Sizeable(False)
Gui.FormPrint.lbl1.Create(Label,"Beginning Employee",True,1935,255,0,45,225,True,0,"Arial",8,-2147483633,0)
Gui.FormPrint.lbl2.Create(Label,"Ending Employee",True,1935,255,0,2100,210,True,0,"Arial",8,-2147483633,0)
Gui.FormPrint.cmdBegEmpBrowse.Create(Button)
Gui.FormPrint.cmdBegEmpBrowse.Size(405,375)
Gui.FormPrint.cmdBegEmpBrowse.Position(1605,420)
Gui.FormPrint.cmdBegEmpBrowse.Caption("^")
Gui.FormPrint.cmdBegEmpBrowse.Event(Click,cmdBegEmpBrowse_Click)
Gui.FormPrint.cmdBegEmpBrowse.TabStop(True)
Gui.FormPrint.cmdBegEmpBrowse.TabIndex(2)
Gui.FormPrint.cmdEndEmpBrowse.Create(Button)
Gui.FormPrint.cmdEndEmpBrowse.Size(405,375)
Gui.FormPrint.cmdEndEmpBrowse.Position(3675,420)
Gui.FormPrint.cmdEndEmpBrowse.Caption("^")
Gui.FormPrint.cmdEndEmpBrowse.Event(Click,cmdEndEmpBrowse_Click)
Gui.FormPrint.cmdEndEmpBrowse.TabStop(True)
Gui.FormPrint.cmdEndEmpBrowse.TabIndex(4)
Gui.FormPrint.cmdAdd.Create(Button)
Gui.FormPrint.cmdAdd.Size(855,375)
Gui.FormPrint.cmdAdd.Position(4230,420)
Gui.FormPrint.cmdAdd.Caption("Add")
Gui.FormPrint.cmdAdd.DefaultValue("")
Gui.FormPrint.cmdAdd.Event(Click,cmdAdd_Click)
Gui.FormPrint.cmdAdd.TabStop(True)
Gui.FormPrint.cmdAdd.TabIndex(5)
Gui.FormPrint.cmdDelete.Create(Button)
Gui.FormPrint.cmdDelete.Size(855,375)
Gui.FormPrint.cmdDelete.Position(90,3495)
Gui.FormPrint.cmdDelete.Caption("Delete")
Gui.FormPrint.cmdDelete.Event(Click,cmdDelete_Click)
Gui.FormPrint.cmdDelete.TabStop(True)
Gui.FormPrint.cmdDelete.TabIndex(7)
Gui.FormPrint.cmdClear.Create(Button)
Gui.FormPrint.cmdClear.Size(855,375)
Gui.FormPrint.cmdClear.Position(990,3495)
Gui.FormPrint.cmdClear.Caption("Clear")
Gui.FormPrint.cmdClear.Event(Click,cmdClear_Click)
Gui.FormPrint.cmdClear.TabStop(True)
Gui.FormPrint.cmdClear.TabIndex(8)
Gui.FormPrint.chkAllEmp.Create(CheckBox)
Gui.FormPrint.chkAllEmp.Size(2430,360)
Gui.FormPrint.chkAllEmp.Position(120,810)
Gui.FormPrint.chkAllEmp.Caption("All Employees")
Gui.FormPrint.chkAllEmp.Event(Click,chkAllEmp_Click)
Gui.FormPrint.chkAllEmp.TabStop(True)
Gui.FormPrint.chkAllEmp.TabIndex(6)
Gui.FormPrint.txtBegEmp.Create(TextBox,"",True,1440,300,0,105,450,True,0,"Arial",8,-2147483643,1)
Gui.FormPrint.txtBegEmp.Event(GotFocus,txtBegEmp_GotFocus)
Gui.FormPrint.txtBegEmp.Event(LostFocus,txtBegEmp_LostFocus)
Gui.FormPrint.txtBegEmp.TabStop(True)
Gui.FormPrint.txtBegEmp.TabIndex(1)
Gui.FormPrint.txtBegEmp.MaxLength(5)
Gui.FormPrint.txtEndEmp.Create(TextBox,"",True,1440,300,0,2100,450,True,0,"Arial",8,-2147483643,1)
Gui.FormPrint.txtEndEmp.Event(GotFocus,txtEndEmp_GotFocus)
Gui.FormPrint.txtEndEmp.TabStop(True)
Gui.FormPrint.txtEndEmp.TabIndex(3)
Gui.FormPrint.txtEndEmp.MaxLength(5)
Gui.FormPrint.lvwEmp.Create(ListView)
Gui.FormPrint.lvwEmp.Size(4995,2145)
Gui.FormPrint.lvwEmp.Position(120,1230)
Gui.FormPrint.lvwEmp.View(3)
Gui.FormPrint.lvwEmp.AddListViewColumn("Beginning Employee",2496,0)
Gui.FormPrint.lvwEmp.AddListViewColumn("Ending Employee",2496,0)
Gui.FormPrint.cmdPrint.Create(Button)
Gui.FormPrint.cmdPrint.Size(855,375)
Gui.FormPrint.cmdPrint.Position(105,4620)
Gui.FormPrint.cmdPrint.Caption("Print")
Gui.FormPrint.cmdPrint.Event(Click,cmdPrint_Click)
Gui.FormPrint.cmdPrint.TabStop(True)
Gui.FormPrint.cmdPrint.TabIndex(11)
Gui.FormPrint.chkTermEmployeesOnly.Create(CheckBox)
Gui.FormPrint.chkTermEmployeesOnly.Size(3060,360)
Gui.FormPrint.chkTermEmployeesOnly.Position(105,3945)
Gui.FormPrint.chkTermEmployeesOnly.Caption("Print Terminated Employees Only")
Gui.FormPrint.chkTermEmployeesOnly.Event(Click,chkTermEmployeesOnly_Click)
Gui.FormPrint.chkTermEmployeesOnly.TabStop(True)
Gui.FormPrint.chkTermEmployeesOnly.TabIndex(9)
Gui.FormPrint.chkElecFile.Create(CheckBox)
Gui.FormPrint.chkElecFile.Size(2760,360)
Gui.FormPrint.chkElecFile.Position(105,4245)
Gui.FormPrint.chkElecFile.Caption("Generate Electronic File")
Gui.FormPrint.chkElecFile.Visible(False)
Gui.FormPrint.chkElecFile.TabStop(True)
Gui.FormPrint.chkElecFile.TabIndex(10)
Gui.FormSelect..Create
Gui.FormSelect..Caption("W-2 Printing Options")
Gui.FormSelect..Size(4575,5970)
Gui.FormSelect..MinX(0)
Gui.FormSelect..MinY(0)
Gui.FormSelect..Position(0,0)
Gui.FormSelect..BackColor(-2147483633)
Gui.FormSelect..MousePointer(0)
Gui.FormSelect..Event(UnLoad,Form_UnLoad)
Gui.FormSelect..Sizeable(False)
Gui.FormSelect..MaxButton(False)
Gui.FormSelect.cmdPrintPDF.Create(Button)
Gui.FormSelect.cmdPrintPDF.Size(1335,375)
Gui.FormSelect.cmdPrintPDF.Position(105,5010)
Gui.FormSelect.cmdPrintPDF.Caption("Print")
Gui.FormSelect.cmdPrintPDF.Event(Click,cmdPrintPDF_Click)
Gui.FormSelect.cmdPrintPDF.TabStop(True)
Gui.FormSelect.cmdPrintPDF.TabIndex(1)
Gui.FormSelect.copies.Create(Frame)
Gui.FormSelect.copies.Size(4095,3615)
Gui.FormSelect.copies.Position(90,90)
Gui.FormSelect.copies.Caption("Select copies to print")
Gui.FormSelect.chk1Employer.Create(CheckBox)
Gui.FormSelect.chk1Employer.Size(1560,360)
Gui.FormSelect.chk1Employer.Position(240,2610)
Gui.FormSelect.chk1Employer.Parent("copies")
Gui.FormSelect.chk1Employer.Caption("Employer")
Gui.FormSelect.chk1Employer.Event(Click,Disable_Perf_Controls)
Gui.FormSelect.chk1Filing.Create(CheckBox)
Gui.FormSelect.chk1Filing.Size(2985,360)
Gui.FormSelect.chk1Filing.Position(240,3030)
Gui.FormSelect.chk1Filing.Parent("copies")
Gui.FormSelect.chk1Filing.Caption("Employee Filing Instructions")
Gui.FormSelect.chk1Filing.Event(Click,Disable_Perf_Controls)
Gui.FormSelect.chk1Employee.Create(CheckBox)
Gui.FormSelect.chk1Employee.Size(1560,360)
Gui.FormSelect.chk1Employee.Position(240,2145)
Gui.FormSelect.chk1Employee.Parent("copies")
Gui.FormSelect.chk1Employee.Caption("Employee")
Gui.FormSelect.chk1Employee.Event(Click,Disable_Perf_Controls)
Gui.FormSelect.chk1Federal.Create(CheckBox)
Gui.FormSelect.chk1Federal.Size(1560,360)
Gui.FormSelect.chk1Federal.Position(240,1665)
Gui.FormSelect.chk1Federal.Parent("copies")
Gui.FormSelect.chk1Federal.Caption("Federal")
Gui.FormSelect.chk1Federal.Event(Click,Disable_Perf_Controls)
Gui.FormSelect.chk1State2.Create(CheckBox)
Gui.FormSelect.chk1State2.Size(1560,360)
Gui.FormSelect.chk1State2.Position(240,1215)
Gui.FormSelect.chk1State2.Parent("copies")
Gui.FormSelect.chk1State2.Caption("State 2")
Gui.FormSelect.chk1State2.Event(Click,Disable_Perf_Controls)
Gui.FormSelect.chk1State1.Create(CheckBox)
Gui.FormSelect.chk1State1.Size(1560,360)
Gui.FormSelect.chk1State1.Position(240,720)
Gui.FormSelect.chk1State1.Parent("copies")
Gui.FormSelect.chk1State1.Caption("State 1")
Gui.FormSelect.chk1State1.Event(Click,Disable_Perf_Controls)
Gui.FormSelect.chk1AllCopies.Create(CheckBox)
Gui.FormSelect.chk1AllCopies.Size(1560,360)
Gui.FormSelect.chk1AllCopies.Position(240,270)
Gui.FormSelect.chk1AllCopies.Parent("copies")
Gui.FormSelect.chk1AllCopies.Caption("All Copies")
Gui.FormSelect.chk1AllCopies.Event(Click,chk1AllCopies_Click)
Gui.FormSelect.pFormSelects.Create(Frame)
Gui.FormSelect.pFormSelects.Size(4095,1230)
Gui.FormSelect.pFormSelects.Position(90,3705)
Gui.FormSelect.pFormSelects.Caption("Perforated FormSelect Options")
Gui.FormSelect.chkFedEmp.Create(CheckBox)
Gui.FormSelect.chkFedEmp.Size(3435,360)
Gui.FormSelect.chkFedEmp.Position(210,345)
Gui.FormSelect.chkFedEmp.Parent("pFormSelects")
Gui.FormSelect.chkFedEmp.Caption("Federal and Employee")
Gui.FormSelect.chkFedEmp.Event(Click,chkFedEmp_Click)
Gui.FormSelect.chkStates1and2.Create(CheckBox)
Gui.FormSelect.chkStates1and2.Size(2685,360)
Gui.FormSelect.chkStates1and2.Position(210,750)
Gui.FormSelect.chkStates1and2.Parent("pFormSelects")
Gui.FormSelect.chkStates1and2.Caption("State 1 and State 2")
Gui.FormSelect.chkStates1and2.Event(Click,chkStates1and2_Click)
Gui.F_Progress..Create
Gui.F_Progress..Caption("Printing")
Gui.F_Progress..Size(6405,1455)
Gui.F_Progress..MinX(0)
Gui.F_Progress..MinY(0)
Gui.F_Progress..Position(0,0)
Gui.F_Progress..BackColor(-2147483633)
Gui.F_Progress..MousePointer(0)
Gui.F_Progress..Event(UnLoad,Form_UnLoad)
Gui.F_Progress..MaxButton(False)
Gui.F_Progress..Sizeable(False)
Gui.F_Progress.progressBar1.Create(ProgressBar)
Gui.F_Progress.progressBar1.Size(6000,390)
Gui.F_Progress.progressBar1.Position(60,300)
Gui.F_Progress.lblProgress.Create(Label,"",True,1935,255,0,45,90,True,0,"Arial",8,-986896,0)
Gui.F_Progress.lblEFile.Create(Label,"",False,5940,795,0,120,900,True,0,"Arial",8,-2147483633,0)
Program.Sub.ScreenSU.End

Program.Sub.Preflight.Start
v.Global.bChange.Declare(Boolean,False)
v.Global.iBIRUNID.Declare(Long,0)
v.Global.iYear.Declare(Long,0)
v.Global.iRWCount.Declare(Long,0) 
v.Global.iROCount.Declare(Long,0)
v.Global.bContactChange.Declare(Boolean,False)
v.Global.bStateChange.Declare(Boolean,False)
v.global.sClear.Declare(String)
v.Global.iKey.Declare(Long)
v.Global.iRowCount.Declare(Long,-1)
v.Global.sEmpID.Declare(String)
Program.Sub.Preflight.End

Program.Sub.Main.Start
F.Intrinsic.Control.SetErrorHandler("Main_ERR")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sTemp.Declare
v.Global.iBIRUNID.Set(v.Passed.BSI007-RUN-ID)
v.Global.iYear.Set(v.Passed.WS-W2-Year)
v.global.sClear.Set(v.Passed.WS-W2-CLEAR)
V.Local.bRet.Declare(Boolean,False)
F.Intrinsic.Control.If(V.Ambient.IsGab2,=,False)
	F.Intrinsic.UI.Msgbox("Runtime Version on Hook 48260 must be set to 2.00","Invalid Runtime Version")
	F.Intrinsic.Control.CallSub(form_unload)
F.Intrinsic.Control.Endif
F.ODBC.Connection!conX.OpenCompanyConnection
'load images and icons
Function.Intrinsic.Control.CallSub(art)
'table check
Function.Intrinsic.Control.CallSub(TableCheck)
'loaddefaultvals
Function.Intrinsic.Control.CallSub(defaultvals)
'LoadData
F.Intrinsic.Control.CallSub(LoadData)
F.Intrinsic.Control.CallSub(PayrollSecurity)
'for help with the prev and next buttons
F.Data.DataTable.AddColumn("dtEmp","SortCol","Long")
F.Data.DataView.Create("dtEmp","dvEmpSort",22,"","[Employee] Asc")
F.Data.DataView.SetSeries("dtEmp","dvEmpSort","SortCol",0,1)
Gui.Form.tab1.settab(0)
Gui.Form..Show
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Main_ERR")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.Main.End

Program.Sub.Form_UnLoad.Start
'clear out y table.s
F.ODBC.Connection!conX.Execute("Delete From Y_PY_W2_HDR")
F.ODBC.Connection!conX.Execute("Delete From Y_PY_W2_EMP")
F.ODBC.Connection!conX.Execute("Delete From Y_PY_W2_ADDL")
F.ODBC.Connection!conX.Execute("Delete From Y_PY_W2_LOC")
F.ODBC.Connection!conX.Execute("Delete From Y_PY_W2_ST")
f.ODBC.Connection!conx.Close
Function.Intrinsic.Control.End
Program.Sub.Form_UnLoad.End

Program.Sub.cboType_Change.Start
Function.Intrinsic.Control.If(v.screen.Form!cboType.Value,<>,"Federal") 
	gui.Form.cboCodeVal.Visible(True) 
	gui.Form.lblStateOther.Visible(True)	
'	Gui.Form.frameHead.Visible(True)
	Function.Intrinsic.Control.If(v.Screen.For m!cboType.Value,=,"State")
		Gui.Form.cboCodeVal.AddItem("CA")
	Function.Intrinsic.Control.Else
		Gui.Form.cboCodeVal.AddItem("ETT")
	Function.Intrinsic.Control.EndIf	
Function.Intrinsic.Control.Else
'	Gui.Form.frameHead.Visible(True)
	gui.Form.cboCodeVal.Visible(False) 
	gui.Form.lblStateOther.Visible(False)
Function.Intrinsic.Control.EndIf

Program.Sub.cboType_Change.End

Program.Sub.DataSection.Start
F.Intrinsic.Control.SetErrorHandler("datasection_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
 F.Data.DataTable.Create("dtHeaderInfo",True) 
 F.Data.DataTable.AddColumn("dtHeaderInfo","Field","String") 
 F.Data.DataTable.AddColumn("dtHeaderInfo","Value","String") 
 F.Data.DataTable.AddRow("dtHeaderInfo","Field","Name","Value",V.DataTable.dtHeader(0).Company_name!Fieldval) 
 F.Data.DataTable.AddRow("dtHeaderInfo","Field","Location Address (Attention,Suite,Room Number,Etc.)","Value",v.DataTable.dtHeader(0).Location_Addr!Fieldval) 
 F.data.DataTable.AddRow("dtHeaderInfo","Field","Delivery Address","Value",v.DataTable.dtHeader(0).Delivery_Addr!FieldVal)  
 F.Data.DataTable.AddRow("dtHeaderInfo","Field","City","Value",v.DataTable.dtHeader(0).Address_City!fieldval)
 F.Data.DataTable.AddRow("dtHeaderInfo","Field","State","Value",v.DataTable.dtHeader(0).Address_State!FieldVal)
 F.Data.DataTable.AddRow("dtHeaderInfo","Field","Zip","Value",v.DataTable.dtHeader(0).Address_Zip!FieldVal)
  
 F.Data.DataTable.Create("dtSubmitterInfo",True)
 F.Data.DataTable.AddColumn("dtSubmitterInfo","Field","String") 
 F.Data.DataTable.AddColumn("dtSubmitterInfo","Value","String")
 F.Data.DataTable.AddRow("dtSubmitterInfo","Field","Federal Tax ID (EIN)","Value",v.DataTable.dtHeader(0).Federal_ID!FieldVal)
 Function.Intrinsic.Control.If(v.DataTable.dtW2Data.RowCount--,>=,0) 
 	F.Data.DataTable.AddRow("dtSubmitterInfo","Field","Pin","Value",v.DataTable.dtW2Data(0).CO_Pin!FieldValTrim)
 Function.Intrinsic.Control.Else
 	F.Data.DataTable.AddRow("dtSubmitterInfo","Field","Pin","Value","")
 Function.Intrinsic.Control.EndIf
 
 F.Data.DataTable.AddRow("dtSubmitterInfo","Field","Software Vendor Code","Value","0098")
 F.Data.DataTable.AddRow("dtSubmitterInfo","Field","Software Code","Value","98")
 F.Data.DataTable.AddRow("dtSubmitterInfo","Field","Name","Value",V.DataTable.dtHeader(0).Company_name!Fieldval) 
 F.Data.DataTable.AddRow("dtSubmitterInfo","Field","Location Address (Attention,Suite,Room Number,Etc.)","Value",v.DataTable.dtHeader(0).Location_Addr!Fieldval)  
 F.data.DataTable.AddRow("dtSubmitterInfo","Field","Delivery Address","Value",v.DataTable.dtHeader(0).Delivery_Addr!FieldVal)  
 F.Data.DataTable.AddRow("dtSubmitterInfo","Field","City","Value",v.DataTable.dtHeader(0).Address_City!fieldval)
 F.Data.DataTable.AddRow("dtSubmitterInfo","Field","State","Value",v.DataTable.dtHeader(0).Address_State!FieldVal)
 F.Data.DataTable.AddRow("dtSubmitterInfo","Field","Zip","Value",v.DataTable.dtHeader(0).Address_Zip!FieldVal)
 F.Data.DataTable.Create("dtContact",True) 
 F.Data.DataTable.AddColumn("dtContact","Field","String") 
 F.Data.DataTable.AddColumn("dtContact","Value","String")
 Function.Intrinsic.Control.If(v.DataTable.dtW2Data.Exists,=,True)
 	Function.Intrinsic.Control.If(v.DataTable.dtW2Data.RowCount--,>=,0) 	
	 	F.Data.DataTable.AddRow("dtContact","Field","Contact Name","Value",v.DataTable.dtW2Data(0).Contact_Name!FieldValTrim)
	 	F.data.DataTable.AddRow("dtContact","Field","Contact Phone","Value",v.DataTable.dtW2Data(0).Contact_Phone!FieldValTrim) 
	 	F.Data.DataTable.AddRow("dtContact","Field","Contact Phone Ext","Value",v.DataTable.dtW2Data(0).Contact_Phone_ext!FieldValTrim)
	 	F.Data.DataTable.AddRow("dtContact","Field","Contact Email","Value",v.DataTable.dtW2Data(0).Contact_Email!FieldValTrim)
		F.Data.DataTable.AddRow("dtContact","Field","Contact Fax","Value",v.DataTable.dtW2Data(0).Contact_Fax!FieldValTrim)
	Function.Intrinsic.Control.Else
		F.Data.DataTable.AddRow("dtContact","Field","Contact Name","Value",v.DataTable.dtHeader(0).Company_Name!FieldVal)
 		F.data.DataTable.AddRow("dtContact","Field","Contact Phone","Value","") 
 		F.Data.DataTable.AddRow("dtContact","Field","Contact Phone Ext","Value","")
 		F.Data.DataTable.AddRow("dtContact","Field","Contact Email","Value","")
		F.Data.DataTable.AddRow("dtContact","Field","Contact Fax","Value","")
	Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.Else	
	F.Data.DataTable.AddRow("dtContact","Field","Contact Name","Value",v.DataTable.dtHeader(0).Company_Name!FieldVal)
 	F.data.DataTable.AddRow("dtContact","Field","Contact Phone","Value","") 
 	F.Data.DataTable.AddRow("dtContact","Field","Contact Phone Ext","Value","")
 	F.Data.DataTable.AddRow("dtContact","Field","Contact Email","Value","")
	F.Data.DataTable.AddRow("dtContact","Field","Contact Fax","Value","")
 Function.Intrinsic.Control.EndIf 
 
 
 gui.Form.gcCompany.AddGridviewFromDatatable("MainHeader","dtHeaderInfo")
 Gui.Form.gcCompany.SetColumnProperty("MainHeader","Field","AllowSort","False")
 Gui.Form.gcCompany.SetColumnProperty("MainHeader","Field","AllowFocus","False")
 Gui.Form.gcCompany.SetColumnProperty("MainHeader","Value","AllowSort","False") 
 Gui.Form.gcCompany.SetGridviewProperty("Mainheader","ReadOnly",True)
 Gui.Form.gcCompany.SetGridviewProperty("Mainheader","AllowFilter",False)
 Gui.Form.gcCompany.SetGridviewProperty("Mainheader","AllowColumnMoving",False)
 Gui.Form.gcCompany.SetGridviewProperty("Mainheader","AllowColumnResizing",False)
 Gui.Form.gcCompany.SetCellProperty("MainHeader",1,1,"Locked","False")
 
 Gui.Form.gcCompany.SetCellProperty("MainHeader",1,1,"EDITMASK",".{0,22}")
 Gui.Form.gcCompany.SetCellProperty("MainHeader",1,1,"EDITMASKType","REgEx")
 Gui.Form.gcCompany.SetCellProperty("MainHeader",1,1,"EditMaskAsDisplayFormat",True)
 Gui.Form.gcCompany.SetColumnProperty("MainHeader","Value","ToolTip","Data is truncated to match maximum characters allowed on the W2 electronic file.")
 Gui.Form.gcCompany.SetColumnProperty("MainHeader","Value","Caption","Value") 
 gui.Form.gcCompany.MainView("MainHeader")
 
 Gui.Form.gcSubmitter.AddGridviewFromDatatable("MainSubmit","dtSubmitterInfo")
 GUi.Form.gcSubmitter.SetGridviewProperty("MainSubmit","EnterKeyNavigation","Vertical")
 GUi.Form.gcSubmitter.SetGridviewProperty("MainSubmit","AllowFilter",False)
 Gui.Form.gcSubmitter.SetGridviewProperty("MainSubmit","AllowColumnMoving",False)
 Gui.Form.gcSubmitter.SetGridviewProperty("MainSubmit","AllowColumnResizing",False)
 Gui.Form.gcSubmitter.SetColumnProperty("MainSubmit","Field","AllowSort","False")
 Gui.Form.gcSubmitter.SetColumnProperty("MainSubmit","Field","AllowFocus","False") 
 Gui.Form.gcSubmitter.SetColumnProperty("MainSubmit","value","AllowSort","False")
 Gui.Form.gcSubmitter.SetColumnProperty("MainSubmit","value","Readonly",False)
  
 'EIN
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,0,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,0,"EDITMASK",".{0,11}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,0,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,0,"EditMaskAsDisplayFormat",True)
 'PIN
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,1,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,1,"EDITMASK",".{0,8}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,1,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,1,"EditMaskAsDisplayFormat",True)
'SoftwareVendorCode
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,2,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,2,"EDITMASK",".{0,4}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,2,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,2,"EditMaskAsDisplayFormat",True)
 'Software Code
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,3,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,3,"EDITMASK",".{0,2}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,3,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,3,"EditMaskAsDisplayFormat",True)
 
 'Name 
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,4,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,4,"EDITMASK",".{0,57}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,4,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,4,"EditMaskAsDisplayFormat",True)
 
 'Location Address
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,5,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,5,"EDITMASK",".{0,22}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,5,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,5,"EditMaskAsDisplayFormat",True)
 
' Delivery Address
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,6,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,6,"EDITMASK",".{0,22}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,6,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,6,"EditMaskAsDisplayFormat",True)
 
 'City
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,7,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,7,"EDITMASK",".{0,22}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,7,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,7,"EditMaskAsDisplayFormat",True)
 
 'State 
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,8,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,8,"EDITMASK",".{0,2}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,8,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,8,"EditMaskAsDisplayFormat",True)

'Zip 
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,9,"Locked","False")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,9,"EDITMASK",".{0,10}")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,9,"EDITMASKType","REgEx")
 Gui.Form.gcSubmitter.SetCellProperty("MainSubmit",1,9,"EditMaskAsDisplayFormat",True)
 Gui.Form.gcSubmitter.SetColumnProperty("MainSubmit","Value","ToolTip","Data is truncated to match maximum characters allowed on the W2 electronic file.")
 Gui.Form.gcSubmitter.SetColumnProperty("MainSubmit","Value","Caption","Value (Note: Data may be truncated)")
 Gui.Form.gcSubmitter.MainView("MainSubmit")
 
 Gui.Form.gcContact.AddGridviewFromDatatable("MainCon","dtContact")
 GUi.Form.gcContact.SetGridviewProperty("MainCon","AllowFilter",False)
 Gui.Form.gcContact.SetGridviewProperty("MainCon","AllowColumnMoving",False)
 Gui.Form.gcgcontact.SetGridviewProperty("MainCon","AllowColumnResizing",False)
 Gui.Form.gcContact.SetColumnProperty("MainCon","Field","AllowSort","False")
 Gui.Form.gcContact.SetColumnProperty("MainCon","Field","AllowFocus","False")
 Gui.Form.gcContact.SetColumnProperty("MainCon","Value","AllowSort","False")
 Gui.Form.gcContact.SetColumnProperty("MainCon","Value","ReadOnly",False)
'Contact Name
 Gui.Form.gcContact.SetCellProperty("MainCon",1,0,"Locked","False")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,0,"EDITMASK",".{0,27}")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,0,"EDITMASKType","REgEx")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,0,"EditMaskAsDisplayFormat",True)
 'Contact Phone
 Gui.Form.gcContact.SetCellProperty("MainCon",1,1,"Locked","False")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,1,"EDITMASK",".{0,15}")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,1,"EDITMASKType","REgEx")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,1,"EditMaskAsDisplayFormat",True)
 'ContactPhone ext
 Gui.Form.gcContact.SetCellProperty("MainCon",1,2,"Locked","False")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,2,"EDITMASK",".{0,5}")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,2,"EDITMASKType","REgEx")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,2,"EditMaskAsDisplayFormat",True)
 Gui.Form.gcContact.MainView("MainCon")
 'contact email
  Gui.Form.gcContact.SetCellProperty("MainCon",1,3,"Locked","False")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,3,"EDITMASK",".{0,40}")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,3,"EDITMASKType","REgEx")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,3,"EditMaskAsDisplayFormat",True)
 'contact fax
 Gui.Form.gcContact.SetCellProperty("MainCon",1,4,"Locked","False")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,4,"EDITMASK",".{0,10}")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,4,"EDITMASKType","REgEx")
 Gui.Form.gcContact.SetCellProperty("MainCon",1,4,"EditMaskAsDisplayFormat",True)
 Gui.Form.gcContact.SetColumnProperty("MainCon","Value","ToolTip","Data is truncated to match maximum characters allowed on the W2 electronic file.")
 Gui.Form.gcContact.SetColumnProperty("MainCon","Value","Caption","Value (Note: Data may be truncated)")
 Gui.Form.gcContact.MainView("MainCon")
 F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("datasection_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.DataSection.End

Program.Sub.Art.Start
F.Intrinsic.Control.SetErrorHandler("Art_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.local.spath.Declare(STring) 
v.Local.bEx.Declare(boolean) 

F.Intrinsic.String.Build("{0}\ART\{1}",v.Caller.GlobalDir,"gss2.ico",v.Local.spath) 
F.Intrinsic.File.Exists(v.Local.spath,v.Local.bEx) 
Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
	gui.Form..Icon(v.Local.spath) 
	Gui.FormPrint..icon(v.Local.spath)
Function.Intrinsic.Control.EndIf

'F.Intrinsic.String.Build("{0}\ART\{1}",v.Caller.GlobalDir,"w2frst.png",v.Local.spath) 
'F.Intrinsic.File.Exists(v.Local.spath,v.Local.bEx) 
'Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
'	gui.Form.cmdEmpFirst.Picture(v.Local.spath) 
'Function.Intrinsic.Control.Else
	gui.Form.cmdEmpFirst.Caption("<<")
'Function.Intrinsic.Control.EndIf

'F.Intrinsic.String.Build("{0}\ART\{1}",v.Caller.GlobalDir,"w2prv.png",v.Local.spath) 
'F.Intrinsic.File.Exists(v.Local.spath,v.Local.bEx) 
'Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
	'gui.Form.cmdEmpPrev.Picture(v.Local.spath) 
'Function.Intrinsic.Control.Else
	gui.Form.cmdEmpPrev.Caption("<")
'Function.Intrinsic.Control.EndIf

'F.Intrinsic.String.Build("{0}\ART\{1}",v.Caller.GlobalDir,"w2nxt.png",v.Local.spath) 
'F.Intrinsic.File.Exists(v.Local.spath,v.Local.bEx) 
'Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
'	gui.Form.cmdEmpNext.Picture(v.Local.spath) 
'Function.Intrinsic.Control.Else
	gui.Form.cmdEmpNext.Caption(">")
'Function.Intrinsic.Control.EndIf

'F.Intrinsic.String.Build("{0}\ART\{1}",v.Caller.GlobalDir,"w2lst.png",v.Local.spath) 
'F.Intrinsic.File.Exists(v.Local.spath,v.Local.bEx) 
'Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
	'Gui.Form.cmdEmpLast.Picture(v.Local.spath) 
'Function.Intrinsic.Control.Else
	gui.Form.cmdEmpLast.Caption(">>")
'Function.Intrinsic.Control.EndIf

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Art_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf

Program.Sub.Art.End

Program.Sub.cmdBegEmpBrowse_Click.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sCols.Declare(STring)
v.Local.iWidths.Declare(Long)
v.Local.sRet.Declare(String)
F.Intrinsic.UI.SetBrowserHotTypeAhead(True)
F.Intrinsic.String.Split("Employee ID*!*First Name*!*Middle Initial*!*Last Name","*!*",v.Local.sCols) 
F.Intrinsic.String.Split("500*!*1000*!*500*!*1500","*!*",v.Local.iWidths) 
'Create DataView if it doesn't exist, then dv to string then browser from string. 
F.Intrinsic.Control.If(v.dataview.dtEmp!dvEmpBrow.Exists,=,False)
 F.Data.DataView.Create("dtEmp","dvEmpBrow",22,"","[EMPLOYEE] Asc") 
F.Intrinsic.Control.EndIf
F.Data.DataView.ToString("dtEmp","dvEmpBrow","EMPLOYEE*!*FIRST_NAME*!*Middle_INIT*!*LAST_NAME","*!*","!*!",v.Local.sRet) 
F.Intrinsic.UI.BrowserFromString("Select Employee...",v.Local.sRet,"*!*","!*!",v.Local.sCols,v.Local.iWidths,v.Local.sRet) 
Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***CANCEL***")
	f.Intrinsic.String.Split(v.Local.sret,"*!*",v.Local.sREt)
	gui.formprint.txtBegEmp.Text(v.Local.sRet(0))
	Gui.FormPrint.txtEndEmp.Text(v.Local.sRet(0))
Function.Intrinsic.Control.EndIf

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdBegEmpBrowse_Click.End

Program.Sub.cmdEndEmpBrowse_Click.Start
F.Intrinsic.Control.SetErrorHandler("cmdEndBrowser_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sCols.Declare(STring)
v.Local.iWidths.Declare(long)
v.Local.sret.Declare(String)
F.Intrinsic.UI.SetBrowserHotTypeAhead(True)
F.Intrinsic.String.Split("Employee ID*!*First Name*!*Middle Initial*!*Last Name","*!*",v.Local.sCols) 
F.Intrinsic.String.Split("500*!*1000*!*500*!*1500","*!*",v.Local.iWidths) 
'Create DataView if it doesn't exist, then dv to string then browser from string. 
F.Intrinsic.Control.If(v.dataview.dtEmp!dvEmpBrow.Exists,=,False)
 F.Data.DataView.Create("dtEmp","dvEmpBrow",22,"","[EMPLOYEE] Asc") 
F.Intrinsic.Control.EndIf
F.Data.DataView.ToString("dtEmp","dvEmpBrow","EMPLOYEE*!*FIRST_NAME*!*Middle_INIT*!*LAST_NAME","*!*","!*!",v.Local.sRet) 
F.Intrinsic.UI.BrowserFromString("Select Employee...",v.Local.sRet,"*!*","!*!",v.Local.sCols,v.Local.iWidths,v.Local.sRet)
Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***CANCEL***")
	f.Intrinsic.String.Split(v.Local.sret,"*!*",v.Local.sREt)	
	Gui.FormPrint.txtEndEmp.Text(v.Local.sRet(0))
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("cmdEndBrowser_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdEndEmpBrowse_Click.End

Program.Sub.cmdAdd_Click.Start
F.Intrinsic.Control.SetErrorHandler("cmdAdd_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
Function.Intrinsic.Control.If(v.Screen.FormPrint!txtBegEmp.text.trim,<>,"","AND",v.screen.FormPrint!txtEndEmp.text.trim,<>,"")
	f.Intrinsic.Math.Add(v.Global.iKey,1,v.Global.ikey)	
	Gui.FormPrint.lvwEmp.AddListItem(v.Global.iKey,v.Screen.FormPrint!txtBegEmp.text.trim)
	Gui.FormPrint.lvwEmp.SetListItemSubItemText(v.Global.iKey,1,v.Screen.FormPrint!txtEndEmp.text.trim)
	Gui.Formprint.txtBegEmp.Text("")
	Gui.Formprint.txtEndEmp.Text("")	
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("cmdAdd_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdAdd_Click.End

Program.Sub.chkAllEmp_Click.Start
Function.Intrinsic.Control.If(v.Screen.FormPrint!chkAllEmp.Value,=,1) 
	Gui.FormPrint.chkElecFile.Visible(True)
	Gui.FormPrint.lvwEmp.ClearItems
	Gui.FormPrint.txtBegEmp.Enabled(False)
	Gui.FormPrint.txtEndEmp.Enabled(False)
	Gui.FormPrint.cmdAdd.Enabled(False)
	Gui.FormPrint.cmdDelete.Enabled(False)
	Gui.FormPrint.cmdClear.Enabled(False)
	Gui.FormPrint.txtBegEmp.Text("")
	GUi.FormPrint.txtEndEmp.Text("")
	Gui.FormPrint.lvwEmp.Enabled(False)
	Gui.FormPrint.cmdBegEmpBrowse.Enabled(False)
	Gui.FormPrint.cmdEndEmpBrowse.Enabled(False)
Function.Intrinsic.Control.Else
	Gui.FormPrint.chkElecFile.Visible(False)
	Gui.FormPrint.txtBegEmp.Text("")
	GUi.FormPrint.txtEndEmp.Text("")
	Gui.FormPrint.lvwEmp.ClearItems
	Gui.FormPrint.txtBegEmp.Enabled(True)
	Gui.FormPrint.txtEndEmp.Enabled(True)
	Gui.FormPrint.cmdAdd.Enabled(True)
	Gui.FormPrint.cmdDelete.Enabled(True)
	Gui.FormPrint.cmdClear.Enabled(True)
	Gui.FormPrint.lvwEmp.Enabled(True)
	Gui.FormPrint.cmdBegEmpBrowse.Enabled(True)
	Gui.FormPrint.cmdEndEmpBrowse.Enabled(True)
	gui.FormPrint.chkElecFile.Value(0)
Function.Intrinsic.Control.EndIf	
Program.Sub.chkAllEmp_Click.End

Program.Sub.cmdDelete_Click.Start
F.Intrinsic.Control.SetErrorHandler("cmdDeleteClick_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.iKey.Declare(long)
v.Local.iKey.Set(v.Screen.FormPrint!lvwEmp.SelectedItemKey) 
Gui.FormPrint.lvwEmp.RemoveItem(v.Local.ikey)
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("cmdDeleteClick_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdDelete_Click.End

Program.Sub.cmdClear_Click.Start
F.Intrinsic.Control.SetErrorHandler("cmdClearClick_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
gui.FormPrint.lvwEmp.ClearItems
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("cmdClearClick_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdClear_Click.End

Program.Sub.cmdPrint_Click.Start
F.Intrinsic.Control.SetErrorHandler("cmdPrint_Click_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sPath.Declare(String)
v.Local.bValid.Declare(Boolean)
v.Local.sT.Declare(String)
gui.FormPrint..Visible(False)
Gui.F_Progress..Visible(True)
'check if they selected all employees or not. 
F.Intrinsic.Control.If(v.Screen.FormPrint!chkAllEmp.Value,=,0)
	Function.Intrinsic.Control.CallSub(EmployeePrintSelection)	
F.Intrinsic.Control.EndIf
F.Data.DataTable.AcceptChanges("dtEmp") 
F.Data.DataTable.AcceptChanges("dtAddl")
F.Data.DataTable.AcceptChanges("dtStateLoc")
'combine employees becuase they have the same social but differnet id's.
'Function.Intrinsic.Control.CallSub(Combine_Emps)
'order by last name for to make happy
'create a view of dtEmp. order by Last Name
'close dtEmp
'Create dt from d
're order
F.Data.DataTable.Clone("dtEmp","dtEmpTemp",True) 
F.Data.DataTable.Merge("dtEmp","dtEmpTemp",True,4) 
F.Data.DataTable.Close("dtEmp") 
F.Data.DataView.Create("dtEmpTemp","dvEmpTemp",22,"","Last_Name Asc") 
F.Data.DataView.ToDataTable("dtEmpTemp","dvEmpTemp","dtEmp",True) 
F.Data.DataTable.Close("dtEmpTemp") 

'do this for the easier rw and ro records, trust.
F.Data.DataTable.AddExpressionColumn("dtAddl","IRS_CODE_COMB","String","IIF(ISNull([IRS_CODE],'') = '',[BOX_DESC],[IRS_CODE])")
F.Data.DataTable.AddExpressionColumn("dtAddl","Amt_12_14_COMB","Float","IIF(ISNull([IRS_CODE],'') = '',[Amount_14],[Amount_12])")
Function.Intrinsic.Control.If(v.Screen.FormPrint!chkElecFile.Value,=,1)
	Function.Intrinsic.Control.If(v.Screen.Form!txtESaveFile.Text.Trim,<>,"")	 
		F.Intrinsic.File.GetPathFromFQN(v.Screen.Form!txtESaveFile.text,v.Local.sPath)
		F.Intrinsic.File.DirExists(v.Local.sPath,v.Local.bValid)
		F.Intrinsic.Control.If(v.Local.bValid,=,False)
			v.Local.sPath.Set(v.Caller.FilesDir)		
		F.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.EndIf	
	F.Data.DataView.Create("dtStateLoc","dvTotal")
	F.Data.DataView.ToDataTableDistinct("dtStateLoc","dvTotal","dtTotal","Employee*!*State*!*Wages*!*WithHolding",True)	
	F.Intrinsic.Control.callsub(buildfile,"Path",v.Local.sPath)	
	F.Intrinsic.String.Right(v.Local.sPath,1,v.Local.st)
	F.Intrinsic.Control.If(v.Local.sT,<>,"\") 
		v.Local.sPath.Append("\")
	F.Intrinsic.Control.EndIf		
	'call callwrapper	
	F.Global.Callwrapper.New("W2EFile","Payroll.GenerateElectronicW2") 
	F.Global.Callwrapper.SetProperty("W2EFile","W2FilePath",v.local.sPath)
	F.Global.Callwrapper.Run("W2EFile")		
Function.Intrinsic.Control.EndIf


Function.Intrinsic.Control.If(v.DataTable.dtTotal.Exists,=,False)
	'THIS SHOULD NEVER GET HIT more than once. I don't close the ones when creating from electronic file, but that only executes if they selected all.
	F.Data.DataView.Create("dtStateLoc","dvTotal")
	F.Data.DataView.ToDataTableDistinct("dtStateLoc","dvTotal","dtTotal","Employee*!*State*!*Wages*!*WithHolding",True)		
Function.Intrinsic.Control.EndIf

Gui.FormPrint..Visible(False)
GUi.FormSelect..Show
Gui.F_Progress.progressBar1.Scrolling(2)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("cmdPrint_Click_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdPrint_Click.End

Program.Sub.txtBegEmp_GotFocus.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
gui.FormPrint.txtBegEmp.SelectAll
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtBegEmp_GotFocus.End

Program.Sub.txtBegEmp_LostFocus.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
Gui.FormPrint.txtEndEmp.Text(v.Screen.FormPrint!txtBegEmp.text)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtBegEmp_LostFocus.End

Program.Sub.txtEndEmp_GotFocus.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
gui.FormPrint.txtEndEmp.SelectAll
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtEndEmp_GotFocus.End

Program.Sub.FormPrint_UnLoad.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
gui.FormPrint..Visible(False)
Gui.Form..Visible(True)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.End	
Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.End
Program.Sub.FormPrint_UnLoad.End

Program.Sub.cmdPrint_Click1.Start
F.Intrinsic.Control.SetErrorHandler("cmdPrint_Click1_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
Function.Intrinsic.Control.CallSub(checkchange)
Gui.Form..Visible(False) 
'combine employees becuase they have the same social but differnet id's.

Function.Intrinsic.Control.CallSub(Combine_Emps)

Gui.FormPrint..Show
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("cmdPrint_Click1_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	 Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdPrint_Click1.End

Program.Sub.cmdw2savepath_Click.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sRet.Declare(String)
v.Local.sExt.Declare(STring)
v.Local.sPath.Declare(STring)
f.Intrinsic.String.Build("{0}W2.pdf",v.Global.iYear,v.Local.sreT)
f.Intrinsic.UI.ShowSaveFileDialog(v.Local.sRet,"*.pdf",v.Local.sREt)
Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***CANCEL***")	
	F.Intrinsic.File.GetExtensionComponent(v.Local.sRet,v.Local.sExt)
	F.Intrinsic.Control.If(v.Local.sExt.UCase,<>,"PDF")
		f.Intrinsic.File.GetPathFromFQN(v.Local.sRet,v.Local.sPath)
		F.Intrinsic.String.Build("{0}\{1}_W2.pdf",v.Local.sPath,v.Global.iYear,v.Local.sRet)
	F.Intrinsic.Control.EndIf
	gui.Form.txtW2Save.Text(v.Local.sRet.trim)
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdw2savepath_Click.End

Program.Sub.cmdEletronicFilesavePath_Click.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sRet.Declare
f.Intrinsic.UI.FolderBrowser("Select Save Location for W2 Electronic File",v.Local.sRet)
Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***CANCEL***")
	f.Intrinsic.String.Build("{0}\W2REPORTUS.txt",v.Local.sRet,v.local.sret)	
	gui.Form.txtESaveFile.Text(v.Local.sRet.trim)
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	Function.Intrinsic.UI.Msgbox(v.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdEletronicFilesavePath_Click.End

Program.Sub.txtBox7_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Global.bChange.Set(True) 
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf

Program.Sub.txtBox7_Change.End

Program.Sub.txtBox8_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtBox8_Change.End

Program.Sub.txtBox9_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtBox9_Change.End

Program.Sub.txtBox11_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Global.bChange.Set(True) 
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtBox11_Change.End

Program.Sub.txtBox12ACode_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Global.bChange.Set(True) 
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtBox12ACode_Change.End

Program.Sub.txtBox12aDesc_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)	
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtBox12aDesc_Change.End

Program.Sub.txt12BCode_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txt12BCode_Change.End

Program.Sub.txt12bDesc_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txt12bDesc_Change.End

Program.Sub.txt12cCode_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Global.bChange.Set(True) 
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txt12cCode_Change.End

Program.Sub.txt12cDesc_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txt12cDesc_Change.End

Program.Sub.txt12dCode_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txt12dCode_Change.End

Program.Sub.txt12dDesc_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txt12dDesc_Change.End

Program.Sub.txtBox14_Change.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Global.bChange.Set(True)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtBox14_Change.End

Program.Sub.cmdEmpFirst_Click.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
Function.Intrinsic.Control.BlockEvents
Function.Intrinsic.Control.CallSub(CheckChange)
'first row of our dvEmpSort?
Gui.Form.txtEmpID.Text(v.DataView.dtEmp!dvEmpSort(0).Employee!FieldValTrim)
v.Global.iRowCount.Set(0)
F.Intrinsic.Control.If(v.Screen.Form!txtEmpID.text.trim,<>,"")
	Function.Intrinsic.Control.BlockEvents	
	Function.Intrinsic.Control.CallSub(clearempscreen)
	Function.Intrinsic.Control.CallSub(LoadEmpScreen)
	Function.Intrinsic.Control.UnBlockEvents	
F.Intrinsic.Control.EndIf
Function.Intrinsic.Control.UnBlockEvents
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)	
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdEmpFirst_Click.End

Program.Sub.cmdEmpPrev_Click.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
v.Local.sSel.Declare(String)
V.Local.sError.Declare(String)
Function.Intrinsic.Control.BlockEvents
Function.Intrinsic.Control.CallSub(CheckChange)
'if our bchange is still true at this point that means something didn't hash out right in the employee save. exit the sub 
Function.Intrinsic.Control.If(v.Global.bChange,=,False)	
	Function.Intrinsic.Control.If(v.Global.iRowCount,>,0)
		F.Intrinsic.Math.Sub(v.Global.iRowCount,1,v.Global.iRowCount)
		Gui.Form.txtEmpID.Text(v.DataView.dtEmp!dvEmpSort(v.Global.iRowCount).Employee!FieldValTrim)
		Function.Intrinsic.Control.CallSub(clearempscreen)
		Function.Intrinsic.Control.CallSub(loadEmpScreen)
	Function.Intrinsic.Control.Else
		V.Global.iROCount.Set(0)
		Gui.Form.txtEmpID.Text(v.DataView.dtEmp!dvEmpSort(0).Employee!FieldValTrim)
		Function.Intrinsic.Control.CallSub(clearempscreen)
		Function.Intrinsic.Control.CallSub(loadEmpScreen)
	Function.Intrinsic.Control.EndIf	
Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.UnBlockEvents
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdEmpPrev_Click.End

Program.Sub.cmdEmpNext_Click.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
Function.Intrinsic.Control.BlockEvents
Function.Intrinsic.Control.CallSub(CheckChange)
Function.Intrinsic.Control.If(v.Global.bChange,=,False)
	Function.Intrinsic.Control.If(v.Global.iRowCount,<,v.DataView.dtEmp!dvEmpSort.RowCount--)			
		F.Intrinsic.Math.Add(v.Global.iRowCount,1,v.Global.iRowCount)		
		Gui.Form.txtEmpID.Text(v.DataView.dtEmp!dvEmpSort(v.Global.iRowCount).Employee!FieldValTrim)
		Function.Intrinsic.Control.CallSub(ClearEmpScreen)
		Function.Intrinsic.Control.CallSub(LoadEmpScreen)	
	Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.UnBlockEvents
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdEmpNext_Click.End

Program.Sub.cmdEmpLast_Click.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
Function.Intrinsic.Control.BlockEvents
Function.Intrinsic.Control.CallSub(CheckChange)
Gui.Form.txtEmpID.Text(v.DataView.dtEmp!dvEmpSort(v.DataView.dtEmp!dvEmpSort.RowCount--).Employee!FieldValTrim)
v.Global.iRowCount.Set(v.DataView.dtEmp!dvEmpSort.RowCount--)
F.Intrinsic.Control.If(v.Screen.Form!txtEmpID.text.trim,<>,"")
	Function.Intrinsic.Control.CallSub(clearEmpScreen)
	Function.Intrinsic.Control.CallSub(LoadEmpScreen)
F.Intrinsic.Control.EndIf
Function.Intrinsic.Control.UnBlockEvents
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdEmpLast_Click.End

Program.Sub.cmdEmpBrowse_Click.Start
F.Intrinsic.Control.SetErrorHandler("cmdempbrowse_ERR")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sRet.Declare(String) 
v.Local.sCols.Declare(String)
v.Local.iWidths.Declare(Long)
F.Intrinsic.UI.SetBrowserHotTypeAhead(True)
F.Intrinsic.String.Split("Employee ID*!*First Name*!*Middle Initial*!*Last Name","*!*",v.Local.sCols) 
F.Intrinsic.String.Split("500*!*1000*!*500*!*1500","*!*",v.Local.iWidths) 
'Create DataView if it doesn't exist, then dv to string then browser from string. 
F.Intrinsic.Control.If(v.dataview.dtEmp!dvEmpBrow.Exists,=,False)
 F.Data.DataView.Create("dtEmp","dvEmpBrow",22,"","[EMPLOYEE] Asc") 
F.Intrinsic.Control.EndIf
F.Data.DataView.ToString("dtEmp","dvEmpBrow","EMPLOYEE*!*FIRST_NAME*!*Middle_INIT*!*LAST_NAME","*!*","!*!",v.Local.sRet) 
F.Intrinsic.UI.BrowserFromString("Select Employee...",v.Local.sRet,"*!*","!*!",v.Local.sCols,v.Local.iWidths,v.Local.sRet) 
Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***CANCEL***")
	f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
	Gui.Form.txtEmpID.Text(v.Local.sRet(0).Trim)
	Function.Intrinsic.Control.BlockEvents
	f.Intrinsic.String.Build("[EMPLOYEE] = '{0}'",v.Local.sRet(0).Trim,v.Local.sRet)	
	F.Data.DataTable.Select("dtEmp",v.local.sRet,v.Local.sREt)
	f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret)
	v.Global.iRowCount.Set(v.DataTable.dtEmp(v.Local.sRet(0)).SORTCOL!FIELDVAL)
	Function.Intrinsic.Control.CallSub(checkChange)
	F.Intrinsic.Control.CallSub(ClearEmpScreen)
	Function.Intrinsic.Control.CallSub(loadEmpScreen)
	Function.Intrinsic.Control.UnBlockEvents
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("cmdempbrowse_ERR")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdEmpBrowse_Click.End

Program.Sub.txtEmpID_LostFocus.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.iLen.Declare(Long)
v.Local.sRet.Declare(String)
Function.Intrinsic.Control.BlockEvents
F.Intrinsic.String.Len(v.screen.Form!txtEmpID.text,v.Local.iLen)
Function.Intrinsic.Control.If(v.local.iLen,>=,5)	
	f.Intrinsic.String.Build("[EMPLOYEE] = '{0}'",v.screen.Form!txtempid.text.trim,v.Local.sRet)	
	F.Data.DataTable.Select("dtEmp",v.local.sRet,v.Local.sREt)
	Function.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***")
		F.Intrinsic.Control.CallSub(CheckChange)
		Function.Intrinsic.Control.CallSub(clearEmpScreen)		
		v.Global.sEmpID.Set("")
		Function.Intrinsic.Control.UnBlockEvents
		f.Intrinsic.Control.exitsub
	Function.Intrinsic.Control.EndIf
	f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret)
	v.Global.iRowCount.Set(v.DataTable.dtEmp(v.Local.sRet(0)).SORTCOL!FIELDVAL)
	F.Intrinsic.Control.CallSub(CheckChange)
	Function.Intrinsic.Control.CallSub(clearEmpScreen)
	F.Intrinsic.Control.CallSub(LoadEmpScreen)	
Function.Intrinsic.Control.Else
	F.Intrinsic.Control.CallSub(CheckChange)
	Function.Intrinsic.Control.CallSub(clearEmpScreen)	
	v.Global.sEmpID.Set("")
Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.UnBlockEvents
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.txtEmpID_LostFocus.End

Program.Sub.DefaultVals.Start
F.Intrinsic.Control.SetErrorHandler("DefaulVals_ERR")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sTemp.Declare
v.Local.sPath.Declare(String) 
'look for the secured path within OP_header Id 401402 Sequence 0011. This is the path they have setup for the encryption security. If it's blank default to global\files

F.Global.General.ReadOption(401402,1,"",0011,v.Local.sPath)
Function.Intrinsic.Control.If(v.Local.sPath.Trim,<>,"") 
	'default paths from company options
	F.Intrinsic.String.Build("{0}\{1}W2.pdf",v.Local.sPath,v.Global.iYear,v.Local.sTemp)
	gui.Form.txtW2Save.Text(v.Local.sTemp) 
	F.Intrinsic.String.Build("{0}\W2REPORTUS.txt",v.local.sPath,v.Global.iYear,v.Local.sTemp)
	Gui.Form.txtESaveFile.Text(v.Local.sTemp)	
Function.Intrinsic.Control.Else
	'default paths
	F.Intrinsic.String.Build("{0}\{1}W2.pdf",v.Caller.FilesDir,v.Global.iYear,v.Local.sTemp)
	gui.Form.txtW2Save.Text(v.Local.sTemp) 
	F.Intrinsic.String.Build("{0}\W2REPORTUS.txt",v.Caller.FilesDir,v.Global.iYear,v.Local.sTemp)
	Gui.Form.txtESaveFile.Text(v.Local.sTemp)
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("DefaulVals_ERR")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.DefaultVals.End

Program.Sub.LoadData.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
v.Local.sSQL.Declare(String)
V.Local.sError.Declare(String)
v.Local.sFile.Declare(String) 
v.Local.sCont.Declare(String)
v.Local.bEx.Declare(Boolean) 
v.Local.i.Declare(Long)
v.Local.sFields.Declare(String)
v.Local.iPostArray.Declare(Long) 
v.Local.iPostArray.Redim(0,2) 
v.Local.iPostArray(0).Set(1) 
v.Local.iPostArray(1).Set(5)
v.Local.iPostArray(2).Set(7)
v.Local.iLengthArray.Declare(Long) 
v.Local.iLengthArray.Redim(0,2) 
v.Local.iLengthArray(0).Set(4) 
v.Local.iLengthArray(1).Set(2)
v.Local.iLengthArray(2).Set(2)

'load Header 
F.Intrinsic.String.Build("Select RUNID,LOGID,FEDERAL_ID,COMPANY_NAME,Delivery_ADDR,Location_ADDR,Address_City,Address_State,Address_ZIP From Y_PY_W2_HDR Where RUNID = '{0}'",v.Global.iBIRUNID,v.Local.sSQL) 
F.Data.DataTable.CreateFromSQL("dtHeader","conX",v.Local.sSQL,True)

F.Data.DataTable.CreateFromSQL("dtW2Data","conX","Select * From V_W2_Data",True)
Function.Intrinsic.Control.If(v.DataTable.dtW2Data.RowCount--,=,-1) 
	'make it 0 so we don't break farther down line. 
	F.Data.DataTable.AddRow("dtW2Data","CO_PIN","")
Function.Intrinsic.Control.EndIf

'load Employees
F.Intrinsic.String.Build("Select * From Y_PY_W2_EMP Where RUNID = '{0}'",v.Global.iBIRUNID,v.Local.sSQL) 
F.Data.DataTable.CreateFromSQL("dtEmp","CONX",v.Local.sSQL,True) 
'add columns for add boxes not being tracked. 
F.Data.DataTable.AddColumn("dtEmp","NQ_PLAN","Float")
F.Data.DataTable.AddColumn("dtEmp","SS_TIPS","Float")
F.Data.DataTable.AddColumn("dtEmp","ALLO_TIPS","Float")
F.Data.DataTable.AddColumn("dtEmp","BOX_D","String")
F.Data.DataTable.AddColumn("dtEmp","BOX_9","String")
F.Data.DataTable.AddExpressionColumn("dtEmp","BitStatuEmp","Boolean","IIF([STATUTORY_EMP] = 'Y',True,False)")
F.Data.DataTable.AddExpressionColumn("dtEmp","bitRetirementPlan","Boolean","IIF([Retirement_Plan] = 'Y',True,False)")
F.Data.DataTable.AddExpressionColumn("dtEmp","Bit_ThirdPartySick","Boolean","IIF([Third_Party_Sick] = 'Y',True,False)")
'For 17.0 and above we are now allowing them to enter NQ Plans Box 11 from GLobal. THe are stored in Y_ADDL Box_11 Amount_11. Create a dictionary for Emp and Box 11, and Fill dt from dictionary.
F.Intrinsic.Control.If(v.Caller.GSSVersion,>=,"2017.0") 
	F.Intrinsic.String.Build("Select Employee, Amount_11 As NQ_PLAN From Y_PY_W2_ADDL Where Box = '11' And RunID = '{0}'",v.Global.iBIRUNID,v.Local.sSQL)
	F.Data.DataTable.CreateFromSQL("dtBox11","conX",v.Local.sSQL)
	Function.Intrinsic.Control.If(v.DataTable.dtBox11.Exists,=,True) 
		Function.Intrinsic.Control.If(v.DataTable.dtBox11.RowCount--,>,-1) 
			'create dictionary 
			F.Data.Dictionary.CreateFromDataTable("dicBox11","dtBox11","Employee","NQ_PLAN",4)
			F.Data.Dictionary.Exists("dicBox11",v.Local.bex)
			Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
				'fill datatable dtEmp NQ_Plans from Dictionary
				F.Data.Dictionary.SetDefaultReturn("dicBox11","0")
				F.Data.DataTable.FillFromDictionary("dtEmp","dicBox11","EMPLOYEE","NQ_PLAN")
				F.Data.Dictionary.Close("dicBox11")				
			Function.Intrinsic.Control.EndIf			
		Function.Intrinsic.Control.EndIf
		f.Data.DataTable.Close("dtBox11")
	Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

'loadAddl
F.Intrinsic.String.Build("Select RUNID, LOGID, EMPLOYEE, BOX, SEQ, LTrim(RTrim(IRS_CODE)) as IRS_CODE, Amount_12,lTrim(RTrim(Box_DESC)) As Box_Desc,Amount_14,Amount_11,CHG_DATE,CHG_TIME,CHG_BY,CHG_PGM,CALLING_PGM from Y_PY_W2_ADDL Where Runid = '{0}'",v.Global.iBIRUNID,v.Local.sSQL) 
F.Data.DataTable.CreateFromSQL("dtAddl","CONX",v.Local.sSQL,True)

'Load State
F.Intrinsic.String.Build("Select * from Y_PY_W2_ST Where Runid = '{0}'",v.Global.iBIRUNID,v.Local.sSQL) 
F.Data.DataTable.CreateFromSQL("dtState","CONX",v.Local.sSQL,True)

'load Local
F.Intrinsic.String.Build("Select * from Y_PY_W2_LOC Where Runid = '{0}'",v.Global.iBIRUNID,v.Local.sSQL) 
F.Data.DataTable.CreateFromSQL("dtLoc","CONX",v.Local.sSQL,True)
'merge state and local together
v.Local.sSQL.Set("Select S.Employee,S.State,s.SEQ As State_Seq,S.Tax_ID,S.Wages,S.Withholding,L.Seq As Local_Seq,L.Local_Code,L.wages As LWages,L.WithHolding As LWith From Y_PY_W2_ST S Left Join Y_PY_W2_LOC L On S.RUNID = L.RUNID And S.Employee = L.Employee And S.State = L.State Order By S.Employee,S.State,State_Seq,Local_Seq") 
F.Data.DataTable.CreateFromSQL("dtStateLoc","conX",v.Local.sSQL,True)
'loop through and remove any subsequent records that have duplicated employee and state information, they dont want to see box 
'F.Data.DataTable.AddExpressionColumn("dtAddl","IRS_CODE_COMB","String","IIF(ISNull([IRS_CODE],'') = '',[BOX_DESC],[IRS_CODE])")
F.Data.DataTable.AddExpressionColumn("dtStateLoc","Local_Seq_S","String","ISNull([LocAL_Seq],'')")
Function.Intrinsic.Control.If(v.DataTable.dtStateLoc.Exists,=,True)
	'create a blank view so we can create the formt
	f.Data.DataView.Create("dtStateLoc","dvStateLoc",22,"[Employee] = '9999999'","")
	Gui.Form.gcState.AddGridviewFromDataview("gvStateLoc","dtStateLoc","dvStateLoc")
	GUi.Form.gcState.SetGridviewProperty("gvStateLoc","AllowFilter",False)
	Gui.Form.gcState.SetGridviewProperty("gvStateLoc","AllowColumnMoving",False)
 	Gui.Form.gcState.SetGridviewProperty("gvStateLoc","AllowColumnResizing",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Employee","Visible",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State_Seq","Visible",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Seq","Visible",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Seq_S","Visible",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","Readonly",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","Caption","Box 15")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","Tooltip","15 State")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","AllowSort","False")		
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","MaxLength",2)		
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Tax_ID","Readonly",True)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Tax_ID","Caption","State ID number")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Tax_ID","ToolTip","Employer's State ID Number")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Tax_ID","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Wages","Readonly",True)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Wages","Caption","Box 16")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Wages","Tooltip","16 State wages, tips, etc.")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Wages","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Withholding","Readonly",True)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Withholding","Caption","Box 17")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Withholding","ToolTip","17 State Income Tax")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","WithHolding","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWages","Readonly",True)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWages","Caption","Box 18")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWages","ToolTip","18 Local wages, tips, etc.")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Lwages","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWith","Readonly",True)	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","lWith","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWith","Caption","Box 19")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWith","ToolTip","19 Local Income Tax")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","ReadOnly",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","VisibleIndex",6)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","Caption","Box 20")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","ToolTip","20 Locality Name")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","MaxLength",6)	
	Gui.Form.gcState.MainView("gvStateLoc")
Function.Intrinsic.Control.EndIf


F.ODBC.Connection!conX.TableExists("V_PAYROLL_W2_States",v.Local.bEx)
F.Intrinsic.Control.If(v.Local.bEx,=,True)
	F.Intrinsic.String.Build("Select Code_Char As StateAbb,Code_Num As StateCode From PAYROLL_W2_STATES Where W2_Year = '{0}'",v.Global.iYear,v.Local.sSQL)
	f.Data.DataTable.CreateFromSQL("dtStateList","conX",v.Local.sSQL,True)	
Function.Intrinsic.Control.Else
	F.Data.DataTable.Create("dtStateList","True") 
	F.Data.DataTable.AddColumn("dtStateList","StateAbb","String")
	F.Data.DataTable.AddColumn("dtStateList","StateCode","String")	
	'load state file in Global\Files. only for 16.2 and BELOW!!!!
	F.Intrinsic.String.Build("{0}\{1}W2STATES.txt",v.Caller.FilesDir,v.Caller.CompanyCode,v.Local.sFile)
	Function.Intrinsic.File.Exists(v.Local.sFile,v.Local.bEx) 
	Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
		f.Intrinsic.File.File2String(v.Local.sFile,v.Local.sCont)
		Function.Intrinsic.Control.If(v.Local.sCont.Trim,<>,"") 
			f.Intrinsic.String.Split(v.Local.sCont,v.Ambient.NewLine,v.Local.sCont) 
			Function.Intrinsic.Control.For(v.Local.i,0,v.Local.sCont.UBound) 
				F.Intrinsic.String.PositionalSplit(v.Local.sCont(v.Local.i),v.Local.iPostArray,v.Local.iLengthArray,v.Local.sSQL) 
				f.Intrinsic.Control.If(v.Local.sSQL(1).Trim,<>,"")
					F.Data.DataTable.AddRow("dtStateList","StateAbb",v.Local.sSQL(1),"StateCode",v.Local.sSQL(2))
				f.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.Next(v.Local.i)
		Function.Intrinsic.Control.EndIf		
	Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

Function.Intrinsic.Control.CallSub(dataSection)
'check changes, if it's a no, we load changes if any, if it's y we mark all changes in changes table to flag_deleted True.
Function.Intrinsic.Control.If(v.global.sClear,=,"N")
	Function.Intrinsic.Control.CallSub(LoadChanges) 
Function.Intrinsic.Control.Else
	F.Intrinsic.UI.Msgbox("You have selected to clear ALL previous changes. Are you sure?","Annual W2's ",4,v.Local.sCont)
	F.Intrinsic.Control.If(v.Local.sCont,=,6)
		Function.Intrinsic.Control.CallSub(ClearChanges)
	Function.Intrinsic.Control.Else
		Function.Intrinsic.Control.CallSub(LoadChanges)
	Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.EndIf

'local code replacement
 Function.Intrinsic.Control.CallSub(Box20_Replacement)


F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.LoadData.End

Program.Sub.TableCheck.Start
F.Intrinsic.Control.SetErrorHandler("TABLECHECK_ERR")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.bEx.Declare(Boolean) 

F.ODBC.Connection!conX.TableExists("PY_W2_HEADER_CHANGES",v.Local.bEx) 
Function.Intrinsic.Control.If(v.Local.bEx,=,False) 
	f.ODBC.Connection!conX.Execute("CREATE TABLE PY_W2_HEADER_CHANGES(ID IDENTITY,W2_YEAR CHAR(4),EIN CHAR(11),SUBMIT_PIN CHAR(8),Submit_SFWR_Code CHAR(2),SUBMIT_SFWR_VEN_CODE CHAR(4), SUBMIT_NAME CHAR(57), SUBMIT_LOCATION CHAR(25), SUBMIT_DELIV_ADDRESS CHAR(22), SUBMIT_CITY CHAR(22), SUBMIT_STATE CHAR(2), SUBMIT_ZIP CHAR(10), CONTACT_NAME CHAR(27), CONTACT_EMAIL CHAR(40), CONTACT_PHONE CHAR(15), CONTACT_EXT CHAR(5),CONTACT_FAX CHAR(15), FLAG_DELETE BIT, USERNAME CHAR(8), LAST_CHG_DATE DATETIME);")
Function.Intrinsic.Control.EndIf

f.ODBC.Connection!conX.TableExists("PY_W2_EMP_CHANGES",V.Local.bEx) 
Function.Intrinsic.Control.If(V.Local.bEx,=,FALSE) 
	f.ODBC.Connection!conX.Execute("CREATE TABLE PY_W2_EMP_CHANGES( ID IDENTITY, W2_YEAR CHAR(4), EMPLOYEE_ID CHAR(5), BOX_D CHAR(50), BOX_7 DOUBLE, BOX_8 DOUBLE, BOX_9 CHAR(40),  BOX_11 DOUBLE, BOX_12A_CODE CHAR(2), BOX_12A_AMOUNT DOUBLE, BOX_12B_CODE CHAR(2), BOX_12B_AMOUNT DOUBLE, BOX_12C_CODE CHAR(2), BOX_12C_AMOUNT DOUBLE, BOX_12D_CODE CHAR(2), BOX_12D_AMOUNT DOUBLE, BOX_13_STATEMP BIT, BOX_13_RETIREMENT BIT, BOX_THIRDPARTY BIT, BOX_14 LONGVARCHAR, FLAG_DELETE BIT, USERNAME CHAR(8), LAST_CHG_DATE DATETIME);")
Function.Intrinsic.Control.EndIf

F.ODBC.Connection!conX.TableExists("PY_W2_EMP_STATE_CHGS",v.Local.bEx)
 Function.Intrinsic.Control.If(v.Local.bEx,=,False) 
 	F.ODBC.Connection!conX.Execute("CREATE TABLE PY_W2_EMP_STATE_CHGS( ID IDENTITY, W2_YEAR CHAR(4), EMPLOYEE_ID CHAR(5), BOX_15 CHAR(2),State_Seq CHAR(6), BOX_20 CHAR(15),Loc_Seq CHAR(6), FLAG_DELETE BIT, USERNAME CHAR(8), LAST_CHG_DATE DATETIME);")
 Function.Intrinsic.Control.EndIf

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("TABLECHECK_ERR")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.TableCheck.End

Program.Sub.BuildFile.Start
F.Intrinsic.Control.SetErrorHandler("BuildFileERR")
F.Intrinsic.Control.ClearErrors
v.Local.serror.Declare
v.Local.sString.Declare
v.local.bEx.Declare(Boolean)
v.Local.sFile.Declare(String)
Function.Intrinsic.Control.CallSub(RARecord)
Function.Intrinsic.Control.CallSub(RErecord)
Function.Intrinsic.Control.CallSub(RWRSRecord)
Function.Intrinsic.Control.CallSub(RTRecords)
Function.Intrinsic.Control.CallSub(RURecords)
Function.Intrinsic.Control.CallSub(RFRecord)
F.Intrinsic.String.Build("{0}\{1}",v.Args.Path,"W2REPORTUS.txt",v.Local.sFile)
F.Intrinsic.File.Exists(v.Local.sFile,v.Local.bEx) 
Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
	f.Intrinsic.File.DeleteFile(v.Local.sFile)
Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.CallSub(IsFileLocked,"Path",v.Local.sFile)
F.Intrinsic.StringBuilder.ToString("1",v.Local.sString)
F.Intrinsic.Control.If(v.Local.sString.Trim,<>,"") 
	f.Intrinsic.File.String2File(v.Local.sFile,v.Local.sString)
F.Intrinsic.Control.EndIf
Function.Intrinsic.File.Exists(v.Local.sFile,v.Local.bEx)
F.Intrinsic.Control.If(v.Local.bEx,=,True) 
	Gui.F_Progress.lblEFile.Visible(True)		
	f.Intrinsic.String.Build("Electronic File Created:{0}{1}",v.Ambient.NewLine,v.Local.sFile,v.Local.sString)
	Gui.F_Progress.lblEFile.Caption(v.Local.sString)
	Gui.F_Progress..Size("6405","2310")
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("BuildFileERR")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.BuildFile.End

Program.Sub.RARecord.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sString.Declare(STring)
v.Local.sT.Declare(String)
'RA Section
F.Intrinsic.StringBuilder.Create("1")
F.Intrinsic.Stringbuilder.Append("1","RA")
'ein
F.Intrinsic.String.StripCharacters(v.DataTable.dtSubmitterInfo(0).Value!FieldVal,v.Local.sT)
f.Intrinsic.String.RPad(v.Local.sT," ",9,v.local.sT)
F.Intrinsic.Stringbuilder.Append("1",v.Local.st) 
'user id pIN
F.Intrinsic.String.RPad(v.DataTable.dtSubmitterInfo(1).Value!FieldVal," ",8,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Software VendorCode
F.Intrinsic.String.RPad(v.DataTable.dtSubmitterInfo(2).Value!FieldVal," ",4,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'pad 5 blanks, 0 for resub indicator, 6 blanks for WFID
F.Intrinsic.Stringbuilder.Append("1","     0      ")
'Software Code
F.Intrinsic.String.RPad(v.DataTable.dtSubmitterInfo(3).Value!FieldVal," ",2,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Company Name
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(0).Value!FieldVal," ",57,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Location Addy
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(1).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Delivery Addy
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(2).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'City
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(3).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'State Abbr
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(4).Value!FieldVal," ",2,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Zip Code
'strip characters and pad to 9 since we could have a dash in between the zip and extension
F.Intrinsic.String.StripCharacters(v.DataTable.dtHeaderInfo(5).Value!FieldValTrim,v.Local.sT)
F.Intrinsic.String.RPad(v.Local.sT," ",9,v.Local.st)
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
'5 blank,23 foreign,15 foreign postal,2 country
F.Intrinsic.String.RPad(" "," ",45,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Submitter Name
F.Intrinsic.String.RPad(v.DataTable.dtSubmitterInfo(4).Value!FieldVal," ",57,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Location
F.Intrinsic.String.RPad(v.DataTable.dtSubmitterInfo(5).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Delivery Address
F.Intrinsic.String.RPad(v.DataTable.dtSubmitterInfo(6).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'City
F.Intrinsic.String.RPad(v.DataTable.dtSubmitterInfo(7).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'State
F.Intrinsic.String.RPad(v.DataTable.dtSubmitterInfo(8).Value!FieldVal," ",2,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Zip Code
F.Intrinsic.String.StripCharacters(v.DataTable.dtSubmitterInfo(9).Value!FieldValTrim,v.Local.st)
F.Intrinsic.String.RPad(v.Local.sT," ",9,v.Local.st)
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
'5 blank,23 foreign,15 foreign postal,2 country
F.Intrinsic.String.RPad(""," ",45,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Contact Name
F.Intrinsic.String.RPad(v.DataTable.dtContact(0).Value!FieldVal," ",27,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Contact Phone
F.Intrinsic.String.StripCharacters(v.DataTable.dtContact(1).Value!FieldvalTrim,v.Local.st)
F.Intrinsic.String.RPad(v.local.sT," ",15,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'contact ext plus 3 for blank
F.Intrinsic.String.StripCharacters(v.DataTable.dtContact(2).Value!FieldvalTrim,v.Local.st)
F.Intrinsic.String.RPad(v.Local.st," ",8,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Email, plus 3 blank
F.Intrinsic.String.RPad(v.DataTable.dtContact(3).Value!FieldVal," ",43,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Contact Fax
F.Intrinsic.String.StripCharacters(v.DataTable.dtContact(4).Value!FieldvalTrim,v.Local.st)
F.Intrinsic.String.RPad(v.local.sT," ",11,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Preparer Code, default L, Self Prepared
F.Intrinsic.Stringbuilder.Append("1","L            ")
F.Intrinsic.StringBuilder.toString("1",v.Local.sString)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.RARecord.End

Program.Sub.RERecord.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sT.Declare
v.Local.bSet.Declare(Boolean)
'RE Section 
F.Intrinsic.StringBuilder.AppendLine("1","")
F.Intrinsic.StringBuilder.Append("1","RE")
'Year
F.Intrinsic.StringBuilder.Append("1",v.Global.iYear)
'agent indicator code blank
F.Intrinsic.StringBuilder.Append("1"," ")	
'Employer/Agent EIN. If this is the Agent, or Employer EIN will be the next value.
F.Intrinsic.String.StripCharacters(v.DataTable.dtHeader(0).Federal_ID!FieldValTrim,v.Local.sT) 
F.Intrinsic.String.Rpad(v.Local.sT," ",9,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.st) 
'Agent for EIN
v.Local.sT.Set("")
F.Intrinsic.String.RPad(v.Local.sT," ",9,v.local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.st)
'Term Business Indicator
F.Intrinsic.StringBuilder.Append("1","0")
'Pad for Establishment Number and other EIN
F.Intrinsic.String.Rpad(""," ",13,v.Local.st) 
F.Intrinsic.stringbuilder.append("1",v.Local.st)
'Company Name
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(0).Value!FieldVal," ",57,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(1).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(2).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(3).Value!FieldVal," ",22,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
F.Intrinsic.String.RPad(v.DataTable.dtHeaderInfo(4).Value!FieldVal," ",2,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Submit Zip
F.Intrinsic.String.StripCharacters(v.DataTable.dtHeaderInfo(5).Value!FieldValTrim,V.Local.ST)
F.Intrinsic.String.RPad(v.local.sT," ",9,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Kind Employer
v.Local.sT.Set(" ")
F.Intrinsic.Control.If(v.DataTable.dtW2Data.Exists,=,True)
	F.Intrinsic.Control.If(v.DataTable.dtW2Data.RowCount--,>=,0)	
		Function.Intrinsic.Control.SelectCase(v.DataTable.dtW2Data(0).Kind_Employer!FieldVal)	
			F.Intrinsic.Control.Case("1")
				'F = Federal govt.
				v.local.sT.Set("F")		
			F.Intrinsic.Control.Case("2")
				'S = State/local non-501c
				v.local.sT.Set("S")
			F.Intrinsic.Control.Case("3")
				'T 501c non-govt
				v.local.sT.Set("T")
			F.Intrinsic.Control.Case("4")
				'State/Local 501C Y
				v.local.sT.Set("Y")
			F.Intrinsic.Control.Case("5")
				'none apply
				v.local.sT.Set("N")				
		Function.Intrinsic.Control.EndSelect
	F.Intrinsic.Control.EndIf	
Function.Intrinsic.Control.EndIf
'if I have an else it jumps to it auto can't have that. so thats been submitted can't wait on fix. 
F.Intrinsic.Control.If(v.DataTable.dtW2Data.Exists,=,False,"OR",v.DataTable.dtW2Data.RowCount--,<,0) 
	v.local.sT.Set("N")				
F.Intrinsic.Control.EndIf

F.Intrinsic.Stringbuilder.Append("1",v.Local.sT)

'blank 4, Foreing StateProvince 23,Foreign Postal Cde,15,Country Code 2
F.Intrinsic.String.RPad(""," ",44,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Employment COde 
F.Intrinsic.StringBuilder.Append("1","R")
'Tax jurisdiction 'ThirdPartySick Flag
f.Intrinsic.StringBuilder.Append("1"," 0")
'Contact Name.
F.Intrinsic.String.RPad(v.DataTable.dtContact(0).Value!FieldVal," ",27,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'Phone Number
F.Intrinsic.String.StripCharacters(v.DataTable.dtContact(1).Value!FieldvalTrim,v.Local.st)
F.Intrinsic.String.RPad(v.local.sT," ",15,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'extension contact
F.Intrinsic.String.StripCharacters(v.DataTable.dtContact(2).Value!FieldValTrim,v.Local.st)
F.Intrinsic.String.RPad(v.local.sT," ",5,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'contact fax
F.Intrinsic.String.StripCharacters(v.DataTable.dtContact(4).Value!FieldvalTrim,v.Local.st)
F.Intrinsic.String.RPad(v.Local.sT," ",10,v.Local.st)
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
'contact email
F.Intrinsic.String.RPad(v.DataTable.dtContact(3).Value!FieldVal," ",234,v.Local.st) 
F.Intrinsic.Stringbuilder.Append("1",v.Local.st)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.RERecord.End

Program.Sub.RWRSRecord.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.i.Declare
v.Local.sRet.Declare(String)
v.Local.sT.Declare(String)
v.Local.sSel.Declare(String)
v.Local.sOrdinal.Declare(String)
v.Local.iO.Declare(Long)
v.Local.fAmount.Declare(Float)
'get unique employees.
F.Data.Dictionary.CreateFromDataTable("dicEmp","dtEmp","Employee","Employee",4)
F.Data.Dictionary.ReturnAllPairs("dicEmp",v.Local.sRet)
Function.Intrinsic.Control.If(v.local.sRet.Trim,<>,"***NORETURN***")
	F.Intrinsic.String.Split(v.Local.sRet,"!*!",v.Local.sret) 
	F.Intrinsic.String.Split(v.Local.sRet(0),"*!*",v.Local.sret)
	F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)	
		F.Intrinsic.String.Build("[EMPLOYEE] = '{0}'",v.Local.sRet(v.Local.i),v.Local.sSel) 
		F.Data.DataTable.Select("dtEmp",v.Local.sSel,V.Local.sOrdinal)		
		Function.Intrinsic.Control.If(v.Local.sOrdinal.Trim,<>,"***NORETURN***") 
			F.Intrinsic.String.Split(v.Local.sOrdinal,"*!*",v.local.sOrdinal)	
			'should only be one right?
			'RW Record. 
			F.Intrinsic.StringBuilder.AppendLine("1","") 
			F.Intrinsic.Stringbuilder.Append("1","RW") 
			f.Intrinsic.Math.Add(v.Global.iRWCount,1,v.Global.iRWCount)
			'Social 
			F.Intrinsic.String.StripCharacters(v.DataTable.dtEmp(v.Local.sOrdinal(0)).SSN!FieldValTrim,v.Local.sT)			
			F.Intrinsic.String.RPad(v.Local.sT,"0","9",v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT) 
			'Emp First Name. 
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sOrdinal(0)).First_name!FieldVal," ",15,v.Local.sT)
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			'EmpMiddleName or Initial
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Middle_Init!FieldVal," ",15,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			'Last name
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Last_Name!FieldVal," ",20,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'Suffix aND lOCATION 
			F.Intrinsic.String.RPad(""," ",26,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'Delivery Addy
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Street!FieldVal," ",22,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'City			
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sOrdinal(0)).City!FieldVal," ",22,v.Local.sT)
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'State 
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sOrdinal(0)).State!FieldVal," ",2,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'Zip and Ext and fillers.
			F.Intrinsic.String.StripCharacters(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Zip!FieldVal,v.Local.st)
			F.Intrinsic.String.RPad(v.Local.sT," ",9,v.Local.st)
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			F.Intrinsic.String.RPad(""," ",45,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)					
			
			'Fed Wages					
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Fed_Wages!FieldValFloat,"####.00",v.Local.sT)						
			f.Intrinsic.String.StripCharacters(v.Local.sT,v.Local.st)			
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)					
			'FedWithholdings
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).FED_WITHHOLDING!FieldVal,"####.00",v.Local.st)
			f.Intrinsic.String.StripCharacters(v.Local.sT,v.Local.sT)			
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)				
			'Social Sec Wages 
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).FICA_WAGES!FieldValFloat,"####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.local.sT,v.Local.sT) 
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)					
			'Social Security Tax WithHeld
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).FICA_WITHHOLDING!FieldVal,"#####.00",v.Local.st)
			Function.Intrinsic.String.StripCharacters(v.Local.sT,v.Local.sT)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'Med Wages and TIps
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Medi_Wages!FieldVal,"####.00",v.Local.sT)
			Function.Intrinsic.String.StripCharacters(v.Local.sT,v.Local.sT)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'MediWH
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).MEDI_WITHHOLDING!FieldVal,"####.00",v.Local.sT)
			Function.Intrinsic.String.StripCharacters(v.Local.sT,v.local.sT)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'Social Security Tips
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).SS_TIPS!FieldVal,"####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.sT,v.Local.sT)
			'remove this we are removig it
			v.Local.sT.Set("0")
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT)			
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'Blanks
			F.Intrinsic.String.RPad(""," ",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			'Dependenct Care
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Dep_Care!FieldVal,"####.00",v.Local.sT)
			Function.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)		
			
			'401k 
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='D'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'403B 
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='E'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)			
			
			'408 K 
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='F'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT)
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'457B
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='G'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'501(c)
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='H'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'blanks 11. 
			F.Intrinsic.String.RPad(""," ",11,v.Local.st) 
			f.Intrinsic.StringBuilder.Append("1",v.Local.st) 
			
			'457 Disburse
			'pull from the screen, box 11 amount.
			F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sOrdinal(0)).NQ_PLAN!FieldVal,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.sT,v.Local.sT)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT)
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'emp HSA Account 
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='W'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'nonqualified plans NOT NQ_PLAN
'			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel)
'			F.Data.DataTable.Compute("dtEmp","SUM([NQ_PLAN])",v.Local.sSel,v.Local.fAmount)
'			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
'			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			v.Local.sT.Set("")
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT)  
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'non taxable combat pay
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='Q'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			
			F.Intrinsic.String.RPad(""," ",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)			
						
			'Life-Ins
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='C'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'Stock income 
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='V'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'409A Deferral	
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='Y'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'401k-Roth
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='AA'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT)  
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'403b-Roth
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='BB'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'Emplr-Health
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='DD'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			
			'Permitted benefits Code FF 
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And TRIM([IRS_CODE_COMB])='FF'",v.DataTable.dtEmp(v.Local.sOrdinal(0)).Employee!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			
			'1 Blank 
			F.Intrinsic.StringBuilder.Append("1"," ") 
			
			'Statutory Employee, Goes off of checkbox in box 13.			
			Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Statutory_EMP!FieldVal,=,"Y") 
				v.Local.sT.Set("1")				
			Function.Intrinsic.Control.Else
				v.Local.sT.Set("0")				
			Function.Intrinsic.Control.EndIf
			f.Intrinsic.StringBuilder.Append("1",v.Local.st)
			
			'1 Blank 
			F.Intrinsic.StringBuilder.Append("1"," ")
			
			'Retirement Indicator.			
			Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Retirement_Plan!FieldVal,=,"Y") 
				v.Local.sT.Set("1")				
			Function.Intrinsic.Control.Else
				v.Local.sT.Set("0")				
			Function.Intrinsic.Control.EndIf			
			
			F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
					 
			
			
			'Third Party Sick Indicator.			
			Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.sOrdinal(0)).Third_Party_Sick!FieldValString,=,"Y") 
				v.Local.sT.Set("1")				
			Function.Intrinsic.Control.Else
				v.Local.sT.Set("0")				
			Function.Intrinsic.Control.EndIf
			f.Intrinsic.StringBuilder.Append("1",v.Local.st)
			
			
			'23 blank
			F.Intrinsic.String.RPad(""," ",23,v.Local.sT)			
			F.Intrinsic.StringBuilder.Append("1",v.Local.st)
			
			'RO Optional Record only if they have amounts in it. 
			'Codes: R, S, T,Z,or EE. 
			'Callsub for RO, just easier. 
			Function.Intrinsic.Control.CallSub(RORecord,"Employee",v.DataTable.dtEmp(v.Local.sOrdinal(0)).EMPLOYEE!FieldVal)						
			'RS Records.			
			Function.Intrinsic.Control.CallSub(RSRecords,"Employee",v.DataTable.dtEmp(v.Local.sOrdinal(0)).EMPLOYEE!FIeldVal)
			
		Function.Intrinsic.Control.Endif
	F.Intrinsic.Control.Next(v.Local.i)
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.RWRSRecord.End

Program.Sub.RORecord.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sT.Declare(String) 
v.Local.sType.Declare(String)
v.Local.i.Declare
v.Local.sRet.Declare(String)
v.Local.bP.Declare(Boolean)
v.Local.sSel.Declare(String)
v.Local.fAmount.Declare(FLoat)
F.Intrinsic.String.Split("A*!*B*!*R*!*S*!*T*!*Z*!*EE*!*GG*!*HH","*!*",v.Local.sType) 
'search through our ADDL and see if any of the following are found, if one is, we have to create the RO for this employee. IF not, we can move out and not create the RO record. 
F.Intrinsic.Control.For(v.Local.i,0,v.Local.sType.UBound,1) 
	F.Intrinsic.String.Build("[EMPLOYEE]='{0}' And Trim([IRS_CODE_COMB]) = '{1}'",v.Args.Employee,v.Local.sType(v.Local.i),v.Local.sT) 
	F.Data.DataTable.Select("dtAddl",v.Local.sT,v.Local.sRet)
	Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
		v.Local.bP.Set(True) 	
		f.Intrinsic.Control.ExitFor(v.Local.i)
	Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(v.Local.i)
'if the sum of allocated tips is greater than zero we must create a RO. 
Function.Intrinsic.Control.If(v.Local.bP,=,False)	
	'Allocated Tip Box 8. 	
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtEmp","Sum([ALLO_TIPS])",v.Local.sSel,v.Local.fAmount)
	Function.Intrinsic.Control.If(v.Local.fAmount,>,0)
		v.Local.bP.Set(True)
	Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.EndIf

Function.Intrinsic.Control.If(v.Local.bP,=,True) 
 	'means we process. 
 	F.Intrinsic.StringBuilder.AppendLine("1","") 
 	F.Intrinsic.Stringbuilder.Append("1","RO") 
 	F.Intrinsic.Math.Add(v.Global.iROCount,1,v.Global.iROCount)
 	'blank 9 
 	F.Intrinsic.String.RPad(""," ",9,v.Local.st) 
 	F.Intrinsic.Stringbuilder.append("1",v.Local.st)
 	
 	'Allocated Tip Box 8. 	
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtEmp","Sum([ALLO_TIPS])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
		
	'Uncollected Employee tax on Tips, codes a and b combined
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And (Trim([IRS_CODE_COMB])='A' OR Trim([IRS_CODE_COMB]) ='B')",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Medical Savings. 
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'R'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Simple Retirment.
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'S'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Qualified Adoption
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'T'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Uncollected Social.
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'M'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Uncollected Medicare
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'N'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Incom under NonQualifeid 
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'Z'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Blank.11 
	F.Intrinsic.String.RPad(""," ",11,v.Local.st) 
 	F.Intrinsic.Stringbuilder.append("1",v.Local.st)

	'Code EE designated roth	
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'EE'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)	
	
	
	'Code GG Income earned from Qualified Equity Grants	
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'GG'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)	
	
	'Code HH Aggregate Deferalls Under Section 83(i) Elections as of the Close of the calendar year	
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And Trim([IRS_CODE_COMB]) = 'HH'",v.Args.Employee,v.Local.sSel) 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])",v.Local.sSel,v.Local.fAmount)
	f.Intrinsic.String.Format(v.Local.fAmount,"######.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
	F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)	
	
		
	F.Intrinsic.String.RPad(""," ",131,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
	F.Intrinsic.String.RPad("","0",77,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
	F.Intrinsic.String.RPad(""," ",11,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
	F.Intrinsic.String.RPad("","0",22,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
	F.Intrinsic.String.RPad(""," ",128,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
Function.Intrinsic.Control.EndIf

F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)	
Function.Intrinsic.Control.EndIf
Program.Sub.RORecord.End

Program.Sub.RSRecords.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sT.Declare(String) 
v.local.sRet.Declare(STring) 
v.Local.sRetState.Declare(String)
v.Local.i.Declare(Long)
v.Local.sSel.Declare(String)
v.Local.fAmount.Declare(Float)
v.Local.iLoc.Declare(Long)
v.Local.bState.Declare(Boolean) 
v.Local.bLoc.Declare(boolean)
v.Local.sLocCode.Declare
'so for every state in our statedt we have to find employee records on the employee we are on and create RS records.
F.Intrinsic.StringBuilder.Create("RsState")			
F.Intrinsic.StringBuilder.Create("RsLoc")
F.Intrinsic.Control.For(v.Local.i,0,v.DataTable.dtStateList.RowCount--,1)
	'first make sure we have state records for this employee. 
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [State] ='{1}'",v.Args.Employee,v.DataTable.dtStatelist(v.Local.i).StateAbb!FieldvalString,v.Local.sSel)
	
	Function.Data.DataTable.Select("dtStateLoc",v.Local.sSel,v.Local.sRet)
	Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")	
		'GetEmp Information	
		F.Intrinsic.String.Build("[EMPLOYEE] = '{0}'",v.Args.Employee,v.Local.sSel)
		Function.Data.DataTable.Select("dtEmp",v.Local.sSel,v.Local.sRet)	
		Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
			
			'should only be one right?
			F.Intrinsic.String.Split(v.Local.sRet,*!*,v.Local.sRet)			
'			F.Intrinsic.StringBuilder.AppendLine("1","")
			'RS
			F.Intrinsic.stringbuilder.Append("RsState","RS")
			'StateCode
			Function.Intrinsic.Control.If(v.DataTable.dtStateList(v.Local.i).StateCode!FieldValTrim,=,"")
				v.Local.sT.Set("")
			Function.Intrinsic.Control.Else
				v.Local.sT.Set(v.DataTable.dtStateList(v.Local.i).StateCode!FieldValTrim)
			Function.Intrinsic.Control.EndIf
			f.Intrinsic.String.RPad(v.Local.sT," ",2,v.Local.st)
			F.Intrinsic.StringBuilder.Append("RsState",v.Local.st)
			'Taxin Entitty Code
'			blank five
			F.Intrinsic.StringBuilder.Append("RSState","     ") 
			
			'SSN 
			f.Intrinsic.String.StripCharacters(v.DataTable.dtEmp(v.Local.sRet(0)).SSN!FieldVal,v.Local.sT) 
			F.Intrinsic.String.LPad(v.Local.sT,"0",9,v.Local.st) 
			F.Intrinsic.Stringbuilder.Append("RSState",v.Local.st)
			
			'First Name 
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).First_Name!Fieldval," ",15,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT) 
			
			'Middle
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).Middle_INIT!Fieldval," ",15,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT) 
			
			'Last Name
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).Last_Name!Fieldval," ",20,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			'Suffix
			F.Intrinsic.String.RPad(""," ",4,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			'Location Addy
			F.Intrinsic.String.RPad(""," ",22,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			'Delv Addy
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).Street!Fieldval," ",22,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			'City
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).City!Fieldval," ",22,v.Local.sT)			
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			'State
			F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).State!Fieldval," ",2,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			'Zip			
			F.Intrinsic.String.StripCharacters(v.DataTable.dtEmp(v.Local.sRet(0)).Zip!Fieldval,v.Local.st)
			F.Intrinsic.String.RPad(v.Local.sT," ",9,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			'blank,foreginprovince,foreign postal,country code
			f.Intrinsic.String.RPad(""," ",98,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
									
			'State Employer tax ID.		
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [State] ='{1}'",v.Args.Employee,v.DataTable.dtStatelist(v.Local.i).StateAbb!FieldvalString,v.Local.sSel)
			F.Data.DataTable.Select("dtState",v.Local.sSel,v.Local.sRetstate)
			
			
			
			F.Intrinsic.Control.If(v.Local.sRetState.Trim,<>,"***NORETURN***")
				F.Intrinsic.String.Split(v.Local.sRetState,"*!*",v.Local.sRetState)
				F.Intrinsic.String.RPad(v.DataTable.dtState(v.Local.sRetState(0)).Tax_ID!FieldValTrim," ",20,v.Local.sT)			
			Function.Intrinsic.Control.Else
				F.Intrinsic.String.RPad(""," ",20,v.Local.sT)
			F.Intrinsic.Control.EndIf
			
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			'blank six.
			F.Intrinsic.String.RPad(""," ",6,v.Local.sT)
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)			
			
			'State Code. 
			F.Intrinsic.String.RPad(v.DataTable.dtStateList(v.Local.i).StateCode!FieldValString," ",2,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)			
						
			'Taxable Wages. 
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [STATE] = '{1}'",v.DataTable.dtEmp(v.Local.sRet(0)).Employee!FieldVal,v.DataTable.dtStateList(v.Local.i).StateAbb!FieldVal,v.Local.sSel) 
			F.Data.DataTable.Compute("dtTotal","SUM([WAGES])",v.Local.sSel,v.Local.fAmount) 
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			'State Income Withheld. 
			F.Data.DataTable.Compute("dtTotal","SUM([WITHHOLDING])",v.Local.sSel,v.Local.fAmount) 
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
						
			'Other State data 
			F.Intrinsic.String.RPad(""," ",10,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
			
			v.Local.bState.Set(True)
		Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.Else	
		F.Intrinsic.String.Build("[EMPLOYEE] = '{0}'",v.Args.Employee,v.Local.sSel)
		Function.Data.DataTable.Select("dtEmp",v.Local.sSel,v.Local.sRet)	
		f.Intrinsic.String.Split(v.Local.sRet.Trim,"*!*",v.Local.sRET)
		'RS
		F.Intrinsic.stringbuilder.Append("RsState","RS")
		'StateCode
		'StateCode
		Function.Intrinsic.Control.If(v.DataTable.dtStateList(v.Local.i).StateCode!FieldValTrim,=,"")
			v.Local.sT.Set("")
		Function.Intrinsic.Control.Else
			v.Local.sT.Set(v.DataTable.dtStateList(v.Local.i).StateCode!FieldValTrim)
		Function.Intrinsic.Control.EndIf
		f.Intrinsic.String.RPad(v.Local.sT," ",2,v.Local.st)
		F.Intrinsic.StringBuilder.Append("RsState",v.Local.st)
		
		'Taxin Entitty Code
	'		blank five
		F.Intrinsic.StringBuilder.Append("RSState","     ") 
			
		'SSN 
		f.Intrinsic.String.StripCharacters(v.DataTable.dtEmp(v.Local.sRet(0)).SSN!FieldVal,v.Local.sT) 
		F.Intrinsic.String.LPad(v.Local.sT,"0",9,v.Local.st) 
		F.Intrinsic.Stringbuilder.Append("RSState",v.Local.st)
				
		'First Name 
		F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).First_Name!Fieldval," ",15,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT) 
		
		'Middle
		F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).Middle_INIT!Fieldval," ",15,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT) 
		
		'Last Name
		F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).Last_Name!Fieldval," ",20,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		'Suffix
		F.Intrinsic.String.RPad(""," ",4,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		'Location Addy
		F.Intrinsic.String.RPad(""," ",22,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		'Delv Addy
		F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).Street!Fieldval," ",22,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		'City
		F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).City!Fieldval," ",22,v.Local.sT)			
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		'State
		F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).State!Fieldval," ",2,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		'Zip			
		F.Intrinsic.String.RPad(v.DataTable.dtEmp(v.Local.sRet(0)).ZIP!Fieldval," ",5,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		'blank Zip code ext,blank,foreginprovince,foreign postal,country code
		f.Intrinsic.String.RPad(""," ",128,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		
		'State Code. 
		F.Intrinsic.String.RPad(v.DataTable.dtStateList(v.Local.i).StateCode!FieldValString," ",2,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		'Taxable Wages.			
		F.Intrinsic.String.LPad("","0",11,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		
		'State Income Withheld.			
		F.Intrinsic.String.LPad("0","0",11,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
					
		'Other State data 
		F.Intrinsic.String.RPad(""," ",10,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RSState",v.Local.sT)
		v.Local.bState.Set(False)
	Function.Intrinsic.Control.EndIf
	'Local Type, first char of local code.		
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [State] ='{1}' And Trim([Local_Code]) <> ''",v.Args.Employee,v.DataTable.dtStatelist(v.Local.i).StateAbb!FieldvalString,v.Local.sSel)
	F.Data.DataTable.Select("dtStateLoc",v.Local.sSel,v.Local.sRetState)		
	Function.Intrinsic.Control.If(v.Local.sRetState.Trim,<>,"***NORETURN***")				
		F.Intrinsic.String.Split(v.Local.sRetState,"*!*",v.Local.sretstate)
		F.Intrinsic.Control.For(v.Local.iLoc,0,v.Local.sRetState.UBound,1)
		
			F.Intrinsic.String.Left(v.DataTable.dtStateLoc(v.Local.sRetState(v.Local.iLoc)).Local_Code!FieldValTrim,1,v.Local.sT)									
			'have to check and make sure we aren't on the same first character local code, as that has already been taken care of it in the first instance
			F.Intrinsic.Control.If(v.Local.sLocCode.Trim,=,v.Local.sT.trim) 
				f.Intrinsic.Control.ExitFor(v.Local.iLoc)
			F.Intrinsic.Control.EndIf			
			v.Local.sLocCode.Set(v.Local.st)
			
			F.Intrinsic.String.RPad(v.Local.sT," ",1,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RsLoc",v.Local.sT)			
			'sum based on state and local code. 
			F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [State] ='{1}' And Substring([Local_Code],1,1) = '{2}'",v.Args.Employee,v.DataTable.dtStatelist(v.Local.i).StateAbb!FieldvalString,v.Local.sT,v.Local.sSel)				
			'Local Tax Wages. 
			F.Data.DataTable.Compute("dtStateLoc","Sum([LWAGES])",v.Local.sSel,v.Local.fAmount) 
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RsLoc",v.Local.sT) 
				
			'Local Income Tax WIthheld 
			F.Data.DataTable.Compute("dtStateLoc","Sum([LWITH])",v.Local.sSel,v.Local.fAmount) 
			F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
			F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.st)
			F.Intrinsic.String.LPad(v.Local.sT,"0",11,v.Local.sT) 
			F.Intrinsic.StringBuilder.Append("RsLoc",v.Local.sT) 
				
	'		fill for 182  
			F.Intrinsic.String.RPad(""," ",182,v.Local.st) 
			F.Intrinsic.StringBuilder.Append("RsLoc",v.Local.sT)				
				
			'build string.							
			F.Intrinsic.StringBuilder.AppendLine("1","")
			F.Intrinsic.StringBuilder.ToString("RsState",v.Local.st)
			f.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			F.Intrinsic.StringBuilder.ToString("RsLoc",v.Local.st)
			f.Intrinsic.StringBuilder.Append("1",v.Local.sT)			
			'clear RsLoc going onto new local code for same state.
			F.Intrinsic.StringBuilder.Clear("RsLoc")
		F.Intrinsic.Control.Next(v.Local.iLoc)	 
	Function.Intrinsic.Control.Else		
		'create blanks				
		F.Intrinsic.String.RPad(""," ",1,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RsLoc",v.Local.sT) 
						
		'Local Tax Wages. 
		F.Intrinsic.String.LPad("","0",11,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RsLoc",v.Local.sT) 
			
		'Local Income Tax WIthheld				
		F.Intrinsic.String.LPad("","0",11,v.Local.sT) 
		F.Intrinsic.StringBuilder.Append("RsLoc",v.Local.sT) 
			
	'	fill for 182  
		F.Intrinsic.String.RPad(""," ",182,v.Local.st) 
		F.Intrinsic.StringBuilder.Append("RsLoc",v.Local.sT)	
		v.Local.bLoc.Set(False)				
		'if we have a state record, but no local we will have data for state and padded data for local.
		Function.Intrinsic.Control.If(v.Local.bState,=,True)
			F.Intrinsic.StringBuilder.AppendLine("1","")
			F.Intrinsic.StringBuilder.ToString("RsState",v.Local.st)
			f.Intrinsic.StringBuilder.Append("1",v.Local.sT)
			F.Intrinsic.StringBuilder.ToString("RsLoc",v.Local.st)
			f.Intrinsic.StringBuilder.Append("1",v.Local.sT)	
		Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.EndIf			
	F.Intrinsic.StringBuilder.Clear("RSState") 
	F.Intrinsic.StringBuilder.Clear("RsLoc")
F.Intrinsic.Control.Next(v.Local.i)
F.Intrinsic.StringBuilder.Dispose("RsState")
F.Intrinsic.StringBuilder.Dispose("RsLoc")
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.RSRecords.End

Program.Sub.RTRecords.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sT.Declare(String) 
v.Local.fAmount.Declare(Float) 
v.Local.sSel.Declare(String)
'RT Records: 
F.Intrinsic.StringBuilder.AppendLine("1","") 
F.Intrinsic.StringBuilder.Append("1","RT")
'# of RW Recs. 
F.Intrinsic.String.LPad(v.Global.iRWCount,"0",7,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)
'Total Wages,Tips,and Other Comp
F.Data.DataTable.Compute("dtEmp","Sum([FED_WAGES])","",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.sT)
F.Intrinsic.String.StripCharacters(v.Local.sT,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)
'Sum Wages Tips and Other COmp
F.Data.DataTable.Compute("dtEmp","Sum([FED_WITHHOLDING])","",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)
'Sum Social Security Wages
F.Data.DataTable.Compute("dtEmp","Sum([FICA_WAGES])","",v.Local.fAmount) 
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)
'Sum Social Security WithHeld
F.Data.DataTable.Compute("dtEmp","Sum([FICA_WITHHOLDING])","",v.Local.fAmount) 
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT)  
F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)
'Medicare Wages 
F.Data.DataTable.Compute("dtEmp","Sum([MEDI_WAGES])","",v.Local.fAmount) 
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT)  
F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)
'Sum Medi WithHOld
F.Data.DataTable.Compute("dtEmp","Sum([MEDI_WITHHOLDING])","",v.Local.fAmount) 
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT)  
F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)
'Sum Social Security Tips 
F.Data.DataTable.Compute("dtEmp","Sum([SS_TIPS])","",v.Local.fAmount) 
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT)
'remove this. 
v.Local.sT.Set("0")
F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)

'blank 15
F.Intrinsic.String.LPad(""," ",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)

'DependentCare 
F.Data.DataTable.Compute("dtEmp","Sum([DEP_CARE])","",v.Local.fAmount) 
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT)  
F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.local.sT)

'401k 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'D'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'403B 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='E'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'408 K 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'F'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'457B 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='G'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'501(c) 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='H'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'blanks 15. 
F.Intrinsic.String.RPad(""," ",15,v.Local.st) 
f.Intrinsic.StringBuilder.Append("1",v.Local.st) 

'457 Disburse
'pull from the screen, box 11 amount.
F.Data.DataTable.Compute("dtEmp","Sum([NQ_PLAN])","",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT)
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'emp HSA Account 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='W'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'pad nonqualified plan not section 457???? cause it's not NQ_PLAN
F.Intrinsic.String.LPad("","0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'Non taxable combat pay. 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='Q'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'Emplr-Health 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='DD'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'Life-Ins 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='C'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'Income Tax WIthHeld????
F.Intrinsic.String.LPad("","0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'Stock income 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='V'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'409A Deferral	 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='Y'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'401k-Roth 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='AA'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'403b-Roth 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='BB'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.St,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'Permitted benefits Code FF 
F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB])='FF'",v.Local.fAmount)
F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
F.Intrinsic.String.LPad(v.Local.St,"0",15,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

'blank 
F.Intrinsic.String.LPad(""," ",98,v.Local.sT) 
F.Intrinsic.StringBuilder.Append("1",v.Local.sT)

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.RTRecords.End

Program.Sub.RURecords.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sT.Declare(String) 
v.Local.fAmount.Declare(Float)

Function.Intrinsic.Control.If(v.Global.iROCount,>,0)
	
	'means we process. 
	F.Intrinsic.StringBuilder.AppendLine("1","") 
	F.Intrinsic.Stringbuilder.Append("1","RU")	
	
	'Number of RO recs. 
	F.Intrinsic.String.LPad(v.Global.iROCount,"0",7,v.Local.sT) 
	F.Intrinsic.Stringbuilder.Append("1",v.Local.sT)	
	
	'Allocated Tip Box 8. 		
	F.Data.DataTable.Compute("dtEmp","SUM([ALLO_TIPS])","",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.st,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Uncollected Employee tax on Tips, codes a and b combined	 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","(Trim([IRS_CODE_COMB])='A' OR Trim([IRS_CODE_COMB]) ='B')",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Medical Savings.	
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'R'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Simple Retirment.	 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'S'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Qualified Adoption	 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'T'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Uncollected Social. 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'M'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Uncollected Medicare	 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'N'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Incom under NonQualifeid	 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'Z'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)
	
	'Blank.11 
	F.Intrinsic.String.RPad(""," ",15,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
	'Code EE designated roth		 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'EE'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)	
	
	'Code GG designated roth		 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'GG'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)	
	
	'Code HH designated roth		 
	F.Data.DataTable.Compute("dtAddl","Sum([AMT_12_14_COMB])","Trim([IRS_CODE_COMB]) = 'HH'",v.Local.fAmount)
	F.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
	F.Intrinsic.String.StripCharacters(v.Local.st,v.Local.sT) 
	F.Intrinsic.String.LPad(v.Local.sT,"0",15,v.Local.sT)
	F.Intrinsic.StringBuilder.Append("1",v.Local.sT)	
	
	F.Intrinsic.String.RPad(""," ",165,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
	'pad zeroes
	F.Intrinsic.String.RPad("","0",135,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
	F.Intrinsic.String.RPad(""," ",23,v.Local.st) 
	F.Intrinsic.StringBuilder.append("1",v.Local.st)
	
	
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf

Program.Sub.RURecords.End

Program.Sub.RFRecord.Start
F.Intrinsic.Control.SetErrorHandler("Sub_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sT.Declare(String) 

f.Intrinsic.stringBuilder.AppendLine("1","") 
f.Intrinsic.stringBuilder.Append("1","RF")

F.Intrinsic.String.RPad(""," ",5,v.Local.st) 
F.Intrinsic.Stringbuilder.append("1",v.Local.st)
'num RW recs
F.Intrinsic.String.lPad(v.Global.iRWCount,"0",9,v.Local.st)
F.Intrinsic.Stringbuilder.append("1",v.Local.st)

F.Intrinsic.String.RPad(""," ",496,v.Local.st) 
F.Intrinsic.Stringbuilder.append("1",v.Local.st)

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sub_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.RFRecord.End

Program.Sub.LoadEmpScreen.Start
	F.Intrinsic.Control.SetErrorHandler("LoadEmpScreen_Err")
	F.Intrinsic.Control.ClearErrors
	
		v.Local.i.Declare(Long)
		V.Local.sError.Declare(String)
		v.Local.sSel.Declare(String)
		v.Local.sRet.Declare(STring)
		v.Local.sT.Declare(String)
		v.Local.sLastName.Declare(String)
		v.Local.sSuffix.Declare(String)
		Function.Intrinsic.Control.BlockEvents
		'here we load the employee screen with their information.
		'read employee
		
		v.Global.sEmpID.Set(v.Screen.Form!txtEmpID.text)
		
		F.Intrinsic.String.Build("[Employee] = '{0}'",v.global.sEmpID,v.Local.sSeL) 
		F.Data.DataTable.Select("dtEmp",v.Local.sSel,v.Local.sRet)
		F.Intrinsic.Control.If(v.local.sRet.Trim,<>,"***NORETURN***")
			F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret)			
			'box b. 
			
			F.Intrinsic.String.RPad(v.DataTable.dtHeader(0).Federal_ID!FieldVal," ",11,v.Local.st)
			Gui.Form.txtEIN.Text(v.Local.st)	
			Function.Intrinsic.Control.If(v.DataTable.dtHeaderInfo(1).Value!FieldValTrim,=,"")
				F.Intrinsic.String.Build("{1}{0}{2}{0}{3}, {4} {5}",v.Ambient.NewLine,v.DataTable.dtHeaderInfo(0).Value!FieldValTrim,v.DataTable.dtHeaderInfo(2).Value!FieldValTrim,v.DataTable.dtHeaderInfo(3).Value!FieldValTrim,v.datatable.dtHeaderInfo(4).Value!FIeldValTrim,v.DataTable.dtheaderinfo(5).Value!FieldValTrim,v.Local.sT)
			Function.Intrinsic.Control.Else
				F.Intrinsic.String.Build("{1}{0}{6}{0}{2}{0}{3},{4} {5}",v.Ambient.NewLine,v.DataTable.dtHeaderInfo(0).Value!FieldValTrim,v.DataTable.dtHeaderInfo(2).Value!FieldValTrim,v.DataTable.dtHeaderInfo(3).Value!FieldValTrim,v.datatable.dtHeaderInfo(4).Value!FIeldValTrim,v.DataTable.dtheaderinfo(5).Value!FieldValTrim,v.DataTable.dtheaderinfo(1).Value!FieldValTrim,v.Local.sT)
			Function.Intrinsic.Control.EndIf
			Gui.form.txtEmployerInfo.Text(v.Local.sT)	
			'social	
			Gui.Form.txtEmpSoc.Text(v.DataTable.dtEmp(v.Local.sRet(0)).SSN!FieldValTrim)
			'Control Number
			Gui.Form.txtControlNumber.Text(v.DataTable.dtEmp(v.Local.sRet(0)).BOX_D!FIeldvaltrim)
			'first name 
			Gui.Form.txtEmpeeFirstName.Text(v.DataTable.dtEmp(v.Local.sRet(0)).First_name!FieldvalTrim)
			'Middle Initial
			Gui.Form.txtInitial.Text(v.DataTable.dtEmp(v.Local.sRet(0)).Middle_Init!FieldValTrim)
			'last name
			'last name be 20 characters
			F.Intrinsic.String.Left(v.DataTable.dtEmp(v.Local.sRet(0)).Last_Name!FieldVal,20,v.Local.sLastName)
			Gui.Form.txtEmpeeLastName.Text(v.Local.sLastName)		
			F.Intrinsic.String.Mid(v.DataTable.dtEmp(v.Local.sRet(0)).Last_Name!Fieldval,22,5,v.Local.sSuffix)
			Gui.Form.txtEmpeeSuff.Text(v.Local.sSuffix)		
			'emp addy, build object
			F.Intrinsic.String.Build("{1}{0}{2}, {3} {4}",v.Ambient.NewLine,v.DataTable.dtEmp(v.Local.sRet(0)).Street!FieldValTrim,v.DataTable.dtEmp(v.Local.sRet(0)).CIty!FieldValTrim,v.DataTable.dtEmp(v.Local.sRet(0)).State!FieldValTrim,v.DataTable.dtEmp(v.Local.sRet(0)).Zip!FieldValtrim,v.Local.sSel)
			gui.Form.txtEmpeeAddress.Text(v.Local.sSel)	
			'1 wages 
			Gui.Form.txtBox1.Text(v.DataTable.dtEmp(v.Local.sRet(0)).Fed_Wages!FieldVal) 
			'2 fed holding 
			Gui.Form.txtBox2.Text(v.DataTable.dtEmp(v.Local.sRet(0)).Fed_WithHolding!FieldVal)
			'3 social security tips 
			Gui.Form.txtBox3.Text(v.DataTable.dtEmp(v.Local.sRet(0)).Fica_wages!FieldVal)
			'box 4
			Gui.Form.txtBox4.Text(v.DataTable.dtEmp(v.Local.sRet(0)).Fica_WithHolding!FieldVal)
			'box 5
			Gui.Form.txtBox5.Text(v.DataTable.dtEmp(v.Local.sRet(0)).Medi_Wages!FieldVal)
			'box 6	
			Gui.Form.txtBox6.Text(v.DataTable.dtEmp(v.Local.sRet(0)).Medi_WithHolding!FieldVal)	
			'box 7 
			
		'	F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.sRet(0)).SS_TIPS!FieldValFloat,>,0)
		'		F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sRet(0)).SS_TIPS!FieldValFloat,"####.00",v.Local.st)
		'		Gui.Form.txtbox7.Text(v.local.sT)		
		'	F.Intrinsic.Control.EndIf
			Gui.Form.txtBox7.Text("") 
			
			'box 8 
			Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.sRet(0)).ALLO_TIPS!FIELDVALFLOAT,>,0)
				F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sRet(0)).Allo_Tips!FieldVal,"####.00",v.Local.st)
				Gui.Form.txtBox8.Text(v.Local.sT)
			Function.Intrinsic.Control.Else
				Gui.Form.txtBox8.Text("")
			Function.Intrinsic.Control.EndIf	
			'box 9 
			'verification code?
			'for 2019 and greater do not load Box 9
			F.Intrinsic.Control.If(v.Global.iYear, <, 2019)
				Gui.Form.txtBox9.Text(v.DataTable.dtEmp(v.Local.sRet(0)).Box_9!FieldVal)
			F.Intrinsic.Control.EndIf
			
			
			'Box 10 Dep car
			Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.sRet(0)).Dep_Care!FieldValFloat,>,0)
				F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sRet(0)).Dep_Care!FieldVal,"####.00",v.Local.st)
				Gui.Form.txtBox10.Text(v.local.sT) 
			Function.Intrinsic.Control.Else
				gui.Form.txtBox10.Text("")
			Function.Intrinsic.Control.EndIf
			
			'box 11 noq plan
			Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.sRet(0)).NQ_PLAN!FIELDVALFLOAT,>,0)
				F.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.sRet(0)).NQ_PLAN!FieldValFloat,"####.00",v.Local.st)
				Gui.Form.txtBox11.Text(v.Local.sT)		
			Function.Intrinsic.Control.Else
				gui.Form.txtBox11.Text("")
			Function.Intrinsic.Control.EndIf
			
			Gui.Form.chkStatEmpl.value(v.DataTable.dtEmp(v.Local.sRet(0)).bitStatuEmp!FieldVal)
			Gui.Form.chkRetPlan.Value(v.DataTable.dtEmp(v.Local.sRet(0)).bitRetirementPlan!FIeldVal) 
			Gui.Form.chkThirdParty.Value(v.DataTable.dtEmp(v.Local.sRet(0)).bit_ThirdPartySick!FieldVal)
			
		F.Intrinsic.Control.EndIf
		'box 12 a through d. 
		F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '12'",v.global.sEmpID,v.Local.sSel) 
		'this is for DtlAddl Box 12 a through d
		F.Data.DataTable.Select("dtAddl",v.Local.sSel,v.Local.sret)
		F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
			f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret) 
			F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
			  Function.Intrinsic.Control.SelectCase(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Seq!FieldVal)
			  Function.Intrinsic.Control.Case("1")
			  	Gui.Form.txtBox12ACode.Text(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).IRS_CODE!FieldvalTrim)	  	
			  	F.Intrinsic.Control.If(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Amount_12!FieldValFloat,>,0)
			  		F.Intrinsic.String.Format(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Amount_12!FieldValFloat,"####.00",v.Local.st)
			  		Gui.Form.txtBox12ADesc.Text(v.Local.sT)		  		
			  	F.Intrinsic.Control.EndIf	  		
			  Function.Intrinsic.Control.Case("2")
			  	Gui.Form.txt12BCode.Text(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).IRS_CODE!FieldvalTrim)
			  	F.Intrinsic.Control.If(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Amount_12!FieldValFloat,>,0)
			  		F.Intrinsic.String.Format(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Amount_12!FieldValFloat,"####.00",v.Local.st)
			  		Gui.Form.txt12BDesc.Text(v.Local.sT)	  	
			  	F.Intrinsic.Control.EndIf	  		
			  Function.Intrinsic.Control.Case("3")
			  	Gui.Form.txt12CCode.Text(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).IRS_CODE!FieldvalTrim)
			  	F.Intrinsic.Control.If(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Amount_12!FieldValFloat,>,0)
			  		F.Intrinsic.String.Format(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Amount_12!FieldValFloat,"####.00",v.Local.st)
			  		Gui.Form.txt12CDesc.Text(v.Local.sT)	  	
			  	F.Intrinsic.Control.EndIf	  		
			  		
			  Function.Intrinsic.Control.Case("4")
			  	Gui.Form.txt12DCode.Text(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).IRS_CODE!FieldvalTrim)
			  	F.Intrinsic.Control.If(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Amount_12!FieldValFloat,>,0)
			  		F.Intrinsic.String.Format(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Amount_12!FieldValFloat,"####.00",v.Local.st)
			  		Gui.Form.txt12DDesc.Text(v.Local.sT)	  	
			  	F.Intrinsic.Control.EndIf	  		
			  Function.Intrinsic.Control.CaseElse
			  	f.Intrinsic.Debug.SetLA(v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Seq!fIELDVAL, " Seq not found in case statement")
			  Function.Intrinsic.Control.EndSelect		  
			F.Intrinsic.Control.Next(v.Local.i)
		F.Intrinsic.Control.EndIf
		
		F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '14'",v.global.sEmpID,v.Local.sSel) 
		'this is for DtlAddl Box 14
		F.Data.DataTable.Select("dtAddl",v.Local.sSel,v.Local.sret)
		F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
			'create a new stringbuilder object. 
			F.Intrinsic.StringBuilder.Create("Box14")	
			f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret)	
			F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
				F.Intrinsic.String.Build("{0} {1}",v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).Box_Desc!FieldValTrim,v.DataTable.dtAddl(v.Local.sRet(v.Local.i)).AMOUNT_14!FieldVal,v.Local.sSel) 
				F.Intrinsic.Stringbuilder.Append("Box14",v.Local.sSel)
				F.Intrinsic.StringBuilder.AppendLine("Box14","")
			F.Intrinsic.Control.Next(v.Local.i)
			F.Intrinsic.Stringbuilder.ToString("Box14",v.Local.sRet) 
			GUi.Form.txtBox14.Text(v.Local.sRet.trim)
			F.Intrinsic.StringBuilder.Dispose("BOX14")
		Function.Intrinsic.Control.Else
			gui.Form.txtBox14.Text("")
		F.Intrinsic.Control.EndIf	
		
		F.Intrinsic.String.Build("[Employee] = '{0}'",v.global.sEmpID,v.Local.sSel)
		F.Data.DataView.SetFilter("dtStateLoc","dvStateLoc",v.Local.sSel)
		Function.Intrinsic.Control.UnBlockEvents
	
	F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.Label("LoadEmpScreen_Err")
	F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
		Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		Function.Intrinsic.Control.CallSub(form_unload)
	Function.Intrinsic.Control.EndIf
Program.Sub.LoadEmpScreen.End

Program.Sub.ClearEmpScreen.Start
F.Intrinsic.Control.SetErrorHandler("ClearEmpScreen_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
'no work.
'Gui.Form..ClearGroup(0)

Gui.Form.txtEmpSoc.Text("")
Gui.Form.txtEIN.Text("") 
gui.Form.txtEmployerInfo.Text("")
Gui.Form.txtControlNumber.Text("")
Gui.Form.txtEmpeeFirstName.Text("") 
Gui.Form.txtEmpeeLastName.Text("") 
GUi.Form.txtEmpeeSuff.Text("")
Gui.Form.txtEmpeeAddress.Text("") 
Gui.Form.txtBox1.Text("") 
Gui.Form.txtBox2.Text("") 
Gui.Form.txtBox3.Text("") 
gui.Form.txtBox4.Text("")
Gui.Form.txtBox5.Text("") 
Gui.Form.txtBox6.Text("") 
Gui.Form.txtBox7.Text("") 
Gui.Form.txtBox8.Text("")
GUi.Form.txtBox9.Text("") 
Gui.Form.txtBox10.Text("") 
gui.Form.txtBox11.Text("") 
gui.Form.txtBox12ACode.Text("") 
Gui.Form.txtBox12ADesc.Text("") 
Gui.Form.txt12BCode.Text("")
Gui.Form.txt12BDesc.Text("")
Gui.Form.txt12CCode.Text("") 
Gui.Form.txt12CDesc.Text("")
Gui.Form.txt12DCode.Text("") 
Gui.Form.txt12DDesc.Text("")
Gui.Form.chkRetPlan.Value(0)
gui.Form.chkStatEmpl.Value(0)
gui.Form.chkThirdParty.Value(0)
'box 14 not clearing out for a reason 
Gui.Form.txtBox14.Text("")
F.Data.DataView.SetFilter("dtStateLoc","dvStateLoc","[Employee] = '999999'")
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("ClearEmpScreen_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.ClearEmpScreen.End

Program.Sub.gcSubmitter_CellValueChanged.Start
F.Intrinsic.Control.SetErrorHandler("CellValueChanged_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
'submitter info changed.
v.global.bContactChange.Set(True)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("CellValueChanged_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.gcSubmitter_CellValueChanged.End

Program.Sub.gcContact_CellValueChanged.Start
F.Intrinsic.Control.SetErrorHandler("Contact_CellChanged_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.global.bContactChange.Set(True)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Contact_CellChanged_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.gcContact_CellValueChanged.End

Program.Sub.gcState_CellValueChanged.Start
v.Global.bStateChange.Set(True)
Program.Sub.gcState_CellValueChanged.End

Program.Sub.tab1_Click.Start
F.Intrinsic.Control.SetErrorHandler("tab_1Click_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
Function.Intrinsic.Control.BlockEvents
'here is where they clicked the tab. Check to see if any changes were made. Tell them changes must be saved first.
Function.Intrinsic.Control.CallSub(checkchange)
Function.Intrinsic.Control.UnBlockEvents
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("tab_1Click_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.tab1_Click.End

Program.Sub.SaveContact.Start
F.Intrinsic.Control.SetErrorHandler("SaveContact_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sSQl.Declare(String)
'save changes made to contact into the PY_w2_HeaderChanges
'first flag all records currently in that table with year as True, Deleted. 
F.Intrinsic.String.Build("Update PY_W2_Header_Changes Set Flag_Delete = '1' Where W2_Year = '{0}'",v.Global.iYear,v.Local.sSQl) 
F.ODBC.Connection!conX.Execute(v.Local.sSQL)
'save submitter and contact information.
F.ODBC.Connection!conX.OpenLocalRecordsetRW("rst","Select * From PY_W2_Header_Changes")
F.ODBC.conx!rst.AddNew
F.ODBC.conx!rst.Set!W2_Year(v.Global.iyear)
F.ODBC.conx!rst.Set!EIN(v.DataTable.dtSubmitterInfo(0).Value!FieldValTrim) 
F.ODBC.conx!rst.Set!Submit_Pin(v.DataTable.dtSubmitterInfo(1).Value!FieldvalTrim)
F.ODBC.conx!rst.Set!Submit_SFWR_VEN_CODE(v.DataTable.dtSubmitterInfo(2).Value!FieldValTrim)
F.ODBC.conx!rst.Set!Submit_SFWR_Code(v.DataTable.dtSubmitterInfo(3).Value!FieldValTrim)
F.ODBC.conX!rst.Set!Submit_Name(v.DataTable.dtSubmitterInfo(4).Value!FieldValTrim)
F.ODBC.conX!rst.Set!Submit_Location(v.DataTable.dtSubmitterInfo(5).Value!FieldValTrim)
F.ODBC.conX!rst.Set!Submit_Deliv_Address(v.DataTable.dtSubmitterInfo(6).Value!FieldValTrim)
F.ODBC.conX!rst.Set!Submit_City(v.DataTable.dtSubmitterInfo(7).Value!FieldValTrim)
F.ODBC.conX!rst.Set!Submit_State(v.DataTable.dtSubmitterInfo(8).Value!FieldValTrim)
F.ODBC.conX!rst.Set!Submit_Zip(v.DataTable.dtSubmitterInfo(9).Value!FieldValTrim)
F.ODBC.conx!rst.Set!Contact_Name(v.DataTable.dtContact(0).Value!FieldValTrim)
F.ODBC.conx!rst.Set!Contact_Email(v.DataTable.dtContact(3).Value!FieldValTrim)
F.ODBC.conx!rst.Set!Contact_Phone(v.DataTable.dtContact(1).Value!FieldValTrim)
F.ODBC.conx!rst.Set!Contact_Ext(v.DataTable.dtContact(2).Value!FieldValTrim)
F.ODBC.conx!rst.Set!Contact_FAX(v.DataTable.dtContact(4).Value!FieldValTrim)
F.ODBC.conx!rst.Set!Flag_Delete(0)
F.ODBC.conx!rst.Set!UserName(v.Caller.user)
F.ODBC.conx!rst.Set!Last_CHG_Date(v.Ambient.Now)
F.ODBC.conx!rst.Update
F.ODBC.conx!rst.Close
gui.Form.timerSave.Interval(1500)
Gui.Form.timerSave.Enabled(True)
Gui.Form.lblSave.Visible(True)	
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("SaveContact_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.SaveContact.End

Program.Sub.CheckChange.Start
F.Intrinsic.Control.SetErrorHandler("CheckChange_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sRet.Declare(String)
F.Intrinsic.Control.If(v.Global.bContactChange,=,True)
	 F.Intrinsic.UI.Msgbox("Submitter/Contact changes have been made. Save Changes?","Changes made...",4,v.Local.sRet)
	 Function.Intrinsic.Control.If(v.Local.sRet,=,6) 
	 	Function.Intrinsic.Control.CallSub(SaveContact)	
	 Function.Intrinsic.Control.Else
	 	'we have to refresh the Contact informaiton since it's a grid and updates regardless. 
	 	Function.Intrinsic.Control.CallSub(RefreshContact)	 	
	 Function.Intrinsic.Control.EndIf	
	 v.Global.bContactChange.Set(False)
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("[Employee] = '{0}'",v.Global.sEmpID,v.Local.sRet)
f.Data.DataTable.Select("dtEmp",v.Local.sRet,v.Local.sRET)
Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
	F.Intrinsic.Control.If(v.Global.bChange,=,True)
	 	F.Intrinsic.UI.Msgbox("Changes have been made to Employee's W2. Save Changes?","Changes made...",4,v.Local.sRet)
	 	Function.Intrinsic.Control.If(v.Local.sRet,=,6)	 
		 	Function.Intrinsic.Control.CallSub(SaveEmployee)
	 	Function.Intrinsic.Control.Else
	 		v.Global.bChange.Set(False)
		 Function.Intrinsic.Control.EndIf		 
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(v.Global.bStateChange,=,True)
		 F.Intrinsic.UI.Msgbox("Changes have been made to Employee's W2 State Information. Save Changes?","Changes made...",4,v.Local.sRet)
		 Function.Intrinsic.Control.If(v.Local.sRet,=,6) 
		 	Function.Intrinsic.Control.CallSub(SaveState)	 		 	
		 Function.Intrinsic.Control.Else
		 	F.Intrinsic.Control.CallSub(RefreshState)
		 Function.Intrinsic.Control.EndIf	 
		 v.Global.bStateChange.Set(False)
	F.Intrinsic.Control.EndIf
Function.Intrinsic.Control.Else	
	v.Global.bChange.Set(False)
	v.Global.bStateChange.Set(False)
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("CheckChange_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)	
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.CheckChange.End

Program.Sub.SaveEmployee.Start
	F.Intrinsic.Control.SetErrorHandler("SaveEmployee_Err")
	F.Intrinsic.Control.ClearErrors
	
		V.Local.sError.Declare(String)
		v.Local.sSQL.Declare(String)
		v.Local.sSel.Declare(String)
		v.Local.sRet.Declare(String)
		v.Local.sT.Declare(String)
		v.Local.i.Declare(long)
		v.Local.sVal.Declare(String)
		v.Local.bNum.Declare(Boolean)
		v.Local.sTemp.Declare(String)
		v.Local.sBox14.Declare(String)
		v.Local.iC.Declare(Long)
		v.Local.iT.Declare(Long)
		v.Local.fBox12Amt.Declare(Float)
		
		'check box 14 first.
		F.Intrinsic.String.Split(v.Screen.Form!txtBox14.text,v.Ambient.NewLine,v.Local.sT) 
		Function.Intrinsic.Control.For(v.Local.i,0,v.Local.sT.UBound,1) 
			f.Intrinsic.Control.If(v.Local.sT(v.Local.i).Trim,<>,"")
				F.Intrinsic.String.Split(v.Local.sT(v.Local.i)," ",v.Local.sRet)
				Function.Intrinsic.Control.If(v.Local.sRet.UBound,>,0)
					Function.Intrinsic.Control.If(v.Local.sRet(v.Local.sRet.UBound).Trim,<>,"")
						F.Intrinsic.Math.IsNumeric(v.Local.sRet(v.Local.sRet.UBound),v.Local.bNum)		
						F.Intrinsic.Control.If(v.Local.bNum,=,False) 
							f.Intrinsic.String.Build("Amount: {0} is not a valid numeric value for Box 14 Information.",v.Local.sRet(v.Local.sRet.UBound),v.Local.sError)
							F.Intrinsic.UI.Msgbox(v.Local.sError,"Invalid Amount in Box 14")		
							f.Intrinsic.Control.ExitSub
						Function.Intrinsic.Control.EndIf
					Function.Intrinsic.Control.EndIf
				F.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.EndIf
		Function.Intrinsic.Control.Next(v.Local.i)
		
		'update the prev records to have True in Flag_Delete 
		F.Intrinsic.String.Build("Update PY_W2_EMP_CHANGES Set Flag_Delete = '1' Where W2_Year = '{0}' And Employee_ID = '{1}'",v.Global.iYear,v.global.sEmpID,v.Local.sSQL)
		F.ODBC.Connection!conX.Execute(v.Local.sSQL)
		F.Intrinsic.String.Build("[Employee] = '{0}'",v.global.sEmpID,v.Local.sSel) 
		F.Data.DataTable.Select("dtEmp",v.Local.sSel,v.Local.sRet)
		Function.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***") 
			f.Intrinsic.UI.Msgbox("Employee ID cannot be found.") 
			Function.Intrinsic.Control.CallSub(ClearEmpScreen)
			Function.Intrinsic.Control.ExitSub
		Function.Intrinsic.Control.Else
		
			F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret)
			F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Box_D",v.Screen.Form!txtControlNumber.text)
			
			Function.Intrinsic.Control.If(v.Screen.Form!txtBox7.text.trim,=,"")
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"SS_Tips",v.Ambient.DBnull)
			Function.Intrinsic.Control.Else
			'F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"SS_Tips",v.Screen.Form!txtBox7.text)
			F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"SS_Tips","0")
			Function.Intrinsic.Control.EndIf
			
			Function.Intrinsic.Control.If(v.Screen.Form!txtBox8.text.trim,=,"")
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Allo_Tips",v.ambient.DBNull)
			Function.Intrinsic.Control.Else
			F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Allo_Tips",v.Screen.Form!txtBox8.Text)
			Function.Intrinsic.Control.EndIf
			
			Function.Intrinsic.Control.If(v.Screen.Form!txtbox9.text.trim,=,"")
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"BOX_9",v.ambient.DBNull)
			Function.Intrinsic.Control.Else
			F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"BOX_9",v.Screen.Form!txtBox9.text)
			Function.Intrinsic.Control.EndIf
			
			Function.Intrinsic.Control.If(v.Screen.Form!txtbox11.text.trim,=,"")
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"NQ_PLAN",v.ambient.DBNull)
			Function.Intrinsic.Control.Else
			F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"NQ_PLAN",v.Screen.Form!txtBox11.text)
			Function.Intrinsic.Control.EndIf	 
			
			'checkbox values
			Function.Intrinsic.Control.If(v.Screen.Form!chkStatEmpl.Value,=,0)
				f.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Statutory_Emp","N")		
			Function.Intrinsic.Control.Else
				f.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Statutory_Emp","Y")			
			Function.Intrinsic.Control.EndIf
			
			Function.Intrinsic.Control.If(v.Screen.Form!chkRetPlan.Value,=,0)
				f.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Retirement_Plan","N")		
			Function.Intrinsic.Control.Else
				f.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Retirement_Plan","Y")			
			Function.Intrinsic.Control.EndIf
			
			Function.Intrinsic.Control.If(v.Screen.Form!chkThirdParty.Value,=,0)
				f.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Third_Party_Sick","N")		
			Function.Intrinsic.Control.Else
				f.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Third_Party_Sick","Y")			
			Function.Intrinsic.Control.EndIf
			
		    'box 12 1 through 4 information
			F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '12' ANd [Seq] = '1'",v.global.sEmpID,v.Local.ssel)
			F.Data.DataTable.Select("dtAddl",v.Local.sSel,v.Local.sRet) 
			Function.Intrinsic.Control.If(v.Screen.Form!txtBox12ACode.Text.Trim,<>,"")	
				F.Intrinsic.Control.If(v.Screen.Form!txtBox12ADesc.text.Trim,=,"") 
					v.Local.fBox12Amt.Set(0) 
				Function.Intrinsic.Control.Else	
					v.Local.fBox12Amt.Set(v.Screen.form!txtBox12ADesc.text)
				F.Intrinsic.Control.EndIf
				
				F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
					F.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"IRS_CODE",v.Screen.Form!txtBox12ACode.text.Trim,"Amount_12",v.Local.fBox12Amt)
				Function.Intrinsic.Control.Else
					F.Data.DataTable.AddRow("dtAddl","Employee",v.global.sEmpID,"Box","12","Seq","1","IRS_CODE",v.Screen.Form!txtBox12ACode.text.Trim,"Amount_12",v.Local.fBox12Amt)
				F.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.Else
				Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn) 
					Function.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
					'should only be one.
					F.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(0))
					F.Data.DataTable.AcceptChanges("dtAddl")			
				Function.Intrinsic.Control.EndIf
				
			Function.Intrinsic.Control.EndIf
			
			F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '12' And [Seq] = '2'",v.global.sEmpID,v.Local.ssel)
				F.Data.DataTable.Select("dtAddl",v.Local.sSel,v.Local.sRet) 
			Function.Intrinsic.Control.If(v.Screen.Form!txt12BCode.Text.Trim,<>,"")			
				F.Intrinsic.Control.If(v.Screen.Form!txt12BDesc.text.Trim,=,"") 
					v.Local.fBox12Amt.Set(0) 
				Function.Intrinsic.Control.Else	
					v.Local.fBox12Amt.Set(v.Screen.Form!txt12BDesc.text)			
				F.Intrinsic.Control.EndIf
				F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
					F.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"IRS_CODE",v.Screen.Form!txt12BCode.text.Trim,"Amount_12",v.Local.fBox12Amt)
				Function.Intrinsic.Control.Else
					F.Data.DataTable.AddRow("dtAddl","Employee",v.global.sEmpID,"Box","12","Seq","2","IRS_CODE",v.Screen.Form!txt12BCode.text.Trim,"Amount_12",v.Local.fBox12Amt)
				F.Intrinsic.Control.EndIf	
			Function.Intrinsic.Control.Else	
				'means its blank and we just remove it all together
				Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn) 
					Function.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
						'should only be one.
						F.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(0))
						F.Data.DataTable.AcceptChanges("dtAddl")
					Function.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.EndIf
			
			F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '12' And [Seq] = '3'",v.global.sEmpID,v.Local.ssel)
			F.Data.DataTable.Select("dtAddl",v.Local.sSel,v.Local.sRet) 
			Function.Intrinsic.Control.If(v.Screen.Form!txt12CCode.Text.Trim,<>,"")		
				F.Intrinsic.Control.If(v.Screen.Form!txt12CDesc.text.Trim,=,"") 
					v.Local.fBox12Amt.Set(0) 
				Function.Intrinsic.Control.Else	
					v.Local.fBox12Amt.Set(v.Screen.form!txt12CDesc.text)
				F.Intrinsic.Control.EndIf
				F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
					F.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"IRS_CODE",v.Screen.Form!txt12CCode.text.trim,"Amount_12",v.Local.fBox12Amt)
				Function.Intrinsic.Control.Else
					F.Data.DataTable.AddRow("dtAddl","Employee",v.global.sEmpID,"Box","12","Seq","3","IRS_CODE",v.Screen.Form!txt12CCode.text.trim,"Amount_12",v.Local.fBox12Amt)
				F.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.Else
				'means its blank and we just remove it all together
				Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn) 
					Function.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
					'should only be one.
					F.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(0))
					F.Data.DataTable.AcceptChanges("dtAddl")
				Function.Intrinsic.Control.EndIf		
			Function.Intrinsic.Control.EndIf	
			
			F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '12' And [Seq] = '4'",v.global.sEmpID,v.Local.ssel)
			F.Data.DataTable.Select("dtAddl",v.Local.sSel,v.Local.sRet) 
			Function.Intrinsic.Control.If(v.Screen.Form!txt12DCode.Text.Trim,<>,"")		
				F.Intrinsic.Control.If(v.Screen.Form!txt12DDesc.text.Trim,=,"") 
					v.Local.fBox12Amt.Set(0) 
				Function.Intrinsic.Control.Else	
					v.Local.fBox12Amt.Set(v.Screen.form!txt12DDesc.text)
				F.Intrinsic.Control.EndIf
				F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
					F.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"IRS_CODE",v.Screen.Form!txt12DCode.text.trim,"Amount_12",v.Local.fBox12Amt)
				Function.Intrinsic.Control.Else
					F.Data.DataTable.AddRow("dtAddl","Employee",v.global.sEmpID,"Box","12","Seq","4","IRS_CODE",v.Screen.Form!txt12DCode.text.trim,"Amount_12",v.Local.fBox12Amt)
				F.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.Else
				'means its blank and we just remove it all together
				Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn) 
					Function.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
					'should only be one.
					F.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(0))
					F.Data.DataTable.AcceptChanges("dtAddl")
				Function.Intrinsic.Control.EndIf	
			Function.Intrinsic.Control.EndIf
		
			v.Local.sT.Set(v.Screen.Form!txtBox14.text) 
			'Function.Intrinsic.Control.If(v.Local.sT.Trim,<>,"") 
				f.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [BOX] = '14'",v.global.sEmpID,v.Local.sSQL) 	
				F.Data.DataTable.Select("dtAddl",v.Local.sSQL,v.Local.sRet) 
				F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
					f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret) 
					
					f.Intrinsic.Control.For(v.Local.i,v.Local.sRet.UBound,0,-1)
						f.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(v.Local.i))	
					f.Intrinsic.Control.Next(v.Local.i)
					F.Data.DataTable.AcceptChanges("dtAddl")
				F.Intrinsic.Control.EndIf
				
				f.Intrinsic.String.Split(v.Local.sT,v.Ambient.newline,v.Local.st) 
				F.Intrinsic.Control.For(v.Local.i,0,v.Local.sT.UBound,1) 
					f.Intrinsic.String.Split(v.Local.sT(v.Local.i).Trim," ",v.Local.sRet)
					F.Intrinsic.Control.If(v.Local.sRet.UBound,>,0)
						'have to combine the first elements and not the last one since the codes could have spaces.								
						f.Intrinsic.Math.Sub(v.Local.sRet.UBound,1,v.Local.iC)
						F.Intrinsic.String.Join(v.Local.sRet," ",v.Local.sTemp)
						F.Intrinsic.String.Split(v.Local.sTemp," ",v.Local.sTemp) 
						v.Local.sTemp.RedimPreserve(0,v.Local.ic)
						f.Intrinsic.String.Join(v.Local.sTemp," ",v.Local.sTemp)
						f.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [BOX] = '14' And Trim([BOX_DESC]) = '{1}'",v.global.sEmpID,v.Local.sTemp.Trim,v.Local.sSQL) 	
						F.Data.DataTable.Select("dtAddl",v.Local.sSQL,v.Local.sVal)
						
						F.Intrinsic.Control.If(v.Local.sVal.Trim,<>,"***NORETURN***")
							f.Intrinsic.String.Split(v.Local.sVal,"*!*",v.Local.sval)
							F.Data.DataTable.SetValue("dtAddl",v.Local.sVal(0).Trim,"Amount_14",v.Local.sRet(v.Local.sRet.UBound))
						Function.Intrinsic.Control.Else
							'means it doesn't exist				
							'add it
							F.Intrinsic.Math.IsNumeric(v.Local.sRet(v.Local.sRet.UBound),v.Local.bNum)
							Function.Intrinsic.Control.If(v.Local.bNum,=,False)
								'default to zero 
								v.Local.sRet(v.Local.sRet.UBound).Set("0")
							Function.Intrinsic.Control.EndIf
							
							f.Intrinsic.String.Format(V.Local.sRet(V.Local.sRet.UBOUND),"####0.00",V.Local.sRet(V.Local.sRet.UBound))			
												
							'check first character to make sure they didn't add a $ sign
							f.Intrinsic.String.Replace(V.LOCAL.SRET(V.Local.sRet.UBound),"$","",V.Local.sRet(V.Local.sRet.UBound))
							
					 		F.Data.DataTable.AddRow("dtAddl","Employee",v.global.sEmpID,"BOX","14","BOX_DESC",v.Local.sTemp.Trim,"Amount_14",v.Local.sRet(v.Local.sRet.UBound))				
						F.Intrinsic.Control.EndIf		
						
						Function.Intrinsic.Control.If(v.Local.sBox14.Trim,=,"")
							F.Intrinsic.String.Build("{0} {1}",v.Local.sTemp.Trim,v.Local.sRet(v.Local.sRet.UBound),v.Local.sBox14)				
						Function.Intrinsic.Control.Else					
							F.Intrinsic.String.Build("{1}{0}{2} {3}",v.Ambient.NewLine,v.Local.sBox14,v.Local.sTemp.Trim,v.Local.sRet(v.Local.sRet.UBound),v.Local.sBox14)
						Function.Intrinsic.Control.EndIf
					F.Intrinsic.Control.EndIf						
				F.Intrinsic.Control.Next(v.Local.i)		
				F.Data.DataTable.AcceptChanges("dtAddl")
			'Function.Intrinsic.Control.EndIf	
		Function.Intrinsic.Control.EndIf
		
		F.ODBC.Connection!conX.OpenLocalRecordsetRW("rst","Select * From PY_W2_EMP_CHANGES")
		F.ODBC.conx!rst.AddNew
		F.ODBC.conX!rst.Set!W2_Year(v.Global.iyear) 
		F.ODBC.conx!rst.Set!Employee_ID(v.global.sEmpID)
		F.ODBC.conx!rst.Set!BOX_D(v.Screen.Form!txtControlNumber.Text)
		
		Function.Intrinsic.Control.If(v.Screen.Form!txtBox7.text.trim,=,"")
			F.ODBC.conx!rst.Set!Box_7(v.Ambient.Null)
		Function.Intrinsic.Control.Else
			F.ODBC.conx!rst.Set!Box_7(v.Screen.Form!txtBox7.Text)
		Function.Intrinsic.Control.EndIf
			
		Function.Intrinsic.Control.If(v.Screen.Form!txtBox8.text.trim,=,"")
			F.ODBC.conx!rst.Set!Box_8(v.Ambient.Null)
		Function.Intrinsic.Control.Else
			F.ODBC.conx!rst.Set!Box_8(v.Screen.Form!txtBox8.Text)
		Function.Intrinsic.Control.EndIf
		
		F.Intrinsic.Control.If(v.Global.iYear, <, 2019)
			F.ODBC.conx!rst.Set!Box_9(v.Screen.Form!txtBox9.Text)
		F.Intrinsic.Control.EndIf
		
		
		Function.Intrinsic.Control.If(v.Screen.Form!txtBox11.text.trim,=,"")
			F.ODBC.conx!rst.Set!Box_11(v.Ambient.NULL)
		Function.Intrinsic.Control.Else
			F.ODBC.conx!rst.Set!Box_11(v.Screen.Form!txtBox11.Text)
		Function.Intrinsic.Control.EndIf
		
		
		F.ODBC.conx!rst.Set!Box_12A_Code(v.Screen.Form!txtBox12ACode.text)
		Function.Intrinsic.Control.If(v.Screen.Form!txtbox12ADesc.text.trim,=,"")
			F.ODBC.conx!rst.Set!Box_12A_Amount(v.Ambient.null)
		Function.Intrinsic.Control.Else
			F.ODBC.conx!rst.Set!Box_12A_Amount(v.Screen.Form!txtBox12ADesc.text)
		Function.Intrinsic.Control.EndIf
		
		F.ODBC.conx!rst.Set!Box_12B_Code(v.Screen.Form!txt12BCode.text)
		Function.Intrinsic.Control.If(v.Screen.Form!txt12BDesc.Text.Trim,=,"")
			F.ODBC.conx!rst.Set!Box_12B_Amount(v.Ambient.null)
		Function.Intrinsic.Control.Else
			F.ODBC.conx!rst.Set!Box_12B_Amount(v.Screen.Form!txt12BDesc.Text)
		Function.Intrinsic.Control.EndIf
		
		F.ODBC.conx!rst.Set!Box_12C_Code(v.Screen.Form!txt12CCode.text)
		Function.Intrinsic.Control.If(v.Screen.Form!txt12CDesc.Text.Trim,=,"")
			F.ODBC.conx!rst.Set!Box_12C_Amount(v.Ambient.NULL)
		Function.Intrinsic.Control.Else
			F.ODBC.conx!rst.Set!Box_12C_Amount(v.Screen.Form!txt12CDesc.Text)
		Function.Intrinsic.Control.EndIf
		
		F.ODBC.conx!rst.Set!Box_12D_Code(v.Screen.Form!txt12DCode.text)
		Function.Intrinsic.Control.If(v.Screen.Form!txt12DDesc.Text.Trim,=,"")
			F.ODBC.conx!rst.Set!Box_12D_Amount(v.Ambient.NULL)
		Function.Intrinsic.Control.Else
			F.ODBC.conx!rst.Set!Box_12D_Amount(v.Screen.Form!txt12DDesc.Text)
		Function.Intrinsic.Control.EndIf
		
		F.ODBC.conx!rst.Set!Box_13_StatEmp(v.Screen.Form!chkStatEmpl.value)
		F.ODBC.conx!rst.Set!Box_13_Retirement(v.Screen.Form!chkRetPlan.value) 
		F.ODBC.conx!rst.Set!Box_ThirdParty(v.Screen.Form!chkThirdParty.value)
		GUI.Form.txtBox14.Text(v.Local.sBox14.Trim)
		F.ODBC.conx!rst.Set!Box_14(v.local.sBox14.Trim)
		F.ODBC.conx!rst.Set!Flag_Delete(0) 
		f.ODBC.conx!rst.Set!userName(v.Caller.user) 
		F.ODBC.conx!rst.Set!Last_Chg_Date(v.Ambient.now)
		F.ODBC.conx!rst.Update
		F.ODBC.conx!rst.Close
		v.Global.bChange.Set(False)
		gui.Form.timerSave.Interval(1500)
		Gui.Form.timerSave.Enabled(True)
		Gui.Form.lblSave.Visible(True)	
		
	F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.Label("SaveEmployee_Err")
	F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
		Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		Function.Intrinsic.Control.CallSub(form_unload)
	Function.Intrinsic.Control.EndIf
Program.Sub.SaveEmployee.End

Program.Sub.SaveState.Start
F.Intrinsic.Control.SetErrorHandler("SaveState_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
V.Local.sSel.Declare(String)
v.Local.sSQL.Declare(String)
v.Local.sRet.Declare(String)
v.Local.i.Declare(Long)
v.Local.iC.Declare(Long)
'save state information
F.Intrinsic.String.Build("Update PY_W2_EMP_STATE_CHGS Set Flag_Delete = '1' Where W2_Year = '{0}' And Employee_ID = '{1}'",v.Global.iYear,v.global.sEmpID,v.Local.ssql) 
F.ODBC.Connection!conX.Execute(v.Local.ssql) 
'open recordset to write new records. 
F.ODBC.Connection!conX.OpenLocalRecordsetRW("rst","Select * From PY_W2_EMP_STATE_CHGS") 
'loop through
F.Intrinsic.Control.For(v.Local.i,0,v.DataView.dtStateLoc!dvStateLoc.RowCount--,1)
	F.ODBC.conX!rst.AddNew
	F.ODBC.conX!rst.Set!W2_Year(v.Global.iyear) 
	F.ODBC.conX!rst.Set!Employee_ID(v.global.sEmpID)
	F.ODBC.conX!rst.Set!State_Seq(v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State_Seq!FieldValTrim)
	F.ODBC.conX!rst.Set!Box_15(v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State!FieldValTrim)
	F.ODBC.conX!rst.Set!LOC_SEQ(v.DataView.dtStateLoc!dvStateLoc(v.Local.i).Local_Seq_S!FieldValString)
	F.ODBC.conX!rst.Set!Box_20(v.DataView.dtStateLoc!dvStateLoc(v.Local.i).Local_Code!FieldValTrim)
	F.ODBC.conX!rst.Set!Flag_Delete(0) 
	F.ODBC.conx!rst.Set!UserName(v.Caller.user)
	F.ODBC.conx!rst.Set!Last_Chg_Date(v.Ambient.Now)
F.Intrinsic.Control.Next(v.Local.i)
f.ODBC.conx!rst.Update
F.ODBC.conx!rst.Close

'loop through dataview and update our corresponding dtState based on Sequuence. We have to do this for Totalling when printing the pdf's. IF they change a state code and we don't update the dtState it's not going to total correctly for the state change they may have made. 
'F.Intrinsic.Control.For(v.Local.i,0,v.DataView.dtStateLoc!dvStateLoc.RowCount--,1) 
'	F.Intrinsic.String.Build("[Employee] = '{0}' And [State] = '{2}' And [Seq] = '{1}'",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).Employee!FieldvalTrim,v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State_Seq!FieldVal,v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State.FieldvalTrim,v.Local.sSel)
'	F.Data.DataTable.Select("dtState",v.Local.sSel,v.Local.sRet)
'	F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
'		f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
'		it should only be one but to verify.  
'		F.Intrinsic.Control.For(v.Local.iC,0,v.Local.sRet.UBound,1) 
'			F.Data.DataTable.SetValue("dtState",v.Local.sRet(v.Local.ic),"State",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State!FIeldValTrim)
'		F.Intrinsic.Control.Next(v.Local.iC)
'	Function.Intrinsic.Control.Else
'		means they changed the state to something different and we don't have a matching state within dtState, have to add it. 
'		F.Data.DataTable.AddRow("dtState","Employee",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).Employee!FieldValTrim,"State",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State!FieldValTrim,"Tax_ID",v.DataView.dtstateloc!dvStateLoc(v.Local.i).Tax_ID!FieldValTrim,"Wages",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).Wages!FieldValFloat,"WithHolding",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).WithHolding!FieldValFloat)
'	F.Intrinsic.Control.EndIf
'	
'	also have to update the dtLoc but we can link on locseq there.
'	F.Intrinsic.String.Build("[Employee] = '{0}' And [Seq] = '{1}'",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).Employee!FieldvalTrim,v.DataView.dtStateLoc!dvStateLoc(v.Local.i).Local_Seq_S!FieldValLong,v.Local.sSel) 
'	F.Data.DataTable.Select("dtLoc",v.Local.sSel,v.Local.sRet) 
'	should only be one. 
'	F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
'		f.Intrinsic.String.Split(v.Local.sSel,"*!*",v.Local.sSel) 
'		F.Data.DataTable.SetValue("dtLoc",v.Local.sRet(0),"State",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State!FieldValTrim)
'	F.Intrinsic.Control.EndIf
'F.Intrinsic.Control.Next(v.Local.i)

F.Intrinsic.Control.For(v.Local.i,0,v.DataView.dtStateLoc!dvStateLoc.RowCount--,1)
	F.Intrinsic.String.Build("[StateAbb] = '{0}'",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State!FieldValTrim,v.Local.sSel)	
	f.Data.DataTable.Select("dtStateList",v.Local.sSel,v.Local.sRet) 
	F.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***") 
		f.Data.DataTable.AddRow("dtStateList","StateABB",v.DataView.dtStateLoc!dvStateLoc(v.Local.i).State!FieldValTrim,"StateCode","")	
	F.Intrinsic.Control.EndIf	
Function.Intrinsic.Control.Next(v.Local.i)

gui.Form.timerSave.Interval(1100)
Gui.Form.timerSave.Enabled(True)
Gui.Form.lblSave.Visible(True)	
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("SaveState_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.SaveState.End

Program.Sub.LoadChanges.Start
F.Intrinsic.Control.SetErrorHandler("LoadChanges_ERR")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sSQL.Declare(String)
v.Local.sRet.Declare(String)
v.Local.i.Declare(Long)
v.Local.sVal.Declare(String)
v.Local.sTemp.Declare(String)
v.Local.sSel.Declare(String)
V.Local.iC.Declare(Long)
v.Local.iT.Declare(Long)
v.Local.sBox14.Declare(String)
'load header changes.
F.Intrinsic.String.Build("Select * From PY_W2_HEADER_CHANGES Where W2_Year = '{0}' And Flag_Delete = '0'",v.Global.iYear,v.Local.sSQL)
F.ODBC.Connection!conX.OpenLocalRecordsetRO("rst",v.Local.sSQL) 
Function.Intrinsic.Control.If(v.ODBC.conx!rst.EOF,<>,True) 
	F.Intrinsic.Control.If(v.DataTable.dtSubmitterInfo.Exists,=,True) 
		F.Data.DataTable.SetValue("dtSubmitterInfo",0,"Value",v.ODBC.conx!rst.FieldValTrim!EIN)
		F.Data.DataTable.SetValue("dtSubmitterInfo",1,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_Pin)
		F.Data.DataTable.SetValue("dtSubmitterInfo",2,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_SFWR_VEN_Code)
		F.Data.DataTable.SetValue("dtSubmitterInfo",3,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_SFWR_Code)
		F.Data.DataTable.SetValue("dtSubmitterInfo",4,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_name)
		F.Data.DataTable.SetValue("dtSubmitterInfo",5,"Value",v.ODBC.conx!rst.FieldValTrim!submit_Location)
		F.Data.DataTable.SetValue("dtSubmitterInfo",6,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_Deliv_Address)
		F.Data.DataTable.SetValue("dtSubmitterInfo",7,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_City)
		F.Data.DataTable.SetValue("dtSubmitterInfo",8,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_State)
		F.Data.DataTable.SetValue("dtSubmitterInfo",9,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_Zip)		
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(v.DataTable.dtContact.Exists,=,True)
	 	F.Data.DataTable.SetValue("dtContact",0,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Name)
	 	F.Data.DataTable.SetValue("dtContact",1,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Phone)
	 	F.Data.DataTable.SetValue("dtContact",2,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Ext)
	 	F.Data.DataTable.SetValue("dtContact",3,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Email)
	 	F.Data.DataTable.SetValue("dtContact",4,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Fax)
	F.Intrinsic.Control.EndIf
Function.Intrinsic.Control.EndIf
F.ODBC.conx!rst.close 

F.Intrinsic.String.Build("Select * From PY_W2_EMP_CHANGES Where W2_Year = '{0}' And Flag_Delete = '0'",v.Global.iYear,v.Local.sSQL)
F.ODBC.Connection!conX.OpenLocalRecordsetRO("rst",v.Local.sSQL)
F.Intrinsic.Control.DoUntil(v.ODBC.conx!rst.EOF,=,True) 
	Function.Intrinsic.Control.If(v.DataTable.dtEmp.Exists,=,True)
		'have to select from dt, then update values accordingly. 
		F.Intrinsic.String.Build("[Employee] = '{0}'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.Local.sSQL)
		F.Data.DataTable.Select("dtEmp",v.Local.sSQL,v.Local.sRet)
		F.Intrinsic.Control.If(v.Local.sRet.trim,<>,"***NORETURN***") 
			F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret) 
			'should be only one in this dt.			
			Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValTrim!BOX_D,<>,"")
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"BOX_D",v.ODBC.conx!rst.FieldValTrim!BOX_D)
			Function.Intrinsic.Control.EndIf			
			
			'comment out becuase we don't support this pre 2019.1 anymore. It's always going to be blank.
'			Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValFloat!Box_7,>,0)
'				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"SS_Tips",v.ODBC.conx!rst.FieldValFloat!Box_7)
'				'F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"SS_Tips","")
'			Function.Intrinsic.Control.EndIf			
			
			'Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValFloat!Box_8,>,0)
			F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Allo_Tips",v.ODBC.conx!rst.FieldValFloat!Box_8)
			'Function.Intrinsic.Control.EndIf
			
			F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"BOX_9",v.ODBC.conx!rst.FieldValTrim!Box_9)
			
			'Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValFloat!Box_11,>,0)
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"NQ_PLAN",v.ODBC.conx!rst.FieldValFloat!BOX_11)
			'Function.Intrinsic.Control.EndIf	
			
			'box 13 checkboxes.						
			Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValTrim!Box_13_StatEmp,=,"True") 
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Statutory_EMP","Y")	
			Function.Intrinsic.Control.Else
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"Statutory_EMP","N")	
			Function.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValTrim!Box_13_Retirement,=,"True") 
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"RETIREMENT_PLAN","Y")
			Function.Intrinsic.Control.Else
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"RETIREMENT_PLAN","N")
			Function.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValTrim!Box_ThirdParty,=,"True") 
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"THIRD_PARTY_SICK","Y")			
			Function.Intrinsic.Control.Else
				F.Data.DataTable.SetValue("dtEmp",v.Local.sRet(0),"THIRD_PARTY_SICK","N")
			Function.Intrinsic.Control.EndIf				
			
			'Box 12's.
			 'check addl and then figure out based on seq, does it exist, add it,  else update it.			  
			 Function.Intrinsic.Control.If(v.DataTable.dtAddl.Exists,=,True)			 
			 	F.Intrinsic.String.Build("[Employee] = '{0}' And Box = '12' And Seq = '1'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.Local.sSQL)
				F.Data.DataTable.Select("dtAddl",v.Local.sSQL,v.Local.sRET)				
			 	Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValTrim!Box_12A_Code,<>,"","AND",v.ODBC.conx!rst.FieldValFloat!Box_12A_Amount,>,0)			 	
				 	Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
				 		F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
				 		f.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"IRS_CODE",v.ODBC.conx!rst.FieldValTrim!Box_12A_Code,"Amount_12",v.ODBC.conx!rst.FieldVal!BOX_12A_Amount)
				 	  Function.Intrinsic.Control.Else
				 	  	f.Data.DataTable.AddRow("dtAddl","Employee",v.ODBC.conx!rst.FieldValTrim!Employee_ID,"BOX","12","Seq","1","IRS_CODE",v.ODBC.conx!rst.FieldValTrim!Box_12A_Code,"Amount_12",v.ODBC.conx!rst.FieldVal!BOX_12A_Amount)
				 	Function.Intrinsic.Control.EndIf
				Function.Intrinsic.Control.Else
					Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn)
				 		F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
				 		F.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(0))
				 		F.Data.DataTable.AcceptChanges("dtAddl")
				 	Function.Intrinsic.Control.EndIf
				Function.Intrinsic.Control.EndIf
			 	
			 	'12 B
			 	F.Intrinsic.String.Build("[Employee] = '{0}' And Box = '12' And Seq = '2'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.Local.sSQL)
				 F.Data.DataTable.Select("dtAddl",v.Local.sSQL,v.Local.sRET)
			 	Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValTrim!BOX_12B_Code,<>,"","AND",v.ODBC.conx!rst.FieldValFloat!Box_12B_Amount,>,0)			 					 	
				 	Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
				 		F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
				 		f.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"IRS_CODE",v.ODBC.conx!rst.FieldValTrim!Box_12B_Code,"Amount_12",v.ODBC.conx!rst.FieldVal!BOX_12B_Amount)
				 	Function.Intrinsic.Control.Else
				 		f.Data.DataTable.AddRow("dtAddl","Employee",v.ODBC.conx!rst.FieldValTrim!Employee_ID,"BOX","12","Seq","2","IRS_CODE",v.ODBC.conx!rst.FieldValTrim!Box_12B_Code,"Amount_12",v.ODBC.conx!rst.FieldVal!BOX_12B_Amount)
				 	Function.Intrinsic.Control.EndIf
				 Function.Intrinsic.Control.Else
					Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn)
				 		F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
				 		F.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(0))
				 		F.Data.DataTable.AcceptChanges("dtAddl")
				 	Function.Intrinsic.Control.EndIf
				Function.Intrinsic.Control.EndIf
				 	
			 	'12 C			 	
			 	F.Intrinsic.String.Build("[Employee] = '{0}' And Box = '12' And Seq = '3'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.Local.sSQL)
				F.Data.DataTable.Select("dtAddl",v.Local.sSQL,v.Local.sRET)
			 	Function.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValTrim!BOX_12C_Code,<>,"","AND",v.ODBC.conx!rst.FieldValFloat!Box_12C_Amount,>,0)				 	
				 	Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
				 		F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
				 		f.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"IRS_CODE",v.ODBC.conx!rst.FieldValTrim!Box_12C_Code,"Amount_12",v.ODBC.conx!rst.FieldVal!BOX_12C_Amount)			 		
				 	Function.Intrinsic.Control.Else
				 		f.Data.DataTable.AddRow("dtAddl","Employee",v.ODBC.conx!rst.FieldValTrim!Employee_ID,"BOX","12","Seq","3","IRS_CODE",v.ODBC.conx!rst.FieldValTrim!Box_12C_Code,"Amount_12",v.ODBC.conx!rst.FieldVal!BOX_12C_Amount)
				 	Function.Intrinsic.Control.EndIf
				 Function.Intrinsic.Control.Else
					Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn)
				 		F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
				 		F.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(0))
				 		F.Data.DataTable.AcceptChanges("dtAddl")
				 	Function.Intrinsic.Control.EndIf
				 Function.Intrinsic.Control.EndIf
			 	'12 D
			 	F.Intrinsic.String.Build("[Employee] = '{0}' And Box = '12' And Seq = '4'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.Local.sSQL)
				F.Data.DataTable.Select("dtAddl",v.Local.sSQL,v.Local.sRET)
			 	F.Intrinsic.Control.If(v.ODBC.conx!rst.FieldValTrim!Box_12D_Code,<>,"","AND",v.ODBC.conx!rst.FieldValFloat!Box_12D_Amount,>,0)				 	
				 	Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
				 		F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
				 		f.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"IRS_CODE",v.ODBC.conx!rst.FieldValTrim!Box_12D_Code,"Amount_12",v.ODBC.conx!rst.FieldVal!BOX_12D_Amount)	
				 	Function.Intrinsic.Control.Else
				 		f.Data.DataTable.AddRow("dtAddl","Employee",v.ODBC.conx!rst.FieldValTrim!Employee_ID,"BOX","12","Seq","4","IRS_CODE",v.ODBC.conx!rst.FieldValTrim!Box_12D_Code,"Amount_12",v.ODBC.conx!rst.FieldVal!BOX_12D_Amount)			 		
				 	Function.Intrinsic.Control.EndIf			 	
				Function.Intrinsic.Control.Else
					Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn)
				 		F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
				 		F.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(0))
				 		F.Data.DataTable.AcceptChanges("dtAddl")
				 	Function.Intrinsic.Control.EndIf 	
				Function.Intrinsic.Control.EndIf			 		
			
			 	'box 14.
			 	'long var char, split on new line and hope for the best.
			 	v.Local.sTemp.Set(v.ODBC.conx!rst.FieldValTrim!Box_14)
			 	'Function.Intrinsic.Control.If(v.Local.sTemp.Trim,<>,"")			 	
			 		f.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [BOX] = '14'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.Local.sSQL) 	
					F.Data.DataTable.Select("dtAddl",v.Local.sSQL,v.Local.sRet)					
					F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
						f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret) 
						f.Intrinsic.Control.For(v.Local.i,v.Local.sRet.UBound,0,-1)
							f.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(v.Local.i))	
						f.Intrinsic.Control.Next(v.Local.i)
						F.Data.DataTable.AcceptChanges("dtAddl")
					F.Intrinsic.Control.EndIf
															
			 		F.Intrinsic.String.Split(v.Local.sTemp,v.Ambient.NewLine,v.Local.sTemp)
			 		F.Intrinsic.Control.For(v.Local.i,0,v.Local.sTemp.UBound,1)
			 			F.Intrinsic.String.Split(v.Local.sTemp(v.Local.i).Trim," ",v.Local.sVal) 
			 			Function.Intrinsic.Control.If(v.Local.sVal.UBound,>,0) 
			 				f.Intrinsic.Math.Sub(v.Local.sVal.UBound,1,v.Local.iC)
			 				F.Intrinsic.String.Join(v.Local.sVal," ",v.Local.sBox14)
			 				F.Intrinsic.String.Split(v.Local.sBox14," ",v.Local.sBox14) 
			 				v.Local.sBox14.RedimPreserve(0,v.Local.iC)
			 				F.Intrinsic.String.Join(v.Local.sBox14," ",v.Local.sBox14)
			 				'check the val in the first element, going to be code, 
			 				F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '14' And Trim([Box_DESC]) = '{1}'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.Local.sBox14,v.Local.ssql)
			 				F.Data.DataTable.Select("dtAddl",v.Local.sSQL,v.Local.sRet)
			 				Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
			 					F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
			 					F.Data.DataTable.SetValue("dtAddl",v.Local.sRet(0),"AMOUNT_14",v.Local.sVal(v.Local.sVal.UBound))
			 				Function.Intrinsic.Control.Else
			 					'add it 
			 					F.Data.DataTable.AddRow("dtAddl","Employee",v.ODBC.conx!rst.FieldValTrim!EMPLOYEE_ID,"BOX","14","BOX_DESC",v.Local.sBox14,"Amount_14",v.Local.sVal(v.Local.sVal.UBound))	
			 				Function.Intrinsic.Control.EndIf
			 			Function.Intrinsic.Control.EndIf			 			
			 		F.Intrinsic.Control.Next(v.Local.i) 	
			 		
			 	'Function.Intrinsic.Control.EndIf
			 	
			 Function.Intrinsic.Control.EndIf			 
		F.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.EndIf
	f.ODBC.conx!rst.MoveNext
F.Intrinsic.Control.Loop
f.ODBC.conx!rst.Close
'State Information
F.Intrinsic.String.Build("Select * From PY_W2_EMP_STATE_CHGS WHERE W2_YEAR = '{0}' And Flag_Delete = '0'",v.Global.iYear,v.Local.ssql) 
F.ODBC.Connection!conX.OpenLocalRecordsetRO("rst",v.Local.ssql) 
F.Intrinsic.Control.DoUntil(v.ODBC.conx!rst.EOF,=,True) 
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [State_Seq] = '{1}' And [Local_Seq_S] = '{2}'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.ODBC.conx!rst.FieldValTrim!State_Seq,v.ODBC.conx!rst.FieldValTrim!LOC_SEQ,v.Local.sSEL) 
	f.Data.DataTable.Select("dtStateLoc",v.Local.sSel,v.Local.sRet)
	f.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
		f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.local.sRET)
		F.Data.DataTable.SetValue("dtStateLoc",v.Local.sRet(0),"STATE",v.ODBC.conx!rst.FieldValTrim!Box_15,"LOCAL_CODE",v.ODBC.conx!rst.FieldValTrim!Box_20)	
	f.Intrinsic.Control.EndIf	
'	'update dtState which corresponds.
'	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [SEQ] = '{1}'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.ODBC.conx!rst.FieldValTrim!State_Seq,v.Local.sSel)
'	f.Data.DataTable.Select("dtState",v.Local.sSel,v.Local.sRet)
'	f.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
'		f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.local.sRET)
'		F.Data.DataTable.SetValue("dtState",v.Local.sRet(0),"STATE",v.ODBC.conx!rst.FieldValTrim!Box_15)	
'	Function.Intrinsic.Control.EndIf

	F.Intrinsic.String.Build("[StateAbb] = '{0}'",v.ODBC.conx!rst.FieldValTrim!Box_15,v.Local.sSel)	
	f.Data.DataTable.Select("dtStateList",v.Local.sSel,v.Local.sRet) 
	F.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***") 
		f.Data.DataTable.AddRow("dtStateList","StateABB",v.ODBC.conx!rst.FieldValTrim!Box_15,"StateCode","")		
	F.Intrinsic.Control.EndIf	


	f.ODBC.conx!rst.MoveNext	
F.Intrinsic.Control.Loop
F.ODBC.conx!rst.Close

F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("LoadChanges_ERR")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.LoadChanges.End

Program.Sub.ClearChanges.Start
F.Intrinsic.Control.SetErrorHandler("ClearChanges_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.local.sSQL.Declare(String)
'Set All Flag Deletes to True, since they wanted to clear changes.
F.Intrinsic.String.Build("Update PY_W2_EMP_CHANGES Set Flag_Delete = '1' Where W2_Year = '{0}'",v.Global.iYear,v.Local.ssql) 
F.ODBC.Connection!conX.Execute(v.Local.sSQL)
F.Intrinsic.String.Build("Update PY_W2_EMP_STATE_CHGS Set Flag_Delete = '1' Where W2_Year = '{0}'",v.Global.iYear,v.Local.ssql)
F.ODBC.Connection!conX.Execute(v.Local.sSQL)
F.Intrinsic.String.Build("Update PY_W2_Header_Changes Set Flag_Delete = '1' Where W2_Year = '{0}'",v.Global.iYear,v.Local.sSQL) 
F.ODBC.Connection!conX.Execute(v.Local.sSQL)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("ClearChanges_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.ClearChanges.End

Program.Sub.cmdSave_Click.Start
F.Intrinsic.Control.SetErrorHandler("SaveCLick_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
'Header Changes
F.Intrinsic.Control.If(v.Global.bContactChange,=,True)
	Function.Intrinsic.Control.CallSub(SaveContact)	 		 		 
	 v.Global.bContactChange.Set(False)
F.Intrinsic.Control.EndIf

'Employee Changes
F.Intrinsic.Control.If(v.Global.bChange,=,True)
 	Function.Intrinsic.Control.CallSub(SaveEmployee)	 	 	
F.Intrinsic.Control.EndIf
'State Grid Changes
F.Intrinsic.Control.If(v.Global.bStateChange,=,True)
	 Function.Intrinsic.Control.CallSub(SaveState)	 	 
	 v.Global.bStateChange.Set(False)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("SaveCLick_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdSave_Click.End

Program.Sub.chkStatEmpl_Click.Start
v.Global.bChange.Set(True) 
Program.Sub.chkStatEmpl_Click.End

Program.Sub.chkRetPlan_Click.Start
v.Global.bChange.Set(True) 
Program.Sub.chkRetPlan_Click.End

Program.Sub.chkThirdParty_Click.Start
v.Global.bChange.Set(True) 
Program.Sub.chkThirdParty_Click.End

Program.Sub.txtEmpID_GotFocus.Start
Gui.Form.txtEmpID.SelectAll
Program.Sub.txtEmpID_GotFocus.End

Program.Sub.timerSave_Timer.Start
Gui.Form.lblSave.Visible(False)
GUi.Form.timerSave.Enabled(False)
Program.Sub.timerSave_Timer.End

Program.Sub.cmdPrintPDF_Click.Start
F.Intrinsic.Control.SetErrorHandler("PrintPDF_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.iRet.Declare(Long)
v.Local.bEx.Declare(Boolean)
v.Local.sFullPDFSavePath.Declare(String)
Gui.FormSelect..Visible(False)
F.Intrinsic.Math.Add(V.Screen.FormSelect!chk1AllCopies.Value,V.Screen.FormSelect!chk1State1.Value,V.Screen.FormSelect!chk1State2.Value,V.Screen.FormSelect!chk1Federal.Value,V.Screen.FormSelect!chk1Filing.Value,V.Screen.FormSelect!chk1Employee.Value,V.Screen.FormSelect!chk1Employer.Value,V.Screen.FormSelect!chkFedEmp.Value,V.Screen.FormSelect!chkStates1and2.Value,V.Local.iRet)
Function.Intrinsic.Control.If(v.Local.iRet,=,0)
	f.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.CallSub(pdf_employeeheader)
 Function.Intrinsic.Control.CallSub(CreatePDF)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("PrintPDF_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.cmdPrintPDF_Click.End

Program.Sub.chk1AllCopies_Click.Start
F.Intrinsic.Control.SetErrorHandler("chk1allcopies_click_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)

'If all copies checked, go ahead and disable all the other check boxes, otherwise enable them.
F.Intrinsic.Control.If(V.Screen.FormSelect!chk1AllCopies.Value,=,1)
	'checking controls
	Gui.FormSelect.chk1State1.Value(1)
	Gui.FormSelect.chk1State2.Value(1)
	Gui.FormSelect.chk1Federal.Value(1)
	Gui.FormSelect.chk1Employee.Value(1)
	Gui.FormSelect.chk1Employer.Value(1)
	Gui.FormSelect.chk1Filing.Value(1)
	'disabling controls
	Gui.FormSelect.chk1State1.Enabled(False)
	Gui.FormSelect.chk1State2.Enabled(False)
	Gui.FormSelect.chk1Federal.Enabled(False)
	Gui.FormSelect.chk1Employee.Enabled(False)
	Gui.FormSelect.chk1Employer.Enabled(False)
	Gui.FormSelect.chk1Filing.Enabled(False)

	'uncheck perforated FormSelects controls.
	Gui.FormSelect.chkStates1and2.Value(0)
	Gui.FormSelect.chkFedEmp.Value(0)

	'disabled perforated FormSelects controls.
	Gui.FormSelect.chkStates1and2.Enabled(False)
	Gui.FormSelect.chkFedEmp.Enabled(False)

F.Intrinsic.Control.Else
	Gui.FormSelect.chk1State1.Value(0)
	Gui.FormSelect.chk1State2.Value(0)
	Gui.FormSelect.chk1Federal.Value(0)
	Gui.FormSelect.chk1Employee.Value(0)
	Gui.FormSelect.chk1Employer.Value(0)
	Gui.FormSelect.chk1Filing.Value(0)
	'disabling controls
	Gui.FormSelect.chk1State1.Enabled(True)
	Gui.FormSelect.chk1State2.Enabled(True)
	Gui.FormSelect.chk1Federal.Enabled(True)
	Gui.FormSelect.chk1Employee.Enabled(True)
	Gui.FormSelect.chk1Employer.Enabled(True)
	Gui.FormSelect.chk1Filing.Enabled(True)

	'uncheck perforated FormSelects.
	Gui.FormSelect.chkStates1and2.Enabled(True)
	Gui.FormSelect.chkFedEmp.Enabled(True)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("chk1allcopies_click_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	F.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf

Program.Sub.chk1AllCopies_Click.End

Program.Sub.chk1State1_Click.Start
Program.Sub.chk1State1_Click.End

Program.Sub.Disable_Perf_Controls.Start
V.Local.i.Declare(Long)
'If any of the top printing options are selected, then disable perforated FormSelect chceckboxes.
F.Intrinsic.Math.Add(V.Screen.FormSelect!chk1AllCopies.Value,V.Screen.FormSelect!chk1State1.Value,V.Screen.FormSelect!chk1State2.Value,V.Screen.FormSelect!chk1Federal.Value,V.Screen.FormSelect!chk1Employee.Value,V.Screen.FormSelect!chk1Employer.Value,V.Screen.FormSelect!chk1Filing.Value,V.Local.i)
F.Intrinsic.Control.If(V.Local.i,>,0)
	Gui.FormSelect.chkFedEmp.Value(0)
	Gui.FormSelect.chkStates1and2.Value(0)
	Gui.FormSelect.chkFedEmp.Enabled(False)
	Gui.FormSelect.chkStates1and2.Enabled(False)	
F.Intrinsic.Control.Else
	Gui.FormSelect.chkFedEmp.Enabled(True)
	Gui.FormSelect.chkStates1and2.Enabled(True)
F.Intrinsic.Control.EndIf
Program.Sub.Disable_Perf_Controls.End

Program.Sub.FormSelect_UnLoad.Start
Function.Intrinsic.Control.CallSub(form_unload)
Program.Sub.FormSelect_UnLoad.End

Program.Sub.CHKFEDEMP_CLICK.Start
F.Intrinsic.Control.CallSub(Disable_PrintOpt1_Controls)
Program.Sub.CHKFEDEMP_CLICK.End

Program.Sub.chkStates1And2_Click.Start
F.Intrinsic.Control.CallSub(Disable_PrintOpt1_Controls)
Program.Sub.chkStates1And2_Click.End

Program.Sub.Disable_PrintOpt1_Controls.Start
F.Intrinsic.Control.If(V.Screen.FormSelect!chkFedEmp.Value,=,1,"OR",V.Screen.FormSelect!chkStates1and2.Value,=,1)
	Gui.FormSelect.chk1State1.Value(0)
	Gui.FormSelect.chk1State2.Value(0)
	Gui.FormSelect.chk1Federal.Value(0)
	Gui.FormSelect.chk1Employee.Value(0)
	Gui.FormSelect.chk1Employer.Value(0)
	Gui.FormSelect.chk1Filing.Value(0)
	Gui.FormSelect.chk1AllCopies.Value(0)
	'disabling controls
	Gui.FormSelect.chk1AllCopies.Enabled(False)
	Gui.FormSelect.chk1State1.Enabled(False)
	Gui.FormSelect.chk1State2.Enabled(False)
	Gui.FormSelect.chk1Federal.Enabled(False)
	Gui.FormSelect.chk1Employee.Enabled(False)
	Gui.FormSelect.chk1Employer.Enabled(False)
	Gui.FormSelect.chk1Filing.Enabled(False)
F.Intrinsic.Control.Else
	Gui.FormSelect.chk1AllCopies.Enabled(True)
	Gui.FormSelect.chk1State1.Enabled(True)
	Gui.FormSelect.chk1State2.Enabled(True)
	Gui.FormSelect.chk1Federal.Enabled(True)
	Gui.FormSelect.chk1Employee.Enabled(True)
	Gui.FormSelect.chk1Employer.Enabled(True)
	Gui.FormSelect.chk1Filing.Enabled(True)
F.Intrinsic.Control.EndIf
Program.Sub.Disable_PrintOpt1_Controls.End

Program.Sub.PDF_EmployeeHeader.Start
F.Intrinsic.Control.SetErrorHandler("PDFEMPLOYEEHEADER_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.i.Declare(Long)
v.Local.sCompanyInfo.Declare(String)
v.Local.sT.Declare(String)
v.Local.sFieldVals.Declare(String)
v.Local.iC.Declare(Long)
v.Local.sBoxAF.Declare
v.Local.sBox1_13.Declare
v.local.sBoxState.Declare
v.Local.sBox12.Declare
v.Local.sBox14.Declare
v.Local.iF.Declare
v.Local.iMax.Declare
'company info includes the EIN,EmployersNameAddressandZIp,ControlNumber
'EIN
v.Local.sCompanyInfo.Set(v.DataTable.dtHeader(0).Federal_ID!FieldVal)
v.Local.sCompanyInfo.Append("*!*")
'Company Name
v.Local.sCompanyInfo.Append(v.DataTable.dtHeaderInfo(0).VALUE!FIeldValTrim)
'Location

Function.Intrinsic.Control.If(v.DataTable.dtHeaderInfo(1).Value!FieldvalTrim,<>,"") 
	v.Local.sCompanyInfo.Append(v.Ambient.NewLine) 
	v.Local.sCompanyInfo.Append(v.DataTable.dtHeaderInfo(1).value!FieldvalTrim)	
Function.Intrinsic.Control.EndIf
'Address 
'City, State Zip
F.Intrinsic.String.Build("{1}{0}{2}{0}{3}, {4} {5}",v.Ambient.NewLine,v.Local.sCompanyInfo,v.DataTable.dtHeaderInfo(2).Value!FieldValTrim,v.DataTable.dtHeaderInfo(3).Value!FieldvalTrim,v.DataTable.dtHeaderInfo(4).Value!FieldValTrim,v.DataTable.dtHeaderInfo(5).Value!FieldValTrim,v.Local.sCompanyInfo)
F.Intrinsic.StringBuilder.Create("CompanyInfo")
F.Intrinsic.StringBuilder.Append("CompanyInfo",v.Local.sCompanyInfo)
F.Intrinsic.StringBuilder.Create("Fed1-13")
Function.Intrinsic.StringBuilder.Create("Box12")
Function.Intrinsic.StringBuilder.Create("Box14")
F.Intrinsic.StringBuilder.Create("BoxAF")
F.Intrinsic.StringBuilder.Create("State1520")
F.Data.DataTable.Create("dtFormFields",True)
F.Data.DataTable.AddColumn("dtFormFields","Employee","String")
F.Data.DataTable.AddColumn("dtFormFields","FieldVals","String")
'tobeused later.
F.Data.DataTable.AddColumn("dtFormFields","FQN","String")
'start our with Employees. 
F.Intrinsic.Control.For(v.Local.i,0,v.DataTable.dtEmp.RowCount--,1)	
	'Header information passes ordinal and company info from above	
	Function.Intrinsic.Control.CallSub(BuildHeaderInfo,"Ord",v.Local.i,"sCompanyinfo",v.Local.sCompanyInfo)
	Function.Intrinsic.Control.CallSub(Box113_Info,"Ord",v.Local.i) 
	Function.Intrinsic.Control.CallSub(Box12InfoBuild,"Ord",v.Local.i)
	Function.Intrinsic.Control.CallSub(Box14InfoBuild,"Ord",v.Local.i)	
	Function.Intrinsic.Control.CallSub(StateInfoBuild,"Ord",v.Local.i)
	'A Through F needs to be 7 array. 
	Function.Intrinsic.StringBuilder.ToString("BoxAF",v.Local.sT) 
	Function.Intrinsic.String.Split(v.Local.sT,"*!*",v.Local.sT) 
	v.Local.sT.RedimPreserve(0,7)
	F.Intrinsic.String.Join(v.Local.sT,"*!*",v.Local.sBoxAF)	
	'box 1 thorugh 13 
	F.Intrinsic.StringBuilder.ToString("Fed1-13",v.Local.sBox1_13) 
	F.Intrinsic.String.Split(v.Local.sBox1_13,"*!*",v.Local.sBox1_13) 
	v.Local.sBox1_13.RedimPreserve(0,13) 
	F.Intrinsic.String.Join(v.Local.sBox1_13,"*!*",v.Local.sBox1_13) 		 
	'State information, needs to be an array of 14 base and we need to split based on @$@ because we might have more than 2 states.	
	'split them all, then redim them all to be the same, we either have to have data or blank filled data.
	Function.Intrinsic.StringBuilder.ToString("State1520",v.Local.sT)		
	Function.Intrinsic.String.Split(v.Local.sT,"@$@",v.Local.sBoxState)
	Function.Intrinsic.StringBuilder.ToString("Box12",v.Local.sT)		
	Function.Intrinsic.String.Split(v.Local.sT,"@$@",v.Local.sBox12) 	
	Function.Intrinsic.StringBuilder.ToString("Box14",v.Local.sT)		
	Function.Intrinsic.String.Split(v.Local.sT,"@$@",v.Local.sBox14)	
	v.Local.iMax.Set(v.Local.sBoxState.UBound)
	Function.Intrinsic.Control.If(v.Local.iMax,<,v.Local.sBox12.UBound) 
		v.Local.iMax.Set(v.Local.sBox12.UBound)		
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Local.iMax,<,v.Local.sBox14.UBound) 
		v.Local.iMax.Set(v.Local.sBox14.UBound)
	Function.Intrinsic.Control.EndIf		
	
	'redim all to the same ubound
	v.Local.sBoxState.RedimPreserve(0,v.Local.iMax)
	v.Local.sBox12.RedimPreserve(0,v.Local.iMax) 
	v.Local.sBox14.RedimPreserve(0,v.local.iMax)	
	
	'Split and create an array base on what we need either data or blanks	
	Function.Intrinsic.Control.For(v.Local.iF,0,v.Local.iMax,1)
		F.Intrinsic.String.Split(v.Local.sBoxState(v.Local.iF),"*!*",v.Local.st)
		Function.Intrinsic.Control.If(v.Local.sBoxState(v.Local.if).Trim,<>,"")				 
			v.Local.sT.RedimPreserve(0,13) 
		Function.Intrinsic.Control.Else
			v.Local.sT.Redim(0,13)
		Function.Intrinsic.Control.EndIf
		F.Intrinsic.String.Join(v.Local.sT,"*!*",v.Local.sBoxState(v.Local.iF))	
		'box 12 information
		F.Intrinsic.String.Split(v.Local.sBox12(v.Local.iF),"*!*",v.Local.st)
		v.Local.sT.RedimPreserve(0,7) 
		F.Intrinsic.String.Join(v.Local.sT,"*!*",v.Local.sBox12(v.Local.iF))
		'box 14 can be blank just fine.		
		'put it all together and store into dt. 
		F.Intrinsic.String.Build("{0}*!*{1}*!*{2}*!*{3}*!*{4}",v.Local.sBoxAF,v.Local.sBoxState(v.Local.if),v.Local.sBox1_13,v.Local.sBox12(v.Local.if),v.Local.sBox14(v.Local.if),v.Local.sFieldVals)	
		F.Data.DataTable.AddRow("dtFormFields","Employee",v.DataTable.dtEmp(v.Local.i).Employee!FieldValTrim,"FieldVals",v.Local.sFieldVals)			 	
		'after our first run and if we have more we dont' replicate box1_13 on subsequenct forms, clear it out to *!* blanks 13
		v.Local.sBox1_13.Set("")
		v.Local.sBox1_13.Redim(0,13) 
		F.Intrinsic.String.Join(v.Local.sBox1_13,"*!*",v.Local.sBox1_13)
	 Function.Intrinsic.Control.Next(v.Local.iF)
	 
	F.Intrinsic.StringBuilder.Clear("Fed1-13")	
	F.Intrinsic.StringBuilder.Clear("BoxAF")	
	F.Intrinsic.StringBuilder.Clear("State1520")
	F.Intrinsic.StringBuilder.Clear("Box12")
	F.Intrinsic.StringBuilder.Clear("Box14")	
F.Intrinsic.Control.Next(v.Local.i)
F.Intrinsic.StringBuilder.Dispose("Fed1-13")
F.Intrinsic.StringBuilder.Dispose("BoxAF")
F.Intrinsic.StringBuilder.Dispose("State1520")
F.Intrinsic.StringBuilder.Dispose("Box12")
F.Intrinsic.StringBuilder.Dispose("Box14")
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("PDFEMPLOYEEHEADER_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.PDF_EmployeeHeader.End

Program.Sub.CreatePDF.Start
	F.Intrinsic.Control.SetErrorHandler("CreatePDF_Err")
	F.Intrinsic.Control.ClearErrors
	V.Local.sError.Declare(String)
	
		v.Local.bEx.Declare(Boolean)
		v.Local.sPDFFieldNames.Declare(String)
		v.Local.sPDFPath.Declare(String)
		v.Local.sPDFFieldVals.Declare(String)
		v.Local.sTemp.Declare(String)
		v.Local.sTempDirPDFFile.Declare(String)
		v.Local.iC.Declare(Long) 
		v.Local.iCopyNo.Declare(Long)
		v.Local.sCopyText.Declare(String)
		v.Local.sEmpINstructions.Declare(String)
		v.Local.sSel.Declare(String)
		v.Local.sRet.Declare(String)
		
		F.Intrinsic.String.Build("{0}\W2_Instructions_Employees_{1}.pdf",v.Caller.BusintDir,v.Global.iYear,v.Local.sEmpINstructions)
		F.Data.DataTable.Create("dtFQNPDF",True) 
		F.Data.DataTable.AddColumn("dtFQNPDF","IDVAL","Long")
		F.Data.DataTable.AddColumn("dtFQNPDF","Employee","String") 
		F.Data.DataTable.AddColumn("dtFQNPDF","FQN","String")
		F.Data.DataTable.AddColumn("dtFQNPDF","CopyNo","Long")
		F.Intrinsic.String.Split("Copy 1 - State*!*Copy 2 - State*!*Copy B - Federal Filing*!*Copy C - Employee Record*!*Copy D - Employer Record*!*FEDERAL*!*STATE12","*!*",v.Local.sCopyText)
		'grab the pdffields from the PY_FW2_2017.pdf file in Global\Busint
		F.Intrinsic.String.Build("{0}\PY_fw2_{1}.pdf",v.Caller.BusintDir,V.Global.iYear,v.Local.sPDFPath)
		f.Intrinsic.File.Exists(v.Local.sPDFPath,v.Local.bEx) 
		F.Intrinsic.Control.If(v.Local.bEx,=,False)
			F.Intrinsic.String.Build("PY_fw2_{0}.pdf not found. Please contact Global Shop Solutions for assistance.",v.Global.iYear,v.Local.sTemp)
			F.Intrinsic.UI.Msgbox(v.Local.sTemp,"File not found...")	
			F.Intrinsic.Control.CallSub(form_Unload)	
		F.Intrinsic.Control.EndIf
		
		'but if they selected perf forms, we get a differernt form fields. 
		F.Intrinsic.Control.If(v.Screen.FormSelect!chkFedEmp.Value,=,1,"OR",v.Screen.FormSelect!chkStates1and2.Value,=,1)
			F.Intrinsic.String.Build("{0}\PY_fw2_P_{1}.pdf",v.Caller.BusintDir,V.Global.iYear,v.Local.sPDFPath)
			f.Intrinsic.File.Exists(v.Local.sPDFPath,v.Local.bEx) 
			F.Intrinsic.Control.If(v.Local.bEx,=,False)
				F.Intrinsic.String.Build("PY_fw2_P_{0}.pdf not found. Please contact Global Shop Solutions for assistance.",v.Global.iYear,v.Local.sTemp)
				F.Intrinsic.UI.Msgbox(v.Local.sTemp,"File not found...")	
				F.Intrinsic.Control.CallSub(form_Unload)	
			Function.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		
		'if they have employee instructions checked make sure we can find it. 
		F.Intrinsic.Control.If(v.Screen.FormSelect!chk1Filing.Value,=,1) 
			f.Intrinsic.File.Exists(v.Local.sEmpINstructions,v.local.bEx)
			f.Intrinsic.Control.If(v.Local.bEx,=,False) 
				F.Intrinsic.String.Build("W2_Insructions_Employees_{0}.pdf not found. Please contact Global Shop Solutions for assistance.",v.Global.iYear,v.Local.sTemp)
				F.Intrinsic.UI.Msgbox(v.Local.sTemp,"File not found...") 
				F.Intrinsic.Control.CallSub(form_Unload)			
			f.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		F.Automation.PDF.Open("W2",v.Local.sPDFPath) 
		F.Automation.PDF.GetFieldNames("W2",v.Local.sPDFFieldNames)
		F.Automation.PDF.Close("W2")
		F.Intrinsic.String.Build("{0}\W2Temp",v.Caller.LocalGSSTempDir,v.Local.sTemp) 
		F.Intrinsic.File.DirExists(v.Local.sTemp,v.Local.bex) 
		F.Intrinsic.Control.If(v.Local.bEx,=,False) 
			f.Intrinsic.File.CreateDir(v.Local.sTemp)
		F.Intrinsic.Control.EndIf
		'loop through dtForms and every row, here is where we mess with our copy numbers.
		F.Intrinsic.Control.For(v.Local.iCopyNo,0,v.Local.sCopyText.UBound,1)	
			F.Intrinsic.Control.SelectCase(v.Local.iCopyNo) 
				Function.Intrinsic.Control.Case(0)
					F.Intrinsic.Control.If(v.Screen.FormSelect!chk1State1.Value,=,1)					
						Function.Intrinsic.Control.CallSub("SetFormFields","iCopyNo","0","sPDFFieldNames",v.Local.sPDFFieldNames,"sCopy",v.Local.sCopyText(v.Local.iCopyNo),"sPDFPATH",v.Local.sPDFPath)
					Function.Intrinsic.Control.EndIf
				Function.Intrinsic.Control.Case(1)
					F.Intrinsic.Control.If(v.Screen.FormSelect!chk1State2.Value,=,1)				
						F.Intrinsic.Control.callsub("SetFormFields","iCopyNo","1","sPDFFieldNames",v.Local.sPDFFieldNames,"sCopy",v.Local.sCopyText(v.Local.iCopyNo),"sPDFPATH",v.Local.sPDFPath)
					Function.Intrinsic.Control.EndIf				
				Function.Intrinsic.Control.Case(2)
					F.Intrinsic.Control.If(v.Screen.FormSelect!chk1Federal.Value,=,1)				
						F.Intrinsic.Control.callsub("SetFormFields","iCopyNo","2","sPDFFieldNames",v.Local.sPDFFieldNames,"sCopy",v.Local.sCopyText(v.Local.iCopyNo),"sPDFPATH",v.Local.sPDFPath)
					Function.Intrinsic.Control.EndIf
				Function.Intrinsic.Control.Case(3)
					F.Intrinsic.Control.If(v.Screen.FormSelect!chk1Employee.Value,=,1)			
						F.Intrinsic.Control.callsub("SetFormFields","iCopyNo","3","sPDFFieldNames",v.Local.sPDFFieldNames,"sCopy",v.Local.sCopyText(v.Local.iCopyNo),"sPDFPATH",v.Local.sPDFPath)
					Function.Intrinsic.Control.EndIf
				Function.Intrinsic.Control.Case(4)
					F.Intrinsic.Control.If(v.Screen.FormSelect!chk1Employer.Value,=,1)
						F.Intrinsic.Control.callsub("SetFormFields","iCopyNo","4","sPDFFieldNames",v.Local.sPDFFieldNames,"sCopy",v.Local.sCopyText(v.Local.iCopyNo),"sPDFPATH",v.Local.sPDFPath)
					Function.Intrinsic.Control.EndIf				
				Function.Intrinsic.Control.Case(5)
					F.Intrinsic.Control.If(v.Screen.FormSelect!chkFedEmp.Value,=,1)
						F.Intrinsic.Control.callsub("SetFormFields","iCopyNo","5","sPDFFieldNames",v.Local.sPDFFieldNames,"sCopy","Copy B - Federal Filing*!*Copy C - Employee Record","sPDFPATH",v.Local.sPDFPath)
					Function.Intrinsic.Control.EndIf	
				Function.Intrinsic.Control.Case(6)
					F.Intrinsic.Control.If(v.Screen.FormSelect!chkStates1and2.Value,=,1)
						F.Intrinsic.Control.callsub("SetFormFields","iCopyNo","6","sPDFFieldNames",v.Local.sPDFFieldNames,"sCopy","Copy 1 - State*!*Copy 2  - State","sPDFPATH",v.Local.sPDFPath)
					Function.Intrinsic.Control.EndIf			
			F.Intrinsic.Control.EndSelect				
		F.Intrinsic.Control.Next(v.Local.iCopyNO)
		
		F.Data.DataTable.DeleteRow("dtFormFields") 
		f.Data.DataTable.AcceptChanges("dtFormFields")
		
		
		Function.Intrinsic.Control.CallSub(PDFCOmpTotals)
		F.Intrinsic.String.Build("{0}\PY_fw2_{1}.pdf",v.Caller.BusintDir,V.Global.iYear,v.Local.sPDFPath)
		F.Automation.PDF.Open("W2",v.Local.sPDFPath) 
		F.Automation.PDF.GetFieldNames("W2",v.Local.sPDFFieldNames)
		F.Automation.PDF.Close("W2")
		
		F.Intrinsic.Control.For(v.Local.iC,0,v.DataTable.dtFormFields.RowCount--,1)		
			'set path for the temp pdf document 
			F.Intrinsic.String.Build("{0}\W2Temp\fw2_tempTotal{1}_{2}.pdf",v.Caller.LocalGSSTempDir,v.Local.iC,v.DataTable.dtFormFields(v.Local.ic).Employee!FieldValTrim,v.Local.sTempDirPDFFile)	
			F.Automation.PDF.Open("W2",v.Local.sPDFPath)	
			'see if temp file exists. 
			F.Intrinsic.File.Exists(v.Local.sTempDirPDFFile,v.Local.bEx)	
			F.Intrinsic.Control.If(v.Local.bEx,=,True) 
				f.Intrinsic.File.DeleteFile(v.Local.sTempDirPDFFile)
			F.Intrinsic.Control.EndIf
			v.Local.sPDFFieldVals.Set(v.DataTable.dtFormFields(v.Local.ic).FieldVals!FieldValTrim)	
			
			
			'append year?
			F.Automation.PDF.SetFormFields("W2",v.Local.sTempDirPDFFile,v.Local.sPDFFieldNames,v.Local.sPDFFieldVals,True)			
			f.Automation.PDF.Close("W2")	
			f.Intrinsic.File.Exists(v.Local.sTempDirPDFFile,v.Local.bex)
			F.Intrinsic.Control.If(v.Local.bEx,=,True) 
				f.Data.DataTable.AddRow("dtFQNPDF","Employee",v.DataTable.dtFormFields(v.Local.ic).Employee!FieldValTrim,"FQN",v.Local.sTempDirPDFFile)
			F.Intrinsic.Control.EndIf		
		F.Intrinsic.Control.Next(v.Local.iC)
		
		F.Intrinsic.String.Build("{0}\W2Temp\FinalFile.pdf",v.Caller.LocalGSSTempDir,v.Local.sPDFPath) 
		F.Intrinsic.StringBuilder.Create("FilePaths")
		F.Intrinsic.Control.If(v.DataTable.dtFQNPDF.Exists,=,True)
			F.Data.DataView.Create("dtFQNPDF","dvFQNPDF",22,"","[EMPLOYEE] ASC")
			F.Data.DataView.ToDataTable("dtFQNPDF","dvFQNPDF","dtFQNSort")
			F.Intrinsic.Control.For(v.Local.iC,0,v.datatable.dtFQNSort.RowCount--,1)			
				F.Intrinsic.Control.If(v.DataTable.dtfQNSort(v.Local.ic).COpyNo!FieldValTrim,<>,"","AND",v.DataTable.dtFQNSort(v.Local.ic).CopyNO!FieldValTrim,<>,4)
					Function.Intrinsic.Control.If(v.Local.iC,=,0)
						F.Intrinsic.StringBuilder.Append("FilePaths",v.DataTable.dtFQNSort(v.local.ic).FQN!FieldValTrim)		
					Function.Intrinsic.Control.Else
						F.Intrinsic.StringBuilder.Append("FilePaths","*!*",v.DataTable.dtFQNSort(v.local.ic).FQN!FieldValTrim)
					Function.Intrinsic.Control.EndIf			
					Function.Intrinsic.Control.If(v.Screen.FormSelect!chk1Filing.Value,=,1)	
						F.Intrinsic.String.Build("[Employee] = '{0}' And [COPYNO] <> '4'",v.DataTable.dtFQNSort(v.Local.ic).Employee!FieldValTrim,v.Local.sSel)
						F.Data.DataTable.Select("dtFQNSort",v.Local.sSel,v.Local.sRet)
						Function.Intrinsic.Control.If(v.Local.sRet,<>,"***NORETURN***")
							F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
							Function.Intrinsic.Control.If(v.Local.iC,=,v.Local.sRet(v.Local.sRet.UBound))			
								'make sure we are on emp records.
								F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtFQNSort(v.local.ic).Employee!FieldValTrim,v.Local.sSel)
								F.Data.DataTable.Select("dtEmp",v.Local.sSel,v.Local.sRet)
								Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")							
									F.Intrinsic.String.Build("{0}\W2Temp\PY_Emp_Inst_{1}.pdf",v.Caller.LocalGSSTempDir,v.DataTable.dtFQNSort(v.Local.ic).Employee!FieldValTrim,v.Local.sCopyText)											
									F.Intrinsic.File.Exists(v.Local.sCopyText,v.Local.bEx)
									Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
										f.Intrinsic.File.DeleteFile(v.Local.sCopyText)				
									Function.Intrinsic.Control.EndIf
									Function.Intrinsic.File.CopyOpenFile(v.Local.sEmpINstructions,v.Local.sCopyText)
									F.Intrinsic.StringBuilder.Append("FilePaths","*!*",v.Local.sCopyText)
								Function.Intrinsic.Control.EndIf			
							Function.Intrinsic.Control.EndIf
						Function.Intrinsic.Control.EndIf
					Function.Intrinsic.Control.EndIf
				Function.Intrinsic.Control.EndIf
			F.Intrinsic.Control.Next(v.Local.iC)
				
			'see if they checked employee instructions and add it if we don't have anything in Filepaths yet. Must mean they selected Federal Filing and then Employee Instructions....really....
			f.Intrinsic.Control.If(v.Screen.FormSelect!chk1Filing.Value,=,1)	
				F.Intrinsic.StringBuilder.ToString("FilePaths",v.Local.sTemp)
				Function.Intrinsic.Control.If(v.Local.sTemp.Trim,=,"")
					F.Intrinsic.String.Build("{0}\W2Temp\PY_Emp_Inst_MainEMp.pdf",v.Caller.LocalGSSTempDir,v.Local.sCopyText)											
					F.Intrinsic.File.Exists(v.Local.sCopyText,v.Local.bEx)
					Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
						f.Intrinsic.File.DeleteFile(v.Local.sCopyText)				
					Function.Intrinsic.Control.EndIf
					Function.Intrinsic.File.CopyOpenFile(v.Local.sEmpINstructions,v.Local.sCopyText)
					F.Intrinsic.StringBuilder.Append("FilePaths",v.Local.sCopyText)
				Function.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.EndIf
				
			'NOw we have to go through copy four as those are done at the end only and they are done in employee order, then we addin the employer instructions.
			F.Data.DataTable.Select("dtFQNSOrt","[COPYNO] = '4'",v.Local.sRet)	
			Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
				F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)		
				F.Intrinsic.Control.For(v.Local.iC,0,v.Local.sRet.UBound)			
					F.Intrinsic.StringBuilder.ToString("FilePaths",v.Local.sTemp)
					F.Intrinsic.Control.If(v.Local.sTemp.Trim,=,"")
						F.Intrinsic.StringBuilder.Append("FilePaths",v.DataTable.dtFQNSORT(v.Local.sRet(v.Local.ic)).FQN!FieldValTrim)		
				 	Function.Intrinsic.Control.Else
						F.Intrinsic.StringBuilder.Append("FilePaths","*!*",v.DataTable.dtFQNSORT(v.Local.sRet(v.Local.ic)).FQN!FieldValTrim)		
					Function.Intrinsic.Control.EndIf
				F.Intrinsic.Control.Next(v.Local.iC)
				
				'only if Employer is selectd. 
				F.Intrinsic.Control.If(v.Screen.FormSelect!chk1Employer.Value,=,1)
					'append employer instructions.
					F.Intrinsic.String.Build("{0}\W2_Instructions_Employer_{1}.pdf",v.Caller.BusintDir,v.Global.iYear,v.Local.sEmpINstructions) 
					f.Intrinsic.File.Exists(v.Local.sEmpINstructions,v.Local.bEx)
					Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
						F.Intrinsic.String.Build("{0}\W2Temp\PY_Empr_Inst_{1}.pdf",v.Caller.LocalGSSTempDir,"EMPLOYER",v.Local.sCopyText)				
						f.Intrinsic.File.Exists(v.Local.sCopyText,v.Local.bEx) 
						F.Intrinsic.Control.If(v.Local.bEx,=,True) 
							f.Intrinsic.File.DeleteFile(v.Local.sCopyText)
						F.Intrinsic.Control.EndIf
						F.Intrinsic.File.CopyOpenFile(v.Local.sEmpINstructions,v.Local.sCopyText)
						f.Intrinsic.File.Exists(v.Local.sCopyText,v.Local.bEx) 
						Function.Intrinsic.Control.If(v.Local.bEx,=,True)
							f.Intrinsic.StringBuilder.Append("FilePaths","*!*",v.Local.sCopyText)
						Function.Intrinsic.Control.EndIf			
					Function.Intrinsic.Control.Else
						F.Intrinsic.String.Build("File: {0} not found. Creating PDF's without Employer Instructions.",v.Local.sEmpINstructions,v.Local.sTemp)
						F.Intrinsic.UI.Msgbox(v.Local.sTemp,"Employer Instructions not found.")
					Function.Intrinsic.Control.EndIf
				F.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.EndIf
				
			Function.Intrinsic.Control.If(v.Screen.FormSelect!chk1AllCopies.Value,=,1,"OR",v.Screen.FormSelect!chk1Employee.Value,=,1,v.Screen.FormSelect!chk1Employer.Value,=,1,v.Screen.FormSelect!chk1Federal.Value,=,1,v.Screen.FormSelect!chk1State1.Value,=,1,v.Screen.FormSelect!chk1State2.Value,=,1,v.Screen.FormSelect!chkFedEmp.Value,=,1,v.Screen.FormSelect!chkStates1and2.Value,=,1)	
				'Then Totals. at the end. 
				F.Data.DataTable.Select("dtFQNSOrt","[COPYNO] Is Null",v.Local.sRet)
				Function.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
					F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sret)		
					F.Intrinsic.Control.For(v.Local.iC,0,v.Local.sRet.UBound)	
						F.Intrinsic.StringBuilder.ToString("FilePaths",v.Local.sTemp)
						Function.Intrinsic.Control.If(v.Local.sTemp.Trim,=,"")
							f.Intrinsic.StringBuilder.Append("FilePaths",v.DataTable.dtFQNSORT(v.local.sRet(v.Local.iC)).FQN!FieldValTrim)		
						Function.Intrinsic.Control.Else
							f.Intrinsic.StringBuilder.Append("FilePaths","*!*",v.DataTable.dtFQNSORT(v.local.sRet(v.Local.iC)).FQN!FieldValTrim)		
						Function.Intrinsic.Control.EndIf
					F.Intrinsic.Control.Next(v.Local.iC)
				Function.Intrinsic.Control.EndIf
			Function.Intrinsic.Control.EndIf
			F.Intrinsic.StringBuilder.ToString("FilePaths",v.Local.sTemp)		
			Function.Intrinsic.Control.If(v.Local.sTemp.Trim,<>,"")	
				F.Intrinsic.File.Exists(v.Local.sPDFPath,v.local.bEx) 
				F.Intrinsic.Control.If(v.Local.bEx,=,True) 
					f.Intrinsic.File.DeleteFile(v.Local.spdfpath)
				F.Intrinsic.Control.EndIf
				F.Automation.PDF.Merge(v.Local.sTemp,v.Local.sPDFPath)
			Function.Intrinsic.Control.Else
				'if we have nothing at this point end. 
				f.Intrinsic.Control.CallSub(form_unload)
			Function.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
	'copy the created merged pdf to the file that they want it to be in. then open it.
	v.Local.sTemp.Set(v.Screen.Form!txtW2Save.text)
	Function.Intrinsic.File.Exists(v.Local.sPDFPath,v.Local.bEx) 
	F.Intrinsic.Control.If(v.Local.bEx,=,True)
		F.Intrinsic.Control.CallSub(isFileLocked,"path",v.Local.sTemp)		
		Function.Intrinsic.File.Exists(v.Local.sTemp,v.Local.bEx)
		F.Intrinsic.Control.If(v.Local.bEx,=,True) 
			f.Intrinsic.File.DeleteFile(v.Local.sTemp)		
		F.Intrinsic.Control.EndIf
		F.Intrinsic.File.CopyOpenFile(v.Local.sPDFPath,v.Local.sTemp)
		Function.Intrinsic.File.Exists(v.Local.sTemp,v.Local.bEx)
		F.Intrinsic.Control.If(v.Local.bEx,=,True) 
			F.Intrinsic.Task.ShellExec(v.Caller.Handle,"OPEN",v.Local.stemp,"","",1)
		F.Intrinsic.Control.EndIf	
	F.Intrinsic.Control.EndIf
	Gui.F_Progress..Visible(False)
	F.Intrinsic.Control.CallSub(Form_Unload)
	
	F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.Label("CreatePDF_Err")
	F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
		Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		Function.Intrinsic.Control.CallSub(Form_Unload)
	Function.Intrinsic.Control.EndIf
Program.Sub.CreatePDF.End

Program.Sub.PayrollSecurity.Start
F.Intrinsic.Control.SetErrorHandler("PayrollSecurity_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.bPaySec.Declare(Boolean)
v.Local.sRet.Declare(String)
v.Local.sSQL.Declare(String)
v.Local.iC.Declare(Long)
v.Local.iT.Declare(Long)


F.Global.General.ReadOption("400318",0,False,v.Local.bPaySec)
Function.Intrinsic.Control.If(v.Local.bPaySec,=,True)	
	'remove employee records that they do not have access too.
	f.Global.Security.getpaygroupsfromuserid(V.Caller.CompanyCode,V.caller.user,V.Local.sRet)
	F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
		f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
		F.Intrinsic.Control.For(v.Local.iC,0,v.Local.sRet.UBound)
			F.Intrinsic.String.Build("Select Employee, Pay_Group From V_EMPLOYEE_MSTR Where Pay_GROUP = '{0}'",v.Local.sRet(v.Local.ic).Trim,v.Local.sSQL)
			Function.Intrinsic.Control.If(v.DataTable.dtEmpPay.Exists,=,False)			
				F.Data.DataTable.CreateFromSQL("dtEmpPay","conX",v.Local.sSQL)
			Function.Intrinsic.Control.Else	
				F.Data.DataTable.CreateFromSQL("dtTemp","conX",v.Local.sSQL)
				F.Data.DataTable.Merge("dtTemp","dtEmpPay",True,4)
				F.Data.DataTable.Close("dtTemp")			
			Function.Intrinsic.Control.EndIf
		F.Intrinsic.Control.Next(v.Local.iC)
				
		Function.Intrinsic.Control.If(v.DataTable.dtEmpPay.Exists,=,true)
			F.Intrinsic.Control.For(v.Local.iT,v.DataTable.dtEmp.RowCount--,0,-1)
				F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtEmp(v.Local.it).Employee!FieldValTrim,v.Local.sSQL)
				f.Data.DataTable.Select("dtEmpPay",v.Local.sSQL,v.Local.sREt)
				F.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***")
					f.Data.DataTable.DeleteRow("dtEmp",v.Local.it)
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.Next(v.Local.iT)					
			F.Intrinsic.Control.For(v.Local.iT,v.DataTable.dtAddl.RowCount--,0,-1)
				F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtAddl(v.Local.it).Employee!FieldValTrim,v.Local.sSQL)
				f.Data.DataTable.Select("dtEmpPay",v.Local.sSQL,v.Local.sREt)
				F.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***")
					f.Data.DataTable.DeleteRow("dtAddl",v.Local.it)
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.Next(v.Local.iT)					
			F.Intrinsic.Control.For(v.Local.iT,v.DataTable.dtStateLoc.RowCount--,0,-1)
				F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtStateLoc(v.Local.it).Employee!FieldValTrim,v.Local.sSQL)
				f.Data.DataTable.Select("dtEmpPay",v.Local.sSQL,v.Local.sREt)
				F.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***")
					f.Data.DataTable.DeleteRow("dtStateLoc",v.Local.it)
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.Next(v.Local.iT)								
			F.Intrinsic.Control.For(v.Local.iT,v.DataTable.dtState.RowCount--,0,-1)
				F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtState(v.Local.it).Employee!FieldValTrim,v.Local.sSQL)
				f.Data.DataTable.Select("dtEmpPay",v.Local.sSQL,v.Local.sREt)
				F.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***")
					f.Data.DataTable.DeleteRow("dtState",v.Local.it)
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.Next(v.Local.iT)					
			F.Intrinsic.Control.For(v.Local.iT,v.DataTable.dtLoc.RowCount--,0,-1)
				F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtLoc(v.Local.it).Employee!FieldValTrim,v.Local.sSQL)
				f.Data.DataTable.Select("dtEmpPay",v.Local.sSQL,v.Local.sREt)
				F.Intrinsic.Control.If(v.Local.sRet.Trim,=,"***NORETURN***")
					f.Data.DataTable.DeleteRow("dtLoc",v.Local.it)
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.Next(v.Local.iT)					
		Function.Intrinsic.Control.EndIf		
	F.Intrinsic.Control.EndIf
Function.Intrinsic.Control.EndIf
F.Data.DataTable.AcceptChanges("dtEmp")
F.Data.DataTable.AcceptChanges("dtAddl")
F.Data.DataTable.AcceptChanges("dtStateLoc")
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("PayrollSecurity_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.PayrollSecurity.End

Program.Sub.EmployeePrintSelection.Start
F.Intrinsic.Control.SetErrorHandler("EmployeePrintSelection_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sRet.Declare(String)
v.Local.sSel.Declare(String)
v.Local.sT.Declare(String)
v.Local.sFullSel.Declare(String)
v.Local.iOrd.Declare(Long)
v.Local.sRange.Declare(String)
v.Local.iC.Declare(Long)
v.Local.bT.Declare(Boolean)
v.Local.i.Declare(Long)
F.Intrinsic.Control.If(v.Screen.FormPrint!chkTermEmployeesOnly.Value,=,1)
	Function.Intrinsic.Control.CallSub(TermEmployeesOnly)	
Function.Intrinsic.Control.Else
	Gui.FormPrint.lvwEmp.RetrieveAllListItems(v.Local.sRet) 
	F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")	
		f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
		F.Intrinsic.Control.For(v.Local.iC,0,v.Local.sRet.UBound)
			Gui.FormPrint.lvwEmp.RetrieveItemOrdinal(v.Local.sRet(v.Local.ic),v.Local.iOrd)		
			v.Local.sRange.Set(v.Screen.FormPrint!lvwEmp.ListItemTextExtended(v.Local.iOrd))
			F.Intrinsic.String.Split(v.Local.sRange,"*!*",v.Local.sRange)		
			F.Intrinsic.String.Build("[Employee] >= '{0}' And [Employee] <= '{1}'",v.Local.sRange(0).Trim,v.Local.sRange(1).Trim,v.Local.sSel)
			F.Data.DataTable.Select("dtEmp",v.Local.sSel,v.Local.sT)
			Function.Intrinsic.Control.If(v.Local.sT.Trim,<>,"***NORETURN***")
				v.Local.sFullSel.Append(v.Local.st)
			Function.Intrinsic.Control.EndIf
			v.Local.sFullSel.Append("*!*")
		F.Intrinsic.Control.Next(v.Local.iC)	
		Function.Intrinsic.Control.If(v.Local.sFullSel.Trim,<>,"")		
			f.Intrinsic.String.Split(v.Local.sFullSel,"*!*",v.Local.sFullSel)
			f.Intrinsic.Control.For(v.Local.iC,0,v.DataTable.dtEmp.RowCount--,1)
				f.Intrinsic.Control.For(v.Local.iOrd,0,v.Local.sFullSel.UBound,1)
					Function.Intrinsic.Control.If(v.Local.sFullSel(v.Local.iord).trim,<>,"")						
						f.Intrinsic.Control.If(v.Local.iC,=,v.Local.sFullSel(v.Local.iord))
							v.Local.bT.Set(True)					
						f.Intrinsic.Control.EndIf
					Function.Intrinsic.Control.EndIf
				f.Intrinsic.Control.Next(v.Local.iOrd)
				f.Intrinsic.Control.If(v.Local.bT,=,False)
					'remove the same stuff from the other 2 dt's. 
					F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtEmp(v.Local.ic).Employee!FieldValTrim,v.Local.sSel)
					F.Data.DataTable.Select("dtAddl",v.Local.sSel,v.Local.sRet)
					F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
						f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
						F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
							f.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(v.Local.i))
						F.Intrinsic.Control.Next(v.Local.i)
					F.Intrinsic.Control.EndIf
					F.Data.DataTable.Select("dtStateLoc",v.Local.sSel,v.Local.sRet)
					F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
						f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
						F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
							f.Data.DataTable.DeleteRow("dtStateLoc",v.Local.sRet(v.Local.i))
						F.Intrinsic.Control.Next(v.Local.i)
					F.Intrinsic.Control.EndIf					
					'dtState and dtLocal Delets. 
					F.Data.DataTable.Select("dtState",v.Local.sSel,v.Local.sRet)
					F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
						f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
						F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
							f.Data.DataTable.DeleteRow("dtState",v.Local.sRet(v.Local.i))
						F.Intrinsic.Control.Next(v.Local.i)
					F.Intrinsic.Control.EndIf				
					F.Data.DataTable.Select("dtLoc",v.Local.sSel,v.Local.sRet)
					F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
						f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
						F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
							f.Data.DataTable.DeleteRow("dtLoc",v.Local.sRet(v.Local.i))
						F.Intrinsic.Control.Next(v.Local.i)
					F.Intrinsic.Control.EndIf
					f.Data.DataTable.DeleteRow("dtEmp",v.Local.ic)
				f.Intrinsic.Control.EndIf
				v.Local.bT.Set(False)
			f.Intrinsic.Control.Next(v.Local.iC)		
		Function.Intrinsic.Control.EndIf	
	Function.Intrinsic.Control.Else
		'if we are here that means they didnt choose all employees, nor did they make any employee selections. 
		'just end.
		f.Intrinsic.Control.CallSub(form_unload)
	Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

F.Data.DataTable.AcceptChanges("dtEmp")
F.Data.DataTable.AcceptChanges("dtAddl")
F.Data.DataTable.AcceptChanges("dtStateLoc")
F.Data.DataTable.AcceptChanges("dtState")
F.Data.DataTable.AcceptChanges("dtLoc")
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("EmployeePrintSelection_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf

Program.Sub.EmployeePrintSelection.End

Program.Sub.PDFCompTotals.Start
F.Intrinsic.Control.SetErrorHandler("PDFCompTotals_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sSel.Declare(String)
v.Local.sRet.Declare(String)
v.Local.fAmount.Declare(Float)
v.Local.BoxE.Declare(STring)
v.local.sT.Declare(String)
v.Local.sPairs.Declare(STring)
v.Local.sStateHeader.Declare(String)
v.Local.iC.Declare(Long)
v.Local.sFieldVals.Declare(String)
'have to get totals for every state, then grand totals, which includes boxes 1 through 14. 
'should already have company info from the PDF employee information. Company Info Object
'get federal boxes 1 through 12 totals, Ignoring checkboxes values, and any specific codes, we are just totalling all 12 amounts.
'also ignoring box 14.
F.Intrinsic.StringBuilder.Create("Fed1-14") 
F.Intrinsic.StringBuilder.Create("Fed1-14_State")
F.Intrinsic.StringBuilder.Create("State1520")
'Box 1
F.Data.DataTable.Compute("dtEmp","Sum([FED_WAGES])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf		
F.Intrinsic.StringBuilder.Append("Fed1-14",v.Local.sT)

'Box 2
F.Data.DataTable.Compute("dtEmp","Sum([Fed_WithHolding])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)
'Box 3
F.Data.DataTable.Compute("dtEmp","Sum([FICA_WAGES])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)
'Box 4
F.Data.DataTable.Compute("dtEmp","Sum([Fica_WITHHolding])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)
'box 5
F.Data.DataTable.Compute("dtEmp","Sum([MEDI_WAGES])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)
'box6
F.Data.DataTable.Compute("dtEmp","Sum([MEDI_WITHHOLDING])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)
'box7
F.Data.DataTable.Compute("dtEmp","Sum([SS_TIPS])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf
v.Local.sT.Set("")
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)
'box 8	
F.Data.DataTable.Compute("dtEmp","Sum([ALLO_TIPS])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)

'box9
v.Local.sT.Set("")
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)
'box 10
F.Data.DataTable.Compute("dtEmp","Sum([DEP_CARE])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)
 'box 11
F.Data.DataTable.Compute("dtEmp","Sum([NQ_PLAN])","",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)

F.Intrinsic.Stringbuilder.Append("Fed1-14","*!**!**!*") 

'12 a 
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*")

'Sum All of codes for Box 12.B
F.Data.DataTable.Compute("dtAddl","Sum([Amount_12])","Trim([IRS_CODE]) = 'D' OR Trim([IRS_CODE]) = 'E' OR Trim([IRS_CODE]) = 'F' OR Trim([IRS_CODE]) = 'G' OR Trim([IRS_CODE]) = 'H' OR Trim([IRS_CODE]) = 'S' OR Trim([IRS_CODE]) = 'Y' OR Trim([IRS_CODE]) = 'AA' OR Trim([IRS_CODE]) = 'BB' OR Trim([IRS_CODE]) = 'EE' OR Trim([IRS_CODE]) = 'GG' OR Trim([IRS_CODE]) = 'HH'",v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14","*!*",v.Local.sT)

'10 more spaces.
v.Local.sT.Redim(0,7)
F.Intrinsic.String.Join(v.Local.sT,"*!*",v.Local.st)
F.Intrinsic.StringBuilder.Append("Fed1-14",v.Local.st)
F.Data.DataView.Create("dtStateLoc","dvStateSort",22,"","[State] Asc")

'state and local for every state.
'go through dtStateList, as that should be all our values for the state list.
F.Data.Dictionary.CreateFromDataview("dicState","dtStateLoc","dvStateSort","State","Tax_ID",4)
F.Data.Dictionary.ReturnAllPairs("dicState",v.Local.sPairs) 
Function.Intrinsic.Control.If(v.Local.sPairs.Trim,<>,"***NORETURN***")
	F.Intrinsic.String.Split(v.Local.sPairs,"!*!",v.Local.sPairs)
	F.Intrinsic.String.Split(v.Local.sPairs(0),"*!*",v.Local.sPairs)	
	F.Intrinsic.Control.For(v.Local.ic,0,v.local.sPairs.UBound,1) 
		F.Intrinsic.String.Build("[State] = '{0}'",v.local.sPairs(v.Local.ic).Trim,v.Local.sSel)
		'callsub to compute 1 through 14 totals for state we are on. 
		
		
		Function.Intrinsic.Control.CallSub(Sum_StateTotal,"sState",v.Local.sPairs(v.Local.iC).Trim)
		
		'State Code.  box 15
		F.Intrinsic.StringBuilder.Append("State1520",v.local.sPairs(v.Local.ic).Trim,"*!*")
		
		'Tax ID. box 
		F.Intrinsic.StringBuilder.Append("State1520",v.Dictionary.dicState![v.Local.sPairs(v.Local.ic)],"*!*")
		'due to nature of how we setup the states and locations together we have to create a unique dt with Employee and State code, 
		
		'Sum State Wages. box 16
		F.Data.DataTable.Compute("dtTotal","Sum([Wages])",v.Local.sSel,v.Local.fAmount) 
		F.Intrinsic.Control.If(v.Local.fAmount,>,0) 
			f.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")			
		F.Intrinsic.Control.EndIf
		F.Intrinsic.StringBuilder.Append("State1520",v.Local.sT,"*!*")
			 
		'Box 17
		F.Data.DataTable.Compute("dtTotal","Sum([WITHHOLDING])",v.Local.sSel,v.Local.fAmount)
		F.Intrinsic.Control.If(v.Local.fAmount,>,0) 
			f.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")			
		F.Intrinsic.Control.EndIf
		F.Intrinsic.StringBuilder.Append("State1520",v.Local.sT,"*!*")
		
		'Box 18, local, no code care, just state care.
		F.Data.DataTable.Compute("dtStateLoc","Sum([LWages])",v.Local.sSel,v.Local.fAmount)
		F.Intrinsic.Control.If(v.Local.fAmount,>,0) 
			f.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")			
		F.Intrinsic.Control.EndIf		
		F.Intrinsic.StringBuilder.Append("State1520",v.Local.sT,"*!*")
		
		'box 19		
		F.Data.DataTable.Compute("dtStateLoc","Sum([LWith])",v.Local.sSel,v.Local.fAmount)
		F.Intrinsic.Control.If(v.Local.fAmount,>,0) 
			f.Intrinsic.String.Format(v.Local.fAmount,"#####.00",v.Local.st)
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")			
		F.Intrinsic.Control.EndIf
		F.Intrinsic.StringBuilder.Append("State1520",v.Local.sT,"*!*")
		
		'blank local name
		F.Intrinsic.StringBuilder.Append("State1520","*!**!**!**!**!**!*")
		
		F.Intrinsic.String.Build("***COMPANY TOTALS***   STATE: {0}",v.Local.sPairs(v.Local.iC),v.Local.sStateHeader)
			
		
		F.Intrinsic.StringBuilder.ToString("CompanyInfo",v.Local.st)
		'add an extra before for ss which is blank, then add an extra  at the end, for control number,empname,lastname,suffix, append name.
		F.Intrinsic.String.Build("*!*{0}*!**!**!**!**!*{1}*!*",v.Local.sT,v.Local.sStateHeader,v.Local.sFieldVals)					
		F.Intrinsic.StringBuilder.ToString("State1520",v.Local.st)
		v.Local.sFieldVals.Append(v.Local.st)
		v.Local.sFieldVals.Append("*!**!*")
		F.Intrinsic.StringBuilder.ToString("Fed1-14_State",v.Local.st)
		v.Local.sFieldVals.Append(v.Local.st)
		'v.Local.sFieldVals.Append("*!**!**!*")
		F.Intrinsic.String.Build("{0}*!*{1}*!**!*",V.LocaL.sFieldVals,V.Global.iYear,v.Local.sFieldVals)	
		F.Data.DataTable.AddRow("dtFormFields","Employee",v.Local.sPairs(v.Local.ic),"FieldVals",v.Local.sFieldVals)
		F.Intrinsic.StringBuilder.Clear("State1520")		
		F.Intrinsic.StringBuilder.Clear("Fed1-14_State")
	F.Intrinsic.Control.Next(v.Local.ic)
	
	'do grand totals.
	F.Intrinsic.StringBuilder.ToString("CompanyInfo",v.Local.st)
	v.Local.sStateHeader.Set("**COMPANY TOTALS**")
	'add an extra before for ss which is blank, then add an extra  at the end, for control number,empname,lastname,suffix, append name.
	F.Intrinsic.String.Build("*!*{0}*!**!**!**!**!*{1}*!*",v.Local.sT,v.Local.sStateHeader,v.Local.sFieldVals)					
	v.Local.sT.Redim(0,13)
	F.Intrinsic.String.Join(v.Local.sT,"*!*",v.Local.st)
	v.Local.sFieldVals.Append(v.Local.st)
	v.Local.sFieldVals.Append("*!*")
	F.Intrinsic.StringBuilder.ToString("Fed1-14",v.Local.st)
	v.Local.sFieldVals.Append(v.Local.st)	
	'v.Local.sFieldVals.Append("*!**!**!*")		
	F.Intrinsic.String.Build("{0}*!*{1}*!**!*",V.LocaL.sFieldVals,V.Global.iYear,v.Local.sFieldVals)
	F.Data.DataTable.AddRow("dtFormFields","Employee","ZZZZZTOTAL","FieldVals",v.Local.sFieldVals)		
Function.Intrinsic.Control.EndIf	

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("PDFCompTotals_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.PDFCompTotals.End

Program.Sub.chkTermEmployeesOnly_Click.Start
F.Intrinsic.Control.SetErrorHandler("TermEmployees_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
Function.Intrinsic.Control.If(v.Screen.FormPrint!chkTermEmployeesOnly.Value,=,1)	
	Gui.FormPrint.lvwEmp.ClearItems
	Gui.FormPrint.txtBegEmp.Enabled(False)
	Gui.FormPrint.txtEndEmp.Enabled(False)
	Gui.FormPrint.cmdAdd.Enabled(False)
	Gui.FormPrint.cmdDelete.Enabled(False)
	Gui.FormPrint.cmdClear.Enabled(False)
	Gui.FormPrint.txtBegEmp.Text("")
	GUi.FormPrint.txtEndEmp.Text("")
	Gui.FormPrint.lvwEmp.Enabled(False)
	Gui.FormPrint.cmdBegEmpBrowse.Enabled(False)
	Gui.FormPrint.cmdEndEmpBrowse.Enabled(False)
	Gui.FormPrint.chkAllEmp.Value(0)
	Gui.FormPrint.chkAllEmp.Enabled(False)	
Function.Intrinsic.Control.Else
	Gui.FormPrint.chkAllEmp.Enabled(True)		
	Gui.FormPrint.txtBegEmp.Text("")
	GUi.FormPrint.txtEndEmp.Text("")
	Gui.FormPrint.lvwEmp.ClearItems
	Gui.FormPrint.txtBegEmp.Enabled(True)
	Gui.FormPrint.txtEndEmp.Enabled(True)
	Gui.FormPrint.cmdAdd.Enabled(True)
	Gui.FormPrint.cmdDelete.Enabled(True)
	Gui.FormPrint.cmdClear.Enabled(True)
	Gui.FormPrint.lvwEmp.Enabled(True)
	Gui.FormPrint.cmdBegEmpBrowse.Enabled(True)
	Gui.FormPrint.cmdEndEmpBrowse.Enabled(True)
	gui.FormPrint.chkElecFile.Value(0)
Function.Intrinsic.Control.EndIf	
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("TermEmployees_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.chkTermEmployeesOnly_Click.End

Program.Sub.TermEmployeesOnly.Start
F.Intrinsic.Control.SetErrorHandler("TermEmpOnly_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sSQL.Declare(String)
v.Local.sRet.Declare(String)
v.Local.ic.Declare(Long)
v.Local.sSel.Declare(String)
v.Local.i.Declare(Long)
v.Local.sFUllSelect.Declare(String)
v.Local.bT.Declare(Boolean)

'only select employees that were terminated within the W2 year.
F.Intrinsic.String.Build("Select Employee From V_EMPLOYEE_MSTR Where Year(Date_Termination) = '{0}'",v.Global.iYear,v.Local.sSQL)
F.Data.DataTable.CreateFromSQL("dtTermEmp","conx",v.Local.sSQL)
Function.Intrinsic.Control.If(v.DataTable.dtTermEmp.Exists,=,True)
	'make sure it has rows.
	f.Intrinsic.Control.If(v.DataTable.dtTermEmp.RowCount--,<,0)
		f.Intrinsic.Control.CallSub(form_Unload)
	f.Intrinsic.Control.EndIf	
Function.Intrinsic.Control.EndIf

F.Intrinsic.Control.For(v.Local.ic,0,v.DataTable.dtTermEmp.RowCount--,1) 
	F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtTermEmp(v.Local.ic).Employee!FieldValTrim,v.Local.sSel)
	F.Data.DataTable.Select("dtEmp",v.Local.sSel,v.Local.sRet)
	F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
		v.Local.sFUllSelect.Append(v.Local.sRet)		
	F.Intrinsic.Control.EndIf
	v.Local.sFUllSelect.Append("*!*")	
F.Intrinsic.Control.Next(v.Local.ic)
Function.Intrinsic.Control.If(v.Local.sFUllSelect.Trim,<>,"")
	f.Intrinsic.String.Split(v.Local.sFUllSelect,"*!*",v.Local.sFUllSelect)
	F.Intrinsic.Control.For(v.Local.ic,0,v.DataTable.dtEmp.RowCount--,1)
		F.Intrinsic.Control.For(v.Local.i,0,v.Local.sFUllSelect.UBound,1)
			Function.Intrinsic.Control.If(v.Local.sFUllSelect(v.Local.i).trim,<>,"")
				Function.Intrinsic.Control.If(v.Local.ic,=,v.Local.sFUllSelect(v.Local.i))
					v.Local.bT.Set(True)
				Function.Intrinsic.Control.EndIf			
			Function.Intrinsic.Control.EndIf
		F.Intrinsic.Control.Next(v.Local.i)
		
		Function.Intrinsic.Control.If(v.Local.bT,=,False)
			'means we delete.
			'remove the same stuff from the other 2 dt's. 
			F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtEmp(v.Local.ic).Employee!FieldValTrim,v.Local.sSel)
			F.Data.DataTable.Select("dtAddl",v.Local.sSel,v.Local.sRet)
			F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
				f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
				F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
					f.Data.DataTable.DeleteRow("dtAddl",v.Local.sRet(v.Local.i))
				F.Intrinsic.Control.Next(v.Local.i)
			F.Intrinsic.Control.EndIf
			F.Data.DataTable.Select("dtStateLoc",v.Local.sSel,v.Local.sRet)
			F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
				f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
				F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
					f.Data.DataTable.DeleteRow("dtStateLoc",v.Local.sRet(v.Local.i))
				F.Intrinsic.Control.Next(v.Local.i)
			F.Intrinsic.Control.EndIf				
			'dtState and dtLocal Delets. 
			F.Data.DataTable.Select("dtState",v.Local.sSel,v.Local.sRet)
			F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
				f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
				F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
					f.Data.DataTable.DeleteRow("dtState",v.Local.sRet(v.Local.i))
				F.Intrinsic.Control.Next(v.Local.i)
			F.Intrinsic.Control.EndIf				
			F.Data.DataTable.Select("dtLoc",v.Local.sSel,v.Local.sRet)
			F.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***") 
				f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
				F.Intrinsic.Control.For(v.Local.i,0,v.Local.sRet.UBound,1)
					f.Data.DataTable.DeleteRow("dtLoc",v.Local.sRet(v.Local.i))
				F.Intrinsic.Control.Next(v.Local.i)
			F.Intrinsic.Control.EndIf
			f.Data.DataTable.DeleteRow("dtEmp",v.Local.ic)					
		Function.Intrinsic.Control.EndIf
		v.Local.bT.Set(False)
	F.Intrinsic.Control.Next(v.Local.ic)
Function.Intrinsic.Control.EndIf
F.Data.DataTable.Close("dtTermEmp")
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("TermEmpOnly_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.TermEmployeesOnly.End

Program.Sub.SetFormFields.Start
	F.Intrinsic.Control.SetErrorHandler("SetFormFields_Err")
	F.Intrinsic.Control.ClearErrors
	V.Local.sError.Declare(String)
	
		v.Local.ic.Declare(Long)
		v.Local.sCopyText.Declare(String)
		v.Local.sTempDirPDFFile.Declare(String)
		v.Local.sPDFfieldVals.Declare(STring)
		v.Local.sPDFFIeldNames.Declare(String)
		v.Local.bEx.Declare(Boolean)
		v.Local.iCopyNO.Declare(Long)
		v.Local.sPDFPath.Declare(String)
		v.Local.sPDFPath.Set(v.Args.sPDFPath)
		v.Local.iCopyNO.Set(v.Args.iCopyNo)
		v.Local.sPDFFIeldNames.Set(v.Args.sPdfFieldNames)
		v.Local.sCopyText.Set(V.Args.sCopy)
		
		F.Intrinsic.String.Split(v.Local.sCopyText,"*!*",v.Local.sCopyText)
		
		F.Intrinsic.Control.For(v.Local.iC,0,v.DataTable.dtFormFields.RowCount--,1)	
			Function.Intrinsic.Control.If(v.Local.sCopyText.UBound,>,0)
				F.Intrinsic.String.Build("{0}*!*{3}*!*{1}*!*{2}",v.DataTable.dtFormFields(v.Local.ic).FieldVals!FieldValString,v.Local.sCopyText(0),v.Local.sCopyText(1),v.Global.iYear,v.Local.sPDFFieldVals)					
			Function.Intrinsic.Control.Else	
				F.Intrinsic.String.Build("{0}*!*{2}*!*{1}*!*",v.DataTable.dtFormFields(v.Local.ic).FieldVals!FieldValString,v.Local.sCopyText,v.Global.iYear,v.Local.sPDFFieldVals)			
			Function.Intrinsic.Control.EndIf
			'set path for the temp pdf document 
			F.Intrinsic.String.Build("{0}\W2Temp\fw2_temp{1}_{2}.pdf",v.Caller.LocalGSSTempDir,v.Local.iC,v.Local.iCopyNo,v.Local.sTempDirPDFFile)
			F.Automation.PDF.Open("W2",v.Local.sPDFPath)		
			'see if temp file exists. 
			F.Intrinsic.File.Exists(v.Local.sTempDirPDFFile,v.Local.bEx)		
			F.Intrinsic.Control.If(v.Local.bEx,=,True) 
				f.Intrinsic.File.DeleteFile(v.Local.sTempDirPDFFile)
			F.Intrinsic.Control.EndIf		
			F.Automation.PDF.SetFormFields("W2",v.Local.sTempDirPDFFile,v.Local.sPDFFieldNames,v.Local.sPDFFieldVals,True)			
			f.Automation.PDF.Close("W2")		
			f.Intrinsic.File.Exists(v.Local.sTempDirPDFFile,v.Local.bex)
			F.Intrinsic.Control.If(v.Local.bEx,=,True) 
				f.Data.DataTable.AddRow("dtFQNPDF","Employee",v.DataTable.dtFormFields(v.Local.ic).Employee!FieldValTrim,"FQN",v.Local.sTempDirPDFFile,"CopyNo",v.Local.iCopyNO)	
			F.Intrinsic.Control.EndIf		
		F.Intrinsic.Control.Next(v.Local.iC)
		
	F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.Label("SetFormFields_Err")
	F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
		Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		Function.Intrinsic.Control.CallSub(form_unload)
	Function.Intrinsic.Control.EndIf
Program.Sub.SetFormFields.End

Program.Sub.RefreshContact.Start
F.Intrinsic.Control.SetErrorHandler("RefreshContact_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sSQL.Declare(String)

 F.Data.DataTable.SetValue("dtSubmitterInfo",0,"Value",v.DataTable.dtHeader(0).Federal_ID!FieldVal)
 F.Data.DataTable.SetValue("dtSubmitterInfo",1,"Value",v.DataTable.dtW2Data(0).CO_Pin!FieldValTrim)
 F.Data.DataTable.SetValue("dtSubmitterInfo",2,"Value","0098")
 F.Data.DataTable.SetValue("dtSubmitterInfo",3,"Value","98")
 F.Data.DataTable.SetValue("dtSubmitterInfo",4,"Value",V.DataTable.dtHeader(0).Company_name!Fieldval) 
 F.Data.DataTable.SetValue("dtSubmitterInfo",5,"Value",v.DataTable.dtHeader(0).Location_Addr!Fieldval)  
 F.data.DataTable.SetValue("dtSubmitterInfo",6,"Value",v.DataTable.dtHeader(0).Delivery_Addr!FieldVal)  
 F.Data.DataTable.SetValue("dtSubmitterInfo",7,"Value",v.DataTable.dtHeader(0).Address_City!fieldval)
 F.Data.DataTable.SetValue("dtSubmitterInfo",8,"Value",v.DataTable.dtHeader(0).Address_State!FieldVal)
 F.Data.DataTable.SetValue("dtSubmitterInfo",9,"Value",v.DataTable.dtHeader(0).Address_Zip!FieldVal)
 F.Data.DataTable.SetValue("dtContact",0,"Value",v.DataTable.dtW2Data(0).Contact_Name!FieldValTrim)
 F.data.DataTable.SetValue("dtContact",1,"Value",v.DataTable.dtW2Data(0).Contact_Phone!FieldValTrim) 
 F.Data.DataTable.SetValue("dtContact",2,"Value",v.DataTable.dtW2Data(0).Contact_Phone_ext!FieldValTrim)
 F.Data.DataTable.SetValue("dtContact",3,"Value",v.DataTable.dtW2Data(0).Contact_Email!FieldValTrim)
 F.Data.DataTable.SetValue("dtContact",4,"Value",v.DataTable.dtW2Data(0).Contact_Fax!FieldValTrim)
	 
	 'load header changes.
F.Intrinsic.String.Build("Select * From PY_W2_HEADER_CHANGES Where W2_Year = '{0}' And Flag_Delete = '0'",v.Global.iYear,v.Local.sSQL)
F.ODBC.Connection!conX.OpenLocalRecordsetRO("rst",v.Local.sSQL) 
Function.Intrinsic.Control.If(v.ODBC.conx!rst.EOF,<>,True) 
	F.Intrinsic.Control.If(v.DataTable.dtSubmitterInfo.Exists,=,True) 
		F.Data.DataTable.SetValue("dtSubmitterInfo",0,"Value",v.ODBC.conx!rst.FieldValTrim!EIN)
		F.Data.DataTable.SetValue("dtSubmitterInfo",1,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_Pin)
		F.Data.DataTable.SetValue("dtSubmitterInfo",2,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_SFWR_VEN_Code)
		F.Data.DataTable.SetValue("dtSubmitterInfo",3,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_SFWR_Code)
		F.Data.DataTable.SetValue("dtSubmitterInfo",4,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_name)
		F.Data.DataTable.SetValue("dtSubmitterInfo",5,"Value",v.ODBC.conx!rst.FieldValTrim!submit_Location)
		F.Data.DataTable.SetValue("dtSubmitterInfo",6,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_Deliv_Address)
		F.Data.DataTable.SetValue("dtSubmitterInfo",7,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_City)
		F.Data.DataTable.SetValue("dtSubmitterInfo",8,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_State)
		F.Data.DataTable.SetValue("dtSubmitterInfo",9,"Value",v.ODBC.conx!rst.FieldValTrim!Submit_Zip)		
	F.Intrinsic.Control.EndIf
	
	F.Intrinsic.Control.If(v.DataTable.dtContact.Exists,=,True)
	 	F.Data.DataTable.SetValue("dtContact",0,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Name)
	 	F.Data.DataTable.SetValue("dtContact",1,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Phone)
	 	F.Data.DataTable.SetValue("dtContact",2,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Ext)
	 	F.Data.DataTable.SetValue("dtContact",3,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Email)
	 	F.Data.DataTable.SetValue("dtContact",4,"Value",v.ODBC.conx!rst.FieldValTrim!Contact_Fax)
	F.Intrinsic.Control.EndIf
Function.Intrinsic.Control.EndIf
F.ODBC.conx!rst.close
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("RefreshContact_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.RefreshContact.End

Program.Sub.IsFileLocked.Start
F.Intrinsic.Control.SetErrorHandler("IsFileLocked_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sPath.Declare(String)
v.Local.bEx.Declare(Boolean)
v.Local.sPath.Set(v.Args.path)
v.Local.sString.Declare(String)
v.Local.bex.Set(True)
F.Intrinsic.Control.DoUntil(v.Local.bEx,=,False)
	F.Intrinsic.File.IsFileLocked(v.Local.sPath,v.Local.bex)
	Function.Intrinsic.Control.If(v.Local.bEx,=,True) 
		F.Intrinsic.String.Build("File: {0} is locked. Please close the file to continue.",v.Local.sPath,v.Local.sString) 
		F.Intrinsic.UI.Msgbox(v.Local.sString,"File in use...")
	Function.Intrinsic.Control.EndIf	
F.Intrinsic.Control.Loop
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("IsFileLocked_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.IsFileLocked.End

Program.Sub.RefreshState.Start
F.Intrinsic.Control.SetErrorHandler("Refresh_State_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sSQL.Declare(String)
v.Local.sSel.Declare(String)
v.Local.sRet.Declare(String)

'merge state and local together.
Function.Intrinsic.Control.If(v.DataTable.dtStateLoc.Exists,=,True)
	f.Data.DataTable.Close("dtStateLoc")
Function.Intrinsic.Control.EndIf

v.Local.sSQL.Set("Select S.Employee,S.State,s.SEQ As State_Seq,S.Tax_ID,S.Wages,S.Withholding,L.Seq As Local_Seq,L.Local_Code,L.wages As LWages,L.WithHolding As LWith From Y_PY_W2_ST S Left Join Y_PY_W2_LOC L On S.RUNID = L.RUNID And S.Employee = L.Employee And S.State = L.State Order By S.Employee,S.State") 
F.Data.DataTable.CreateFromSQL("dtStateLoc","conX",v.Local.sSQL,True)
F.Data.DataTable.AddExpressionColumn("dtStateLoc","Local_Seq_S","String","ISNull([LocAL_Seq],'')")
'State Information
F.Intrinsic.String.Build("Select * From PY_W2_EMP_STATE_CHGS WHERE W2_YEAR = '{0}' And Flag_Delete = '0'",v.Global.iYear,v.Local.ssql) 
F.ODBC.Connection!conX.OpenLocalRecordsetRO("rst",v.Local.ssql) 
F.Intrinsic.Control.DoUntil(v.ODBC.conx!rst.EOF,=,True) 
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [State_Seq] = '{1}' And [Local_Seq_S] = '{2}'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.ODBC.conx!rst.FieldValTrim!State_Seq,v.ODBC.conx!rst.FieldValTrim!LOC_SEQ,v.Local.sSEL) 
	f.Data.DataTable.Select("dtStateLoc",v.Local.sSel,v.Local.sRet)
	f.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
		f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.local.sRET)
		F.Data.DataTable.SetValue("dtStateLoc",v.Local.sRet(0),"STATE",v.ODBC.conx!rst.FieldValTrim!Box_15,"LOCAL_CODE",v.ODBC.conx!rst.FieldValTrim!Box_20)	
	f.Intrinsic.Control.EndIf	
	'update dtState which corresponds.
	F.Intrinsic.String.Build("[EMPLOYEE] = '{0}' And [SEQ] = '{1}'",v.ODBC.conx!rst.FieldValTrim!Employee_ID,v.ODBC.conx!rst.FieldValTrim!State_Seq,v.Local.sSel)
	f.Data.DataTable.Select("dtState",v.Local.sSel,v.Local.sRet)
	f.Intrinsic.Control.If(v.Local.sRet.Trim,<>,"***NORETURN***")
		f.Intrinsic.String.Split(v.Local.sRet,"*!*",v.local.sRET)
		F.Data.DataTable.SetValue("dtState",v.Local.sRet(0),"STATE",v.ODBC.conx!rst.FieldValTrim!Box_15)	
	Function.Intrinsic.Control.EndIf
	f.ODBC.conx!rst.MoveNext	
F.Intrinsic.Control.Loop
F.ODBC.conx!rst.Close

Function.Intrinsic.Control.If(v.DataTable.dtStateLoc.Exists,=,True)
	'create a blank view so we can create the formt
	f.Data.DataView.Create("dtStateLoc","dvStateLoc",22,"[Employee] = '9999999'","")
	Gui.Form.gcState.AddGridviewFromDataview("gvStateLoc","dtStateLoc","dvStateLoc")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Employee","Visible",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State_Seq","Visible",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Seq","Visible",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Seq_S","Visible",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","Readonly",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","Caption","Box 15")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","Tooltip","15 State")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","AllowSort","False")		
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","State","MaxLength",2)		
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Tax_ID","Readonly",True)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Tax_ID","Caption","State ID number")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Tax_ID","ToolTip","Employer's State ID Number")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Tax_ID","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Wages","Readonly",True)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Wages","Caption","Box 16")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Wages","Tooltip","16 State wages, tips, etc.")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Wages","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Withholding","Readonly",True)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Withholding","Caption","Box 17")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Withholding","ToolTip","17 State Income Tax")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","WithHolding","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWages","Readonly",True)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWages","Caption","Box 18")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWages","ToolTip","18 Local wages, tips, etc.")
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Lwages","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWith","Readonly",True)	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","lWith","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWith","Caption","Box 19")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","LWith","ToolTip","19 Local Income Tax")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","ReadOnly",False)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","VisibleIndex",6)
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","Caption","Box 20")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","ToolTip","20 Locality Name")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","AllowSort","False")	
	Gui.Form.gcState.SetColumnProperty("gvStateLoc","Local_Code","MaxLength",6)	
	Gui.Form.gcState.MainView("gvStateLoc")
Function.Intrinsic.Control.EndIf

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Refresh_State_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.RefreshState.End

Program.Sub.txtControlNumber_Change.Start
v.Global.bChange.Set(True)
Program.Sub.txtControlNumber_Change.End

Program.Sub.Combine_Emps.Start
F.Intrinsic.Control.SetErrorHandler("CombineEmps_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.sPairs.Declare(String)
v.Local.sRet.Declare(String)
v.Local.sFilter.Declare(String)
v.Local.i.Declare(Long)
v.Local.iR.Declare(Long)
v.Local.fAmt.Declare(Float)
v.Local.sEmployeeiD.Declare

'here we have to combine employee records who have the same social. thanks
'DtEmp
'dtAddl
'dtStateLoc

F.Data.Dictionary.CreateFromDataTable("dic_Emp","dtEmp","Employee","SSN")

'dtStateLoc create a expression column that has State and Local_Code combined so we can use it later. 
F.Data.DataTable.AddExpressionColumn("dtStateLoc","Concat_StateLocalCode","String","Trim(ISNULL([STATE],'')) + Trim(ISNULL([Local_CODE],''))")
'add social to all other dt's. 
F.Data.DataTable.AddColumn("dtAddl","SSN","String")
F.Data.DataTable.AddColumn("dtStateLoc","SSN","String")
'fill from dictionary
F.Data.DataTable.FillFromDictionary("dtAddl","dic_Emp","EMPLOYEE","SSN") 
F.Data.DataTable.FillFromDictionary("dtStateLOC","dic_Emp","EMPLOYEE","SSN")

F.Data.Dictionary.ReturnAllPairs("dic_Emp",v.Local.sPairs) 
Function.Intrinsic.Control.If(v.Local.sPairs.Trim,<>,"***NORETURN***")
	'for later
	F.Data.DataView.Create("dtAddl","v_dtAddl",22)
	Function.Intrinsic.String.Split(v.Local.sPairs,"!*!",v.Local.sPairs) 
	Function.Intrinsic.String.Split(v.Local.sPairs(1),"*!*",v.Local.sPairs) 
	Function.Intrinsic.Control.For(v.Local.i,0,v.Local.sPairs.UBound,1)
		'see if we have more than one within our dt. if we do that means we have to sum it all together. 
		F.Intrinsic.String.Build("[SSN] = '{0}'",v.Local.sPairs(v.Local.i).Trim,v.Local.sFilter) 
		F.Data.DataTable.Select("dtEmp",v.Local.sFilter,v.Local.sRet) 
		Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn) 
			Function.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
			Function.Intrinsic.Control.If(v.Local.sRet.UBound,>,0)				
				v.Local.sEmployeeiD.Set(v.DataTable.dtEmp(v.Local.sRet(0)).Employee!Fieldval)
				
				'means we have more than one employee with the same social we must combine. Can't use Social alone, I have to use employee id too..
				'go through each datatable and sum the values we need based on sFilter by social
				Function.Intrinsic.Control.CallSub(dtEmpCombine,"sFilter",v.local.sFilter,"sOrd",v.Local.sRet(0))
				'since we deleted original row, go back to passing the emp id				
				
				Function.Intrinsic.Control.CallSub(dtAddlCombine,"sFilter",v.Local.sFilter,"sEmployeeID",v.Local.sEmployeeiD)		
				'combine state and local							
				Function.Intrinsic.Control.CallSub(dtStateLocCombine,"sFilter",v.Local.sFilter,"sEmployeeID",v.Local.sEmployeeiD)				
			Function.Intrinsic.Control.EndIf
		Function.Intrinsic.Control.EndIf		
	Function.Intrinsic.Control.Next(v.Local.i)
Function.Intrinsic.Control.EndIf


F.Data.DataView.Close("dtAddl","v_dtAddl")
F.Data.DataTable.AcceptChanges("dtEmp") 
F.Data.DataTable.AcceptChanges("dtAddl")
F.Data.DataTable.AcceptChanges("dtStateLoc")

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("CombineEmps_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.Combine_Emps.End

Program.Sub.ComputeColumn.Start
F.Intrinsic.Control.SetErrorHandler("Compute_Column_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sExp.Declare(String)
v.Local.fSum.Declare(Float)
'Args: 
'sDT = DataTable name 
'sFilter = Filter String 
'sColumn  = Column Name from the DT.
F.Intrinsic.String.Build("Sum([{0}])",v.Args.sColumn,v.Local.sExp)
F.Data.DataTable.Compute(v.Args.sDt,v.Local.sExp,v.Args.sFilter,v.Local.fSum)
F.Intrinsic.Variable.AddRV("fSum",v.Local.fSum.currency)
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Compute_Column_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.ComputeColumn.End

Program.Sub.dtEmpCombine.Start
F.Intrinsic.Control.SetErrorHandler("dtEmpCombine_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.Local.sFilter.Declare(String)
v.Local.i.Declare
v.Local.fAmount.Declare(Float)
v.Local.sRet.Declare(String)
v.Local.sOrd.Declare(String)
v.Local.sCol.Declare(String) 
v.local.sExp.Declare
v.Local.sOrd.Set(v.Args.sOrd)
v.Local.sFilter.Set(v.Args.sFilter)

'keep sRet for later so we can delete after the fact.
F.Data.DataTable.Select("dtEmp",v.Local.sFilter,v.Local.sRet)
'Add A new row. Common Data will be grabbed from original ordinal passed from calling sub. 
'calculated fields will be summmed then saved to the last row (assuming that's the correct row)
F.Data.DataTable.AddRowByMap("dtEmp","RUNID*!*LOGID*!*EMPLOYEE*!*SSN*!*LAST_NAME*!*FIRST_NAME*!*MIDDLE_INIT*!*STREET*!*CITY*!*STATE*!*ZIP*!*FED_WAGES*!*FED_WITHHOLDING*!*FICA_WAGES*!*FICA_WITHHOLDING*!*MEDI_WAGES*!*MEDI_WITHHOLDING*!*DEP_CARE*!*STATUTORY_EMP*!*RETIREMENT_PLAN*!*THIRD_PARTY_SICK*!*FILLER*!*CHG_DATE*!*CHG_TIME*!*CHG_BY*!*CHG_PGM*!*CALLING_PGM*!*NQ_PLAN*!*SS_TIPS*!*ALLO_TIPS*!*BOX_D*!*BOX_9*!*BitStatuEmp*!*bitRetirementPlan*!*Bit_ThirdPartySick*!*SortCol",v.Global.iBIRUNID,v.DataTable.dtEmp(v.Local.sOrd).LogID!fieldval,v.DataTable.dtEmp(v.Local.sOrd).Employee!FieldValTrim,v.DataTable.dtEmp(v.Local.sOrd).SSN!FieldValTrim,v.DataTable.dtEmp(v.Local.sOrd).Last_Name!FieldValTrim,v.DataTable.dtEmp(v.Local.sOrd).First_name!FieldValTrim,v.DataTable.dtEmp(v.Local.sOrd).MIDDLE_INIT!FIELDVALTRIM,v.DataTable.dtEmp(v.Local.sOrd).STREET!FIELDVALTRIM,v.DataTable.dtEmp(v.Local.sOrd).CITY!FIELDVALTRIM,v.DataTable.dtEmp(v.Local.sOrd).STATE!FIeldvalTrim,v.DataTable.dtEmp(v.Local.sOrd).ZIP!FIELDVALTRIM,0,0,0,0,0,0,0,v.DataTable.dtEmp(v.Local.sOrd).STATUTORY_EMP!FIELDVAL,v.DataTable.dtEmp(v.Local.sOrd).RETIREMENT_PLAN!FIELDVAL,v.DataTable.dtEmp(v.Local.sOrd).THIRD_PARTY_SICK!FIELDVAL,"",V.datatable.dtEmp(v.Local.sord).chg_date!Fieldval,V.datatable.dtEmp(v.Local.sOrd).CHG_TIME!FIELDVAL,V.Caller.User,"w2GAB","",0,0,0,v.DataTable.dtEmp(v.Local.sOrd).BOX_D!FIELDVAL,v.DataTable.dtEmp(v.Local.sOrd).BOX_9!FIELDVALTRIM,v.DataTable.dtEmp(v.Local.sOrd).BITSTATUEMP!FIELDVAL,v.DataTable.dtEmp(v.Local.sOrd).BITRETIREMENTPLAN!FIELDVAL,v.DataTable.dtEmp(v.Local.sOrd).BIT_THIRDPARTYSICK!FIELDVAL,v.DataTable.dtEmp(v.Local.sOrd).SORTCOL!FIELDVAL)
'sum the summed values
'box 1 through 11 (excluding 9) 
f.Intrinsic.String.Split("FED_WAGES*!*FED_WITHHOLDING*!*FICA_WAGES*!*FICA_WITHHOLDING*!*MEDI_WAGES*!*MEDI_WITHHOLDING*!*DEP_CARE*!*NQ_PLAN*!*SS_TIPS*!*ALLO_TIPS","*!*",v.Local.sCol) 
Function.Intrinsic.Control.For(v.Local.i,0,v.Local.sCol.UBound,1)
	F.Intrinsic.Control.CallSub(ComputeColumn,"sDt","dtEmp","sColumn",v.local.sCol(v.Local.i).Trim,"sFilter",v.Local.sFilter)	
	'Function.Intrinsic.String.Build("Sum([{0}])",v.Local.sCol(v.Local.i).Trim,v.Local.sExp)
	'F.Data.DataTable.Compute("dtEmp",v.Local.sExp,v.Local.sFilter,v.Local.fAmount) 
	F.Data.DataTable.SetValue("dtEmp",v.DataTable.dtEmp.RowCount--,v.Local.sCol(v.Local.i),v.Args.fSum)
Function.Intrinsic.Control.Next(v.Local.i)
'Delete the rows no longer needed
Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn) 
	Function.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet)
	Function.Intrinsic.Control.For(v.Local.i,v.Local.sRet.UBound,0,-1) 
		F.Data.DataTable.DeleteRow("dtEmp",v.Local.sRet(v.Local.i))
	Function.Intrinsic.Control.Next(v.Local.i)
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("dtEmpCombine_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.dtEmpCombine.End

Program.Sub.dtAddlCombine.Start
F.Intrinsic.Control.SetErrorHandler("dtAddlCombine_Err")
F.Intrinsic.Control.ClearErrors
v.Local.sSel.Declare
V.Local.sError.Declare(String)
v.Local.sFilter.Declare(String)
v.Local.sPairs.Declare
v.Local.iP.Declare
v.Local.iT.Declare
'Args sFilter (filter with SSN), and sOrd (ordinal of dtEmp with main emp id being used)
'select original rows from dt and we are going to delete them after we added them.
F.Data.DataTable.Select("dtAddl",v.Args.sFilter,v.Local.sSel)
'Box 12 Information: We have to sum Amount_12 based on Social, [BOX] = '12' and IRS_CODE,   
'create a view with social as the filter.

F.Intrinsic.String.Build("{0} And [Box] = '12'",v.Args.sFilter,v.Local.sFilter)
F.Data.DataView.SetFilter("dtAddl","v_dtAddl",v.local.sFilter)
'this is a good reason to set sort. 
F.Data.DataView.SetSort("dtAddl","v_dtAddl","Employee ASC, SEQ ASC")
'create a dictionary from dataview grabbing social and IRS_CODe (box 12) 
F.Data.Dictionary.CreateFromDataView("dic_Addl_B12","dtAddl","v_dtAddl","IRS_CODE","SSN")
F.Data.Dictionary.ReturnAllPairs("dic_Addl_B12",v.Local.sPairs) 
Function.Intrinsic.Control.If(v.Local.sPairs.IsNotNoReturn) 
	Function.Intrinsic.String.Split(v.Local.spairs,"!*!",v.Local.sPairs) 
	F.Intrinsic.String.Split(v.Local.sPairs(0),"*!*",v.Local.sPairs) 
	Function.Intrinsic.Control.For(v.Local.iP,v.Local.sPairs.LBound,v.Local.sPairs.UBound,1)
		F.Intrinsic.String.Build("{0} And [IRS_CODE] = '{1}'",v.Args.sFilter,v.Local.sPairs(v.Local.iP.trim),v.Local.sFilter)		
		Function.Intrinsic.Control.CallSub(ComputeColumn,"sDt","dtAddl","sFilter",v.Local.sFilter,"sColumn","Amount_12")
		'add new row. 
		F.Intrinsic.Math.Add(v.Local.iP,1,v.Local.iT)
		F.Data.DataTable.AddRowByMap("dtAddl","RUNID*!*LOGID*!*EMPLOYEE*!*BOX*!*SEQ*!*IRS_CODE*!*AMOUNT_12",v.Global.iBIRUNID,1,v.Args.sEmployeeID,"12",v.Local.iT,v.Local.sPairs(v.Local.iP),v.Args.fSum)				
	Function.Intrinsic.Control.Next(v.Local.iP)	
Function.Intrinsic.Control.EndIf
F.Data.Dictionary.Close("dic_Addl_b12")

'box 14.
F.Intrinsic.String.Build("{0} And [Box] = '14'",v.Args.sFilter,v.Local.sFilter)
F.Data.DataView.SetFilter("dtAddl","v_dtAddl",v.local.sFilter)
F.Data.DataView.SetSort("dtAddl","v_dtAddl","Employee ASC")
'create a dictionary from dataview grabbing social and BOX_DESC (box 14) 
F.Data.Dictionary.CreateFromDataView("dic_Addl_B14","dtAddl","v_dtAddl","BOX_DESC","SSN")
F.Data.Dictionary.ReturnAllPairs("dic_Addl_B14",v.Local.sPairs) 
Function.Intrinsic.Control.If(v.Local.sPairs.IsNotNoReturn) 
	Function.Intrinsic.String.Split(v.Local.spairs,"!*!",v.Local.sPairs) 
	F.Intrinsic.String.Split(v.Local.sPairs(0),"*!*",v.Local.sPairs) 
	Function.Intrinsic.Control.For(v.Local.iP,v.Local.sPairs.LBound,v.Local.sPairs.UBound,1)
		F.Intrinsic.String.Build("{0} And [BOX_DESC] = '{1}'",v.Args.sFilter,v.Local.sPairs(v.Local.iP.trim),v.Local.sFilter)			
		Function.Intrinsic.Control.CallSub(ComputeColumn,"sDt","dtAddl","sFilter",v.Local.sFilter,"sColumn","Amount_14")
		'add new row.		
		F.Intrinsic.Math.Add(v.Local.iP,1,v.Local.iT)
		F.Data.DataTable.AddRowByMap("dtAddl","RUNID*!*LOGID*!*EMPLOYEE*!*Box*!*SEQ*!*BOX_DESC*!*AMOUNT_14",v.Global.iBIRUNID,1,v.Args.sEmployeeID,"14",v.Local.iT,v.Local.sPairs(v.Local.ip),v.Args.fSum)		
	Function.Intrinsic.Control.Next(v.Local.iP)	
Function.Intrinsic.Control.EndIf
F.Data.Dictionary.Close("dic_Addl_b14")
'delete original rows from dtAddl 
Function.Intrinsic.Control.If(v.Local.sSel.IsNotNoReturn)
	F.Intrinsic.String.Split(v.Local.sSel,"*!*",v.Local.sSel) 
	F.Intrinsic.Control.For(v.Local.iP,v.Local.sSel.UBound,0,-1) 
		F.Data.DataTable.DeleteRow("dtAddl",v.Local.sSel(v.Local.iP))		 
	F.Intrinsic.Control.Next(v.Local.iP)
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("dtAddlCombine_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_PREPROC.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.dtAddlCombine.End

Program.Sub.dtStateLocCombine.Start
F.Intrinsic.Control.SetErrorHandler("dtStateLocCombine_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.local.sPairs.Declare
v.Local.iP.Declare
v.Local.sDelSel.Declare
v.Local.sSel.Declare
v.Local.sCol.Declare
v.Local.iC.Declare
v.Local.sFilter.Declare
Function.Intrinsic.String.Split("WAGES*!*WITHHOLDING*!*LWages*!*LWith","*!*",v.Local.sCol)
'args sFilter has basically social, and sEmployeeid args is the employee id we need to be using.
'set filter of dvStateLoc to this Social. 
F.Data.DataView.SetFilter("dtStateLOC","dvStateLoc",v.Args.sFilter)
'for removing rows after we done here. 
F.Data.DataTable.Select("dtStateLoc",v.Args.sFilter,v.Local.sDelSel)
'create dictionary based on the xpression column 
F.Data.Dictionary.CreateFromDataView("dic_StateLoc","dtStateLoc","dvStateLoc","Concat_StateLocalCode","Employee")
F.Data.Dictionary.ReturnAllPairs("dic_StateLoc",v.Local.sPairs) 
Function.Intrinsic.Control.If(v.Local.sPairs.IsNotNoReturn) 
	Function.Intrinsic.String.Split(v.Local.sPairs,"!*!",v.Local.sPairs)
	F.Intrinsic.String.Split(v.Local.sPairs(0),"*!*",v.Local.sPairs) 
	Function.Intrinsic.Control.For(v.Local.iP,0,v.Local.sPairs.UBound,1)
		'first add a new row to store this combo.
		Function.Intrinsic.String.Build("{1} AND [Concat_StateLocalCode] = '{0}'",v.Local.sPairs(v.Local.iP),v.Args.sFilter,v.Local.sFilter)		
		F.Data.DataTable.Select("dtStateLoc",v.Local.sFilter,v.Local.sSel)				
		F.Intrinsic.String.Split(v.Local.ssel,"*!*",v.Local.sSel) 
		F.Data.DataTable.AddRowByMap("dtStateLoc","EMPLOYEE*!*STATE*!*State_Seq*!*TAX_ID*!*Local_Seq*!*LOCAL_CODE*!*Local_Seq_S",v.Args.sEmployeeID,v.DataTable.dtStateLoc(v.Local.sSel(0)).State!Fieldval,v.DataTable.dtStateLoc(v.Local.sSel(0)).State_Seq!FIeldval,v.DataTable.dtStateLoc(v.Local.sSel(0)).Tax_ID!Fieldval,v.DataTable.dtStateLoc(v.Local.sSel(0)).Local_Seq!Fieldval,v.DataTable.dtStateLoc(v.Local.sSel(0)).Local_Code!FIeldval,v.DataTable.dtStateLoc(v.Local.sSel(0)).Local_Seq_S!FIeldval) 		
		Function.Intrinsic.Control.For(v.Local.iC,0,v.Local.sCol.UBound)			
			F.Intrinsic.Control.CallSub(ComputeColumn,"sDt","dtStateLoc","sColumn",v.local.sCol(v.Local.iC).Trim,"sFilter",v.Local.sFilter)
			F.Data.DataTable.SetValue("dtStateLoc",v.DataTable.dtStateLoc.RowCount--,v.Local.sCol(v.Local.ic),v.Args.fSum)			
		Function.Intrinsic.Control.Next(v.Local.iC)
	Function.Intrinsic.Control.Next(v.Local.iP)	
Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.If(v.Local.sDelSel.IsNotNoReturn)
	F.Intrinsic.String.Split(v.Local.sDelSel,"*!*",v.Local.sDelSel)
	Function.Intrinsic.Control.For(v.Local.iC,v.Local.sDelSel.UBound,0,-1) 
		f.Data.DataTable.DeleteRow("dtStateLoc",v.Local.sDelSel(v.Local.ic))
	Function.Intrinsic.Control.Next(v.Local.iC)
Function.Intrinsic.Control.EndIf
F.Data.Dictionary.Close("dic_StateLoc")
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("dtStateLocCombine_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_PREPROC.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.dtStateLocCombine.End

Program.Sub.Sum_StateTotal.Start
F.Intrinsic.Control.SetErrorHandler("Sum_StateTotal")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
v.local.sFilter.Declare
v.Local.iR.Declare
v.Local.sT.Declare
v.Local.sRet.Declare
v.Local.fAmount.Declare
'Args is sState that has the State Code 
'since they want us to sum by state on the state totals for boxes 1 thorugh 14, we get to get a list of emp ids.
Function.Intrinsic.String.Build("[State] = '{0}'",v.Args.sState,v.Local.sFilter)
F.Data.DataTable.Select("dtStateLoc",v.Local.sFilter,v.Local.sRet) 
Function.Intrinsic.Control.If(v.Local.sRet.IsNotNoReturn)
	v.Local.sFilter.Set("")
	F.Intrinsic.String.Split(v.Local.sRet,"*!*",v.Local.sRet) 
	Function.Intrinsic.Control.For(v.Local.iR,0,v.Local.sRet.UBound,1) 
		Function.Intrinsic.Control.If(v.Local.sFilter.Trim,=,"")
			Function.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtStateLoc(v.Local.sRet(v.Local.ir)).Employee!FieldVal,v.Local.sFilter)	
		Function.Intrinsic.Control.Else
			Function.Intrinsic.String.Build("{0} OR [Employee] = '{1}'",v.Local.sFilter,v.DataTable.dtStateLoc(v.Local.sRet(v.Local.ir)).Employee!FieldVal,v.Local.sFilter)
		Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.Next(v.Local.iR)
	'enclose sFilter in () if we are done looping
	F.Intrinsic.String.Build("({0})",v.Local.sFilter,v.Local.sFilter)
Function.Intrinsic.Control.EndIf

'Box 1
F.Data.DataTable.Compute("dtEmp","Sum([FED_WAGES])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf		
F.Intrinsic.StringBuilder.Append("Fed1-14_State",v.Local.sT)

'Box 2
F.Data.DataTable.Compute("dtEmp","Sum([Fed_WithHolding])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
'Box 3
F.Data.DataTable.Compute("dtEmp","Sum([FICA_WAGES])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
'Box 4
F.Data.DataTable.Compute("dtEmp","Sum([Fica_WITHHolding])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
'box 5
F.Data.DataTable.Compute("dtEmp","Sum([MEDI_WAGES])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
'box6
F.Data.DataTable.Compute("dtEmp","Sum([MEDI_WITHHOLDING])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
'box7
F.Data.DataTable.Compute("dtEmp","Sum([SS_TIPS])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
v.Local.sT.Set("")
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
'box 8	
F.Data.DataTable.Compute("dtEmp","Sum([ALLO_TIPS])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)

'box9
v.Local.sT.Set("")
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
'box 10
F.Data.DataTable.Compute("dtEmp","Sum([DEP_CARE])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
 'box 11
F.Data.DataTable.Compute("dtEmp","Sum([NQ_PLAN])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)
'checkboxes 13
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!**!**!*")
'12 a 
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*")
v.Local.sFilter.Append(" AND (Trim([IRS_CODE]) = 'D' OR Trim([IRS_CODE]) = 'E' OR Trim([IRS_CODE]) = 'F' OR Trim([IRS_CODE]) = 'G' OR Trim([IRS_CODE]) = 'H' OR Trim([IRS_CODE]) = 'S' OR Trim([IRS_CODE]) = 'Y' OR Trim([IRS_CODE]) = 'AA' OR Trim([IRS_CODE]) = 'BB' OR Trim([IRS_CODE]) = 'EE' OR Trim([IRS_CODE]) = 'GG' OR Trim([IRS_CODE]) = 'HH')")
'Sum All of codes for Box 12.B
F.Data.DataTable.Compute("dtAddl","Sum([Amount_12])",v.Local.sFilter,v.Local.fAmount)
F.Intrinsic.Control.If(v.Local.fAmount,>,0)
	f.Intrinsic.String.Format(v.local.fAmount,"####.00",v.Local.sT)				
Function.Intrinsic.Control.Else
	v.local.sT.set("")			
F.Intrinsic.Control.EndIf	
F.Intrinsic.Stringbuilder.Append("Fed1-14_State","*!*",v.Local.sT)

'7 more spaces.
v.Local.sT.Redim(0,7)
F.Intrinsic.String.Join(v.Local.sT,"*!*",v.Local.st)
F.Intrinsic.StringBuilder.Append("Fed1-14_State",v.Local.st)

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Sum_StateTotal")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_PREPROC.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.Sum_StateTotal.End

Program.Sub.BuildHeaderInfo.Start
F.Intrinsic.Control.SetErrorHandler("BuildHeaderINfo_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.i.Declare(Long)
v.Local.i.Set(v.Args.Ord)
v.Local.sT.Declare(String)
v.Local.sHeaderInformation.Declare(String)
v.Local.sCompanyInfo.Declare(String)
v.Local.sLastName.Declare(String)
v.Local.sSuffix.Declare(String)
v.Local.sCompanyInfo.Set(v.Args.sCompanyinfo)

'here we basically compile our header and company information into our HeaderInformation Stringbuilder OBject
'Header INformation******
'Social,Companyinfostring, ControlNumber,FirstName And Initial,LastName,Suffix
'have to seperate out out the suffix from the last name field. In name seperation the last name is 20 characters long ONLY, and the y table combines last name and suffix. 
'Last name is the first 20 and suffix starts in position 22 always, have to pull that there. 

'Social,Companyinfostring, ControlNumber,FirstName And Initial,LastName,Suffix
F.Intrinsic.String.Left(v.DataTable.dtEmp(v.Local.i).Last_Name!FieldVal,20,v.Local.sLastName) 
F.Intrinsic.String.Mid(v.DataTable.dtEmp(v.Local.i).Last_Name!Fieldval,22,5,v.Local.sSuffix)
F.Intrinsic.String.Build("{0}*!*{1}*!*{2}*!*{3} {4}*!*{5}*!*{6}",v.DataTable.dtEmp(v.Local.i).SSN!FieldValTrim,v.Local.sCompanyInfo,v.DataTable.dtEmp(v.Local.i).Box_D!FieldValTrim,v.DataTable.dtEmp(v.Local.i).First_Name!FieldValTrim,v.DataTable.dtEmp(v.Local.i).Middle_init!FieldValTrim,v.Local.sLastName,v.Local.sSuffix,v.Local.sHeaderInformation)	
'employee adrress information 
F.Intrinsic.String.Build("{1}{0}{2}, {3} {4}",v.Ambient.NewLine,v.DataTable.dtEmp(v.Local.i).Street!FieldValTrim,v.DataTable.dtEmp(v.Local.i).City!FieldValTrim,v.DataTable.dtEmp(v.Local.i).State!FieldValTrim,v.DataTable.dtEmp(v.Local.i).Zip!FieldValTrim,v.Local.sT)	
F.Intrinsic.StringBuilder.Append("BoxAF",v.Local.sHeaderInformation,"*!*",v.Local.sT)

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("BuildHeaderINfo_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.BuildHeaderInfo.End

Program.Sub.Box113_Info.Start
	F.Intrinsic.Control.SetErrorHandler("Box114_Info_Err")
	F.Intrinsic.Control.ClearErrors
	
		V.Local.sError.Declare(String)
		v.Local.sT.Declare
		v.Local.i.Declare
		v.Local.i.Set(v.Args.Ord) 
		'Federal Information Boxes 1 Through 14. array positions 23 through 42
		'have to go and check each value cause they might be blank, and we don't want to write zeroes.....
		'Box 1
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).Fed_Wages.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).Fed_Wages.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf	
		F.Intrinsic.StringBuilder.Append("Fed1-13",v.Local.sT)
		'Box 2
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).Fed_WithHolding.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).Fed_WithHolding.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)
		'Box 3
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).Fica_Wages.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).Fica_Wages.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)
		'Box 4
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).Fica_WithHolding.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).Fica_WithHolding.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)
		'box 5
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).Medi_Wages.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).Medi_Wages.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf	
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)
		'box6
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).Medi_withHolding.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).Medi_WithHOlding.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)
		'box7
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).SS_Tips.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).SS_Tips.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf
		v.Local.sT.Set("")
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)
		'box 8 
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).Allo_Tips.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).Allo_Tips.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)
		'box9	
		F.Intrinsic.Control.If(v.Global.iYear, <, 2019)
			F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.DataTable.dtEmp(v.Local.i).BOX_9!FieldValTrim)
		F.Intrinsic.Control.Else
			F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*","")
		F.Intrinsic.Control.EndIf
		
		'box 10
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).DEP_CARE.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).DEP_CARE.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)
		 'box 11
		F.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).NQ_PLAN.FieldValFloat,>,0) 
			f.Intrinsic.String.Format(v.DataTable.dtEmp(v.Local.i).NQ_PLAN.FieldValFloat,"####.00",v.Local.sT)		
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Stringbuilder.Append("Fed1-13","*!*",v.Local.sT)	
		'checkboxes 13.
		'stat emp
		Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).BITSTATUEMP!FieldVal,=,True)
			F.Intrinsic.StringBuilder.Append("Fed1-13","*!*","X")
		Function.Intrinsic.Control.Else
			F.Intrinsic.StringBuilder.Append("Fed1-13","*!*","")
		Function.Intrinsic.Control.EndIf
		'retirementplan	
		Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).BITRETIREMENTPLAN!FieldVal,=,True)
			F.Intrinsic.StringBuilder.Append("Fed1-13","*!*","X")
		Function.Intrinsic.Control.Else
			F.Intrinsic.StringBuilder.Append("Fed1-13","*!*","")
		Function.Intrinsic.Control.EndIf	
		'thrirdpartysick
		Function.Intrinsic.Control.If(v.DataTable.dtEmp(v.Local.i).BIT_THIRDPARTYSICK!FieldVal,=,True)
			F.Intrinsic.StringBuilder.Append("Fed1-13","*!*","X")
		Function.Intrinsic.Control.Else
			F.Intrinsic.StringBuilder.Append("Fed1-13","*!*","")
		Function.Intrinsic.Control.EndIf		
		
	F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.Label("Box114_Info_Err")
	F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
		Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		Function.Intrinsic.Control.CallSub(form_unload)
	Function.Intrinsic.Control.EndIf
Program.Sub.Box113_Info.End

Program.Sub.Box12InfoBuild.Start
F.Intrinsic.Control.SetErrorHandler("Box12InfoBuild_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
V.Local.sT.Declare
v.Local.iRow.Declare
v.Local.iControl.Declare
v.Local.i.Declare
v.Local.sSel.Declare
v.Local.sRet.Declare
v.Local.fMod.Declare
v.Local.i.Set(v.Args.Ord)
v.Local.iControl.Set(1)
'within dtAddl Box 12 Box field and order by SEQ. only include four then loop through and do the next four with a new delimiter(@$@).
F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '12'",v.DataTable.dtEmp(v.Local.i).Employee!FieldValTrim,v.Local.sSel)
F.Data.DataView.Create("dtAddl","dvAddl",22,v.Local.sSel,"SEQ ASC")
Function.Intrinsic.Control.For(v.Local.iRow,0,v.DataView.dtAddl!dvAddl.RowCount--,1)
	'F.Intrinsic.Control.If(v.dataview.dtAddl!dvAddl(v.Local.iRow).IRS_Code!FieldvalTrim,<>,"")			
		F.Intrinsic.Stringbuilder.Append("Box12",v.dataview.dtAddl!dvAddl(v.Local.iRow).IRS_Code!FieldvalTrim)			
	'Function.Intrinsic.Control.Else
'		F.Intrinsic.StringBuilder.Append("Box12","*!*")			
	'Function.Intrinsic.Control.EndIf		
	'12 amount
	Function.Intrinsic.Control.If(v.dataview.dtAddl!dvAddl(v.Local.iRow).Amount_12!FieldValFloat,>,0)
		F.Intrinsic.String.Format(v.dataview.dtAddl!dvAddl(v.Local.iRow).Amount_12!FieldValFloat,"#####.00",v.Local.st)			
	Function.Intrinsic.Control.Else
		v.Local.sT.Set("")			
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.StringBuilder.Append("Box12","*!*",v.Local.sT)	
	'control is our control to know if we need to append a double delimiter to our stringbuilder
	Function.Intrinsic.	Math.Add(v.Local.iRow,1,v.Local.iControl)
	Function.Intrinsic.Math.Mod(v.Local.iControl,4,v.Local.fMod)
	Function.Intrinsic.Control.If(v.Local.fMod,=,0,"AND",v.Local.iRow,<>,v.DataView.dtAddl!dvAddl.RowCount--) 
		'append a @$@ to our string. 
		F.Intrinsic.StringBuilder.Append("Box12","@$@")
	Function.Intrinsic.Control.Else
		F.Intrinsic.StringBuilder.Append("Box12","*!*")
	Function.Intrinsic.Control.EndIf	
Function.Intrinsic.Control.Next(v.Local.iRow)
F.Data.DataView.Close("dtAddl","dvAddl")
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Box12InfoBuild_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.Box12InfoBuild.End

Program.Sub.Box14InfoBuild.Start
F.Intrinsic.Control.SetErrorHandler("Box14InfoBuild_Err")
F.Intrinsic.Control.ClearErrors
V.Local.sError.Declare(String)
V.Local.sT.Declare
v.Local.iRow.Declare
v.Local.iControl.Declare
v.Local.i.Declare
v.Local.sSel.Declare
v.Local.sRet.Declare
v.Local.fMod.Declare
v.Local.i.Set(v.Args.Ord)
'within dtAddl Box 14 Box field and order by SEQ. only include 5 then loop through and do the next 5 with a new delimiter(@$@).
F.Intrinsic.String.Build("[Employee] = '{0}' And [Box] = '14'",v.DataTable.dtEmp(v.Local.i).Employee!FieldValTrim,v.Local.sSel)
F.Data.DataView.Create("dtAddl","dvAddl",22,v.Local.sSel,"SEQ ASC")
Function.Intrinsic.Control.For(v.Local.iRow,0,v.DataView.dtAddl!dvAddl.RowCount--,1)
	F.Intrinsic.String.Build("{0} {1}",v.DataView.dtAddl(v.Local.iRow)!dvAddl.Box_Desc!FieldValTrim,v.DataView.dtAddl!dvAddl(v.Local.iRow).AMOUNT_14!FieldVal,v.Local.sSel)	
	F.Intrinsic.Stringbuilder.Append("Box14",v.Local.sSel)
	F.Intrinsic.StringBuilder.AppendLine("Box14","")
	'control is our control to know if we need to append a double delimiter to our stringbuilder
	Function.Intrinsic.	Math.Add(v.Local.iRow,1,v.Local.iControl)
	Function.Intrinsic.Math.Mod(v.Local.iControl,4,v.Local.fMod)
	Function.Intrinsic.Control.If(v.Local.fMod,=,0,"AND",v.Local.iRow,<>,v.DataView.dtAddl!dvAddl.RowCount--) 
		'append a @$@ to our string. 
		F.Intrinsic.StringBuilder.Append("Box14","@$@")
	Function.Intrinsic.Control.EndIf	
Function.Intrinsic.Control.Next(v.Local.iRow)
F.Data.DataView.Close("dtAddl","dvAddl")
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("Box14InfoBuild_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf
Program.Sub.Box14InfoBuild.End

Program.Sub.StateInfoBuild.Start
F.Intrinsic.Control.SetErrorHandler("StateInfoBuild_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.i.Declare
v.Local.sSel.Declare
v.Local.i.Set(v.Args.ord)
v.Local.iRow.Declare
v.Local.iControl.Declare
v.local.fMod.Declare
v.Local.sT.Declare
V.Local.sState.Declare
V.Local.bState.Declare


	F.Intrinsic.String.Build("[Employee] = '{0}'",v.DataTable.dtEmp(v.Local.i).Employee!FieldValTrim,v.Local.sSel)
	F.Data.DataView.SetFilter("dtStateLoc","dvStateLoc",v.Local.sSel)

	Function.Intrinsic.Control.For(v.Local.iRow,0,v.DataView.dtStateLoc!dvStateLoc.RowCount--,1) 
		F.Intrinsic.String.IsInString(V.Local.SState,v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).State!FieldValTrim, True, V.Local.bState)
		F.Intrinsic.Control.If(V.Local.bState, =, False)
			'box 15
			F.Intrinsic.StringBuilder.Append("State1520",v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).State!FieldValTrim)
			'state tax id
			F.Intrinsic.StringBuilder.Append("State1520","*!*",v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).Tax_ID!FieldValTrim)
			'box 16
			Function.Intrinsic.Control.If(v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).WAGES!FieldValFloat,>,0)
				F.Intrinsic.String.Format(v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).WAGES!FieldValFloat,"#####.00",v.Local.sT)
			Function.Intrinsic.Control.Else
				v.Local.sT.Set("")
			Function.Intrinsic.Control.EndIf
			F.Intrinsic.StringBuilder.Append("State1520","*!*",v.Local.sT)	
			'box 17
			Function.Intrinsic.Control.If(v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).WithHolding!FieldValFloat,>,0)
				F.Intrinsic.String.Format(v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).WithHolding!FieldValFloat,"#####.00",v.Local.sT)
			Function.Intrinsic.Control.Else
				v.Local.sT.Set("")
			Function.Intrinsic.Control.EndIf
			F.Intrinsic.StringBuilder.Append("State1520","*!*",v.Local.sT)				
		F.Intrinsic.Control.Else
			'box 15
			F.Intrinsic.StringBuilder.Append("State1520","")
			'state tax id
			F.Intrinsic.StringBuilder.Append("State1520","*!*","")
			'box 16
			F.Intrinsic.StringBuilder.Append("State1520","*!*","")
			'box 17
			F.Intrinsic.StringBuilder.Append("State1520","*!*","")
		F.Intrinsic.Control.EndIf			
		'box 18
		Function.Intrinsic.Control.If(v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).LWages!FieldValFloat,>,0)
			F.Intrinsic.String.Format(v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).lWages!FieldValFloat,"#####.00",v.Local.sT)
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		Function.Intrinsic.Control.EndIf
		F.Intrinsic.StringBuilder.Append("State1520","*!*",v.Local.sT)	
		'box 19
		Function.Intrinsic.Control.If(v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).lWith!FieldValFloat,>,0)
			F.Intrinsic.String.Format(v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).lWith!FieldValFloat,"#####.00",v.Local.sT)
		Function.Intrinsic.Control.Else
			v.Local.sT.Set("")
		Function.Intrinsic.Control.EndIf
		F.Intrinsic.StringBuilder.Append("State1520","*!*",v.Local.sT)				
		'box 20
		F.Intrinsic.StringBuilder.Append("State1520","*!*",v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).Local_Code!FieldValTrim)
	
		F.Intrinsic.StringBuilder.Append("State1520","*!*")
		F.Intrinsic.Math.Add(v.Local.iRow,1,v.Local.iControl)
		Function.Intrinsic.Math.Mod(v.Local.iControl,2,v.Local.fMod)
		
		Function.Intrinsic.Control.If(v.Local.fMod,=,0,"AND",v.Local.iRow,<>,v.DataView.dtStateLoc!dvStateLoc.RowCount--) 
			'append a new delimter for the next line to be done later @$@
			F.Intrinsic.StringBuilder.Append("State1520","@$@")			
		Function.Intrinsic.Control.EndIf
		
		'add state to string so on the next loop we don't write boxes 15,16,17 again
		F.Intrinsic.Control.If(V.Local.sState, =, "")
			F.Intrinsic.String.Build("[{0}]",v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).State!FieldValTrim, V.Local.SState)
		F.Intrinsic.Control.Else
			F.Intrinsic.String.IsInString(V.Local.SState,v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).State!FieldValTrim, True, V.Local.bState)
			F.Intrinsic.Control.If(V.Local.bState, =, False)
				F.Intrinsic.String.Build("{0},[{1}]",V.Local.SState,v.DataView.dtStateLoc!dvStateLoc(v.local.iRow).State!FieldValTrim,V.Local.SState)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf	
	Function.Intrinsic.Control.Next(v.Local.iRow)
		
F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.Label("StateInfoBuild_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(form_unload)
Function.Intrinsic.Control.EndIf

Program.Sub.StateInfoBuild.End

Program.Sub.Box20_Replacement.Start
F.Intrinsic.Control.SetErrorHandler("Box20_Replacement_Err")
F.Intrinsic.Control.ClearErrors

V.Local.sError.Declare(String)
v.Local.bExists.Declare(Boolean)
'if they have a custom project installed 4355, local code replacements we have to update the box 20 values with the linked values.BRO120-11020191332-4
F.ODBC.Connection!conX.TableExists("PPT_W2_LOCAL",v.Local.bExists)
Function.Intrinsic.Control.If(v.Local.bExists)	
	F.Data.Dictionary.CreateFromSQL("dic_W2Local","conx","Select Local_Code, Left(Replacement,6) As Replacement From PPT_W2_Local Order By Local_Code")
	F.Data.Dictionary.Exists("dic_W2Local",v.Local.bExists)
	Function.Intrinsic.Control.If(v.Local.bExists) 
		'go through the dtStateLoc and replace the Local_Code Code value with the replacement.		
		F.Data.DataTable.FillFromDictionary("dtStateLoc","dic_W2Local","Local_Code")		
	Function.Intrinsic.Control.EndIf
Function.Intrinsic.Control.EndIf
F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Label("Box20_Replacement_Err")
F.Intrinsic.Control.If(V.Ambient.ErrorNumber,<>,0)
	Function.Intrinsic.String.Concat("Project: BIR_PY_W2_Preproc.gas",V.Ambient.Newline,V.Ambient.Newline,"Subroutine: ",V.Ambient.CurrentSubroutine,V.Ambient.NewLine,"Error Occurred ",V.Ambient.ErrorNumber," with description ",V.Ambient.ErrorDescription,V.Local.sError)
	F.Intrinsic.UI.Msgbox(V.Local.sError)
	Function.Intrinsic.Control.CallSub(Form_Unload)
Function.Intrinsic.Control.EndIf
Program.Sub.Box20_Replacement.End
